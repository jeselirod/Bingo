import{$ as $s,$b as ri,Ab as mt,Bb as Od,Cb as Fd,Db as Kt,E as qs,Eb as je,Fb as Qs,Gb as xr,H as ze,Hb as wn,I as Xt,Ia as Sd,Ib as Md,Jb as Ld,Kb as Ke,Lb as Bd,Mb as Nr,Ob as Ct,Pb as Hs,Qb as Ut,Rb as Ys,Tb as Xs,Ub as Js,Vb as Zs,Wb as ti,Yb as ei,Zb as Zt,_a as bd,_b as ni,a as ya,ac as si,bc as ii,cc as Nt,d as Td,db as D,dc as oi,eb as yn,ec as ai,fb as Rd,gb as Pd,gc as li,h as Ad,hb as xd,ib as Gs,ic as ci,jb as fe,kb as vn,lb as zs,mb as js,nb as Ks,nc as Ud,ob as Nd,oc as qd,pb as va,rb as Dd,sb as Jt,tb as kd,u as Cd,w as Bs,xb as Vd,y as _n,z as Us,zb as Ws}from"./chunk-A3R4XTT4.js";var $d=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Gd={};var me,wa;(function(){var n;function t(I,_){function v(){}v.prototype=_.prototype,I.D=_.prototype,I.prototype=new v,I.prototype.constructor=I,I.C=function(w,E,C){for(var y=Array(arguments.length-2),ue=2;ue<arguments.length;ue++)y[ue-2]=arguments[ue];return _.prototype[E].apply(w,y)}}function e(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}t(r,e),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(I,_,v){v||(v=0);var w=Array(16);if(typeof _=="string")for(var E=0;16>E;++E)w[E]=_.charCodeAt(v++)|_.charCodeAt(v++)<<8|_.charCodeAt(v++)<<16|_.charCodeAt(v++)<<24;else for(E=0;16>E;++E)w[E]=_[v++]|_[v++]<<8|_[v++]<<16|_[v++]<<24;_=I.g[0],v=I.g[1],E=I.g[2];var C=I.g[3],y=_+(C^v&(E^C))+w[0]+3614090360&4294967295;_=v+(y<<7&4294967295|y>>>25),y=C+(E^_&(v^E))+w[1]+3905402710&4294967295,C=_+(y<<12&4294967295|y>>>20),y=E+(v^C&(_^v))+w[2]+606105819&4294967295,E=C+(y<<17&4294967295|y>>>15),y=v+(_^E&(C^_))+w[3]+3250441966&4294967295,v=E+(y<<22&4294967295|y>>>10),y=_+(C^v&(E^C))+w[4]+4118548399&4294967295,_=v+(y<<7&4294967295|y>>>25),y=C+(E^_&(v^E))+w[5]+1200080426&4294967295,C=_+(y<<12&4294967295|y>>>20),y=E+(v^C&(_^v))+w[6]+2821735955&4294967295,E=C+(y<<17&4294967295|y>>>15),y=v+(_^E&(C^_))+w[7]+4249261313&4294967295,v=E+(y<<22&4294967295|y>>>10),y=_+(C^v&(E^C))+w[8]+1770035416&4294967295,_=v+(y<<7&4294967295|y>>>25),y=C+(E^_&(v^E))+w[9]+2336552879&4294967295,C=_+(y<<12&4294967295|y>>>20),y=E+(v^C&(_^v))+w[10]+4294925233&4294967295,E=C+(y<<17&4294967295|y>>>15),y=v+(_^E&(C^_))+w[11]+2304563134&4294967295,v=E+(y<<22&4294967295|y>>>10),y=_+(C^v&(E^C))+w[12]+1804603682&4294967295,_=v+(y<<7&4294967295|y>>>25),y=C+(E^_&(v^E))+w[13]+4254626195&4294967295,C=_+(y<<12&4294967295|y>>>20),y=E+(v^C&(_^v))+w[14]+2792965006&4294967295,E=C+(y<<17&4294967295|y>>>15),y=v+(_^E&(C^_))+w[15]+1236535329&4294967295,v=E+(y<<22&4294967295|y>>>10),y=_+(E^C&(v^E))+w[1]+4129170786&4294967295,_=v+(y<<5&4294967295|y>>>27),y=C+(v^E&(_^v))+w[6]+3225465664&4294967295,C=_+(y<<9&4294967295|y>>>23),y=E+(_^v&(C^_))+w[11]+643717713&4294967295,E=C+(y<<14&4294967295|y>>>18),y=v+(C^_&(E^C))+w[0]+3921069994&4294967295,v=E+(y<<20&4294967295|y>>>12),y=_+(E^C&(v^E))+w[5]+3593408605&4294967295,_=v+(y<<5&4294967295|y>>>27),y=C+(v^E&(_^v))+w[10]+38016083&4294967295,C=_+(y<<9&4294967295|y>>>23),y=E+(_^v&(C^_))+w[15]+3634488961&4294967295,E=C+(y<<14&4294967295|y>>>18),y=v+(C^_&(E^C))+w[4]+3889429448&4294967295,v=E+(y<<20&4294967295|y>>>12),y=_+(E^C&(v^E))+w[9]+568446438&4294967295,_=v+(y<<5&4294967295|y>>>27),y=C+(v^E&(_^v))+w[14]+3275163606&4294967295,C=_+(y<<9&4294967295|y>>>23),y=E+(_^v&(C^_))+w[3]+4107603335&4294967295,E=C+(y<<14&4294967295|y>>>18),y=v+(C^_&(E^C))+w[8]+1163531501&4294967295,v=E+(y<<20&4294967295|y>>>12),y=_+(E^C&(v^E))+w[13]+2850285829&4294967295,_=v+(y<<5&4294967295|y>>>27),y=C+(v^E&(_^v))+w[2]+4243563512&4294967295,C=_+(y<<9&4294967295|y>>>23),y=E+(_^v&(C^_))+w[7]+1735328473&4294967295,E=C+(y<<14&4294967295|y>>>18),y=v+(C^_&(E^C))+w[12]+2368359562&4294967295,v=E+(y<<20&4294967295|y>>>12),y=_+(v^E^C)+w[5]+4294588738&4294967295,_=v+(y<<4&4294967295|y>>>28),y=C+(_^v^E)+w[8]+2272392833&4294967295,C=_+(y<<11&4294967295|y>>>21),y=E+(C^_^v)+w[11]+1839030562&4294967295,E=C+(y<<16&4294967295|y>>>16),y=v+(E^C^_)+w[14]+4259657740&4294967295,v=E+(y<<23&4294967295|y>>>9),y=_+(v^E^C)+w[1]+2763975236&4294967295,_=v+(y<<4&4294967295|y>>>28),y=C+(_^v^E)+w[4]+1272893353&4294967295,C=_+(y<<11&4294967295|y>>>21),y=E+(C^_^v)+w[7]+4139469664&4294967295,E=C+(y<<16&4294967295|y>>>16),y=v+(E^C^_)+w[10]+3200236656&4294967295,v=E+(y<<23&4294967295|y>>>9),y=_+(v^E^C)+w[13]+681279174&4294967295,_=v+(y<<4&4294967295|y>>>28),y=C+(_^v^E)+w[0]+3936430074&4294967295,C=_+(y<<11&4294967295|y>>>21),y=E+(C^_^v)+w[3]+3572445317&4294967295,E=C+(y<<16&4294967295|y>>>16),y=v+(E^C^_)+w[6]+76029189&4294967295,v=E+(y<<23&4294967295|y>>>9),y=_+(v^E^C)+w[9]+3654602809&4294967295,_=v+(y<<4&4294967295|y>>>28),y=C+(_^v^E)+w[12]+3873151461&4294967295,C=_+(y<<11&4294967295|y>>>21),y=E+(C^_^v)+w[15]+530742520&4294967295,E=C+(y<<16&4294967295|y>>>16),y=v+(E^C^_)+w[2]+3299628645&4294967295,v=E+(y<<23&4294967295|y>>>9),y=_+(E^(v|~C))+w[0]+4096336452&4294967295,_=v+(y<<6&4294967295|y>>>26),y=C+(v^(_|~E))+w[7]+1126891415&4294967295,C=_+(y<<10&4294967295|y>>>22),y=E+(_^(C|~v))+w[14]+2878612391&4294967295,E=C+(y<<15&4294967295|y>>>17),y=v+(C^(E|~_))+w[5]+4237533241&4294967295,v=E+(y<<21&4294967295|y>>>11),y=_+(E^(v|~C))+w[12]+1700485571&4294967295,_=v+(y<<6&4294967295|y>>>26),y=C+(v^(_|~E))+w[3]+2399980690&4294967295,C=_+(y<<10&4294967295|y>>>22),y=E+(_^(C|~v))+w[10]+4293915773&4294967295,E=C+(y<<15&4294967295|y>>>17),y=v+(C^(E|~_))+w[1]+2240044497&4294967295,v=E+(y<<21&4294967295|y>>>11),y=_+(E^(v|~C))+w[8]+1873313359&4294967295,_=v+(y<<6&4294967295|y>>>26),y=C+(v^(_|~E))+w[15]+4264355552&4294967295,C=_+(y<<10&4294967295|y>>>22),y=E+(_^(C|~v))+w[6]+2734768916&4294967295,E=C+(y<<15&4294967295|y>>>17),y=v+(C^(E|~_))+w[13]+1309151649&4294967295,v=E+(y<<21&4294967295|y>>>11),y=_+(E^(v|~C))+w[4]+4149444226&4294967295,_=v+(y<<6&4294967295|y>>>26),y=C+(v^(_|~E))+w[11]+3174756917&4294967295,C=_+(y<<10&4294967295|y>>>22),y=E+(_^(C|~v))+w[2]+718787259&4294967295,E=C+(y<<15&4294967295|y>>>17),y=v+(C^(E|~_))+w[9]+3951481745&4294967295,I.g[0]=I.g[0]+_&4294967295,I.g[1]=I.g[1]+(E+(y<<21&4294967295|y>>>11))&4294967295,I.g[2]=I.g[2]+E&4294967295,I.g[3]=I.g[3]+C&4294967295}r.prototype.u=function(I,_){_===void 0&&(_=I.length);for(var v=_-this.blockSize,w=this.B,E=this.h,C=0;C<_;){if(E==0)for(;C<=v;)s(this,I,C),C+=this.blockSize;if(typeof I=="string"){for(;C<_;)if(w[E++]=I.charCodeAt(C++),E==this.blockSize){s(this,w),E=0;break}}else for(;C<_;)if(w[E++]=I[C++],E==this.blockSize){s(this,w),E=0;break}}this.h=E,this.o+=_},r.prototype.v=function(){var I=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);I[0]=128;for(var _=1;_<I.length-8;++_)I[_]=0;var v=8*this.o;for(_=I.length-8;_<I.length;++_)I[_]=v&255,v/=256;for(this.u(I),I=Array(16),_=v=0;4>_;++_)for(var w=0;32>w;w+=8)I[v++]=this.g[_]>>>w&255;return I};function i(I,_){var v=l;return Object.prototype.hasOwnProperty.call(v,I)?v[I]:v[I]=_(I)}function a(I,_){this.h=_;for(var v=[],w=!0,E=I.length-1;0<=E;E--){var C=I[E]|0;w&&C==_||(v[E]=C,w=!1)}this.g=v}var l={};function u(I){return-128<=I&&128>I?i(I,function(_){return new a([_|0],0>_?-1:0)}):new a([I|0],0>I?-1:0)}function h(I){if(isNaN(I)||!isFinite(I))return p;if(0>I)return x(h(-I));for(var _=[],v=1,w=0;I>=v;w++)_[w]=I/v|0,v*=4294967296;return new a(_,0)}function f(I,_){if(I.length==0)throw Error("number format error: empty string");if(_=_||10,2>_||36<_)throw Error("radix out of range: "+_);if(I.charAt(0)=="-")return x(f(I.substring(1),_));if(0<=I.indexOf("-"))throw Error('number format error: interior "-" character');for(var v=h(Math.pow(_,8)),w=p,E=0;E<I.length;E+=8){var C=Math.min(8,I.length-E),y=parseInt(I.substring(E,E+C),_);8>C?(C=h(Math.pow(_,C)),w=w.j(C).add(h(y))):(w=w.j(v),w=w.add(h(y)))}return w}var p=u(0),g=u(1),A=u(16777216);n=a.prototype,n.m=function(){if(N(this))return-x(this).m();for(var I=0,_=1,v=0;v<this.g.length;v++){var w=this.i(v);I+=(0<=w?w:4294967296+w)*_,_*=4294967296}return I},n.toString=function(I){if(I=I||10,2>I||36<I)throw Error("radix out of range: "+I);if(b(this))return"0";if(N(this))return"-"+x(this).toString(I);for(var _=h(Math.pow(I,6)),v=this,w="";;){var E=st(v,_).g;v=U(v,E.j(_));var C=((0<v.g.length?v.g[0]:v.h)>>>0).toString(I);if(v=E,b(v))return C+w;for(;6>C.length;)C="0"+C;w=C+w}},n.i=function(I){return 0>I?0:I<this.g.length?this.g[I]:this.h};function b(I){if(I.h!=0)return!1;for(var _=0;_<I.g.length;_++)if(I.g[_]!=0)return!1;return!0}function N(I){return I.h==-1}n.l=function(I){return I=U(this,I),N(I)?-1:b(I)?0:1};function x(I){for(var _=I.g.length,v=[],w=0;w<_;w++)v[w]=~I.g[w];return new a(v,~I.h).add(g)}n.abs=function(){return N(this)?x(this):this},n.add=function(I){for(var _=Math.max(this.g.length,I.g.length),v=[],w=0,E=0;E<=_;E++){var C=w+(this.i(E)&65535)+(I.i(E)&65535),y=(C>>>16)+(this.i(E)>>>16)+(I.i(E)>>>16);w=y>>>16,C&=65535,y&=65535,v[E]=y<<16|C}return new a(v,v[v.length-1]&-2147483648?-1:0)};function U(I,_){return I.add(x(_))}n.j=function(I){if(b(this)||b(I))return p;if(N(this))return N(I)?x(this).j(x(I)):x(x(this).j(I));if(N(I))return x(this.j(x(I)));if(0>this.l(A)&&0>I.l(A))return h(this.m()*I.m());for(var _=this.g.length+I.g.length,v=[],w=0;w<2*_;w++)v[w]=0;for(w=0;w<this.g.length;w++)for(var E=0;E<I.g.length;E++){var C=this.i(w)>>>16,y=this.i(w)&65535,ue=I.i(E)>>>16,hr=I.i(E)&65535;v[2*w+2*E]+=y*hr,q(v,2*w+2*E),v[2*w+2*E+1]+=C*hr,q(v,2*w+2*E+1),v[2*w+2*E+1]+=y*ue,q(v,2*w+2*E+1),v[2*w+2*E+2]+=C*ue,q(v,2*w+2*E+2)}for(w=0;w<_;w++)v[w]=v[2*w+1]<<16|v[2*w];for(w=_;w<2*_;w++)v[w]=0;return new a(v,0)};function q(I,_){for(;(I[_]&65535)!=I[_];)I[_+1]+=I[_]>>>16,I[_]&=65535,_++}function W(I,_){this.g=I,this.h=_}function st(I,_){if(b(_))throw Error("division by zero");if(b(I))return new W(p,p);if(N(I))return _=st(x(I),_),new W(x(_.g),x(_.h));if(N(_))return _=st(I,x(_)),new W(x(_.g),_.h);if(30<I.g.length){if(N(I)||N(_))throw Error("slowDivide_ only works with positive integers.");for(var v=g,w=_;0>=w.l(I);)v=Bt(v),w=Bt(w);var E=nt(v,1),C=nt(w,1);for(w=nt(w,2),v=nt(v,2);!b(w);){var y=C.add(w);0>=y.l(I)&&(E=E.add(v),C=y),w=nt(w,1),v=nt(v,1)}return _=U(I,E.j(_)),new W(E,_)}for(E=p;0<=I.l(_);){for(v=Math.max(1,Math.floor(I.m()/_.m())),w=Math.ceil(Math.log(v)/Math.LN2),w=48>=w?1:Math.pow(2,w-48),C=h(v),y=C.j(_);N(y)||0<y.l(I);)v-=w,C=h(v),y=C.j(_);b(C)&&(C=g),E=E.add(C),I=U(I,y)}return new W(E,I)}n.A=function(I){return st(this,I).h},n.and=function(I){for(var _=Math.max(this.g.length,I.g.length),v=[],w=0;w<_;w++)v[w]=this.i(w)&I.i(w);return new a(v,this.h&I.h)},n.or=function(I){for(var _=Math.max(this.g.length,I.g.length),v=[],w=0;w<_;w++)v[w]=this.i(w)|I.i(w);return new a(v,this.h|I.h)},n.xor=function(I){for(var _=Math.max(this.g.length,I.g.length),v=[],w=0;w<_;w++)v[w]=this.i(w)^I.i(w);return new a(v,this.h^I.h)};function Bt(I){for(var _=I.g.length+1,v=[],w=0;w<_;w++)v[w]=I.i(w)<<1|I.i(w-1)>>>31;return new a(v,I.h)}function nt(I,_){var v=_>>5;_%=32;for(var w=I.g.length-v,E=[],C=0;C<w;C++)E[C]=0<_?I.i(C+v)>>>_|I.i(C+v+1)<<32-_:I.i(C+v);return new a(E,I.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,wa=Gd.Md5=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=h,a.fromString=f,me=Gd.Integer=a}).apply(typeof $d<"u"?$d:typeof self<"u"?self:typeof window<"u"?window:{});var ui=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},pe={};var Ea,ty,En,Ia,Dr,hi,Ta,Aa,Ca;(function(){var n,t=typeof Object.defineProperties=="function"?Object.defineProperty:function(o,c,d){return o==Array.prototype||o==Object.prototype||(o[c]=d.value),o};function e(o){o=[typeof globalThis=="object"&&globalThis,o,typeof window=="object"&&window,typeof self=="object"&&self,typeof ui=="object"&&ui];for(var c=0;c<o.length;++c){var d=o[c];if(d&&d.Math==Math)return d}throw Error("Cannot find global object")}var r=e(this);function s(o,c){if(c)t:{var d=r;o=o.split(".");for(var m=0;m<o.length-1;m++){var T=o[m];if(!(T in d))break t;d=d[T]}o=o[o.length-1],m=d[o],c=c(m),c!=m&&c!=null&&t(d,o,{configurable:!0,writable:!0,value:c})}}function i(o,c){o instanceof String&&(o+="");var d=0,m=!1,T={next:function(){if(!m&&d<o.length){var S=d++;return{value:c(S,o[S]),done:!1}}return m=!0,{done:!0,value:void 0}}};return T[Symbol.iterator]=function(){return T},T}s("Array.prototype.values",function(o){return o||function(){return i(this,function(c,d){return d})}});var a=a||{},l=this||self;function u(o){var c=typeof o;return c=c!="object"?c:o?Array.isArray(o)?"array":c:"null",c=="array"||c=="object"&&typeof o.length=="number"}function h(o){var c=typeof o;return c=="object"&&o!=null||c=="function"}function f(o,c,d){return o.call.apply(o.bind,arguments)}function p(o,c,d){if(!o)throw Error();if(2<arguments.length){var m=Array.prototype.slice.call(arguments,2);return function(){var T=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(T,m),o.apply(c,T)}}return function(){return o.apply(c,arguments)}}function g(o,c,d){return g=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?f:p,g.apply(null,arguments)}function A(o,c){var d=Array.prototype.slice.call(arguments,1);return function(){var m=d.slice();return m.push.apply(m,arguments),o.apply(this,m)}}function b(o,c){function d(){}d.prototype=c.prototype,o.aa=c.prototype,o.prototype=new d,o.prototype.constructor=o,o.Qb=function(m,T,S){for(var k=Array(arguments.length-2),tt=2;tt<arguments.length;tt++)k[tt-2]=arguments[tt];return c.prototype[T].apply(m,k)}}function N(o){let c=o.length;if(0<c){let d=Array(c);for(let m=0;m<c;m++)d[m]=o[m];return d}return[]}function x(o,c){for(let d=1;d<arguments.length;d++){let m=arguments[d];if(u(m)){let T=o.length||0,S=m.length||0;o.length=T+S;for(let k=0;k<S;k++)o[T+k]=m[k]}else o.push(m)}}class U{constructor(c,d){this.i=c,this.j=d,this.h=0,this.g=null}get(){let c;return 0<this.h?(this.h--,c=this.g,this.g=c.next,c.next=null):c=this.i(),c}}function q(o){return/^[\s\xa0]*$/.test(o)}function W(){var o=l.navigator;return o&&(o=o.userAgent)?o:""}function st(o){return st[" "](o),o}st[" "]=function(){};var Bt=W().indexOf("Gecko")!=-1&&!(W().toLowerCase().indexOf("webkit")!=-1&&W().indexOf("Edge")==-1)&&!(W().indexOf("Trident")!=-1||W().indexOf("MSIE")!=-1)&&W().indexOf("Edge")==-1;function nt(o,c,d){for(let m in o)c.call(d,o[m],m,o)}function I(o,c){for(let d in o)c.call(void 0,o[d],d,o)}function _(o){let c={};for(let d in o)c[d]=o[d];return c}let v="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function w(o,c){let d,m;for(let T=1;T<arguments.length;T++){m=arguments[T];for(d in m)o[d]=m[d];for(let S=0;S<v.length;S++)d=v[S],Object.prototype.hasOwnProperty.call(m,d)&&(o[d]=m[d])}}function E(o){var c=1;o=o.split(":");let d=[];for(;0<c&&o.length;)d.push(o.shift()),c--;return o.length&&d.push(o.join(":")),d}function C(o){l.setTimeout(()=>{throw o},0)}function y(){var o=Wo;let c=null;return o.g&&(c=o.g,o.g=o.g.next,o.g||(o.h=null),c.next=null),c}class ue{constructor(){this.h=this.g=null}add(c,d){let m=hr.get();m.set(c,d),this.h?this.h.next=m:this.g=m,this.h=m}}var hr=new U(()=>new w_,o=>o.reset());class w_{constructor(){this.next=this.g=this.h=null}set(c,d){this.h=c,this.g=d,this.next=null}reset(){this.next=this.g=this.h=null}}let dr,fr=!1,Wo=new ue,Ih=()=>{let o=l.Promise.resolve(void 0);dr=()=>{o.then(E_)}};var E_=()=>{for(var o;o=y();){try{o.h.call(o.g)}catch(d){C(d)}var c=hr;c.j(o),100>c.h&&(c.h++,o.next=c.g,c.g=o)}fr=!1};function Ce(){this.s=this.s,this.C=this.C}Ce.prototype.s=!1,Ce.prototype.ma=function(){this.s||(this.s=!0,this.N())},Ce.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Et(o,c){this.type=o,this.g=this.target=c,this.defaultPrevented=!1}Et.prototype.h=function(){this.defaultPrevented=!0};var I_=function(){if(!l.addEventListener||!Object.defineProperty)return!1;var o=!1,c=Object.defineProperty({},"passive",{get:function(){o=!0}});try{let d=()=>{};l.addEventListener("test",d,c),l.removeEventListener("test",d,c)}catch{}return o}();function mr(o,c){if(Et.call(this,o?o.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,o){var d=this.type=o.type,m=o.changedTouches&&o.changedTouches.length?o.changedTouches[0]:null;if(this.target=o.target||o.srcElement,this.g=c,c=o.relatedTarget){if(Bt){t:{try{st(c.nodeName);var T=!0;break t}catch{}T=!1}T||(c=null)}}else d=="mouseover"?c=o.fromElement:d=="mouseout"&&(c=o.toElement);this.relatedTarget=c,m?(this.clientX=m.clientX!==void 0?m.clientX:m.pageX,this.clientY=m.clientY!==void 0?m.clientY:m.pageY,this.screenX=m.screenX||0,this.screenY=m.screenY||0):(this.clientX=o.clientX!==void 0?o.clientX:o.pageX,this.clientY=o.clientY!==void 0?o.clientY:o.pageY,this.screenX=o.screenX||0,this.screenY=o.screenY||0),this.button=o.button,this.key=o.key||"",this.ctrlKey=o.ctrlKey,this.altKey=o.altKey,this.shiftKey=o.shiftKey,this.metaKey=o.metaKey,this.pointerId=o.pointerId||0,this.pointerType=typeof o.pointerType=="string"?o.pointerType:T_[o.pointerType]||"",this.state=o.state,this.i=o,o.defaultPrevented&&mr.aa.h.call(this)}}b(mr,Et);var T_={2:"touch",3:"pen",4:"mouse"};mr.prototype.h=function(){mr.aa.h.call(this);var o=this.i;o.preventDefault?o.preventDefault():o.returnValue=!1};var pr="closure_listenable_"+(1e6*Math.random()|0),A_=0;function C_(o,c,d,m,T){this.listener=o,this.proxy=null,this.src=c,this.type=d,this.capture=!!m,this.ha=T,this.key=++A_,this.da=this.fa=!1}function Is(o){o.da=!0,o.listener=null,o.proxy=null,o.src=null,o.ha=null}function Ts(o){this.src=o,this.g={},this.h=0}Ts.prototype.add=function(o,c,d,m,T){var S=o.toString();o=this.g[S],o||(o=this.g[S]=[],this.h++);var k=Ho(o,c,m,T);return-1<k?(c=o[k],d||(c.fa=!1)):(c=new C_(c,this.src,S,!!m,T),c.fa=d,o.push(c)),c};function Qo(o,c){var d=c.type;if(d in o.g){var m=o.g[d],T=Array.prototype.indexOf.call(m,c,void 0),S;(S=0<=T)&&Array.prototype.splice.call(m,T,1),S&&(Is(c),o.g[d].length==0&&(delete o.g[d],o.h--))}}function Ho(o,c,d,m){for(var T=0;T<o.length;++T){var S=o[T];if(!S.da&&S.listener==c&&S.capture==!!d&&S.ha==m)return T}return-1}var Yo="closure_lm_"+(1e6*Math.random()|0),Xo={};function Th(o,c,d,m,T){if(m&&m.once)return Ch(o,c,d,m,T);if(Array.isArray(c)){for(var S=0;S<c.length;S++)Th(o,c[S],d,m,T);return null}return d=ea(d),o&&o[pr]?o.K(c,d,h(m)?!!m.capture:!!m,T):Ah(o,c,d,!1,m,T)}function Ah(o,c,d,m,T,S){if(!c)throw Error("Invalid event type");var k=h(T)?!!T.capture:!!T,tt=Zo(o);if(tt||(o[Yo]=tt=new Ts(o)),d=tt.add(c,d,m,k,S),d.proxy)return d;if(m=S_(),d.proxy=m,m.src=o,m.listener=d,o.addEventListener)I_||(T=k),T===void 0&&(T=!1),o.addEventListener(c.toString(),m,T);else if(o.attachEvent)o.attachEvent(bh(c.toString()),m);else if(o.addListener&&o.removeListener)o.addListener(m);else throw Error("addEventListener and attachEvent are unavailable.");return d}function S_(){function o(d){return c.call(o.src,o.listener,d)}let c=b_;return o}function Ch(o,c,d,m,T){if(Array.isArray(c)){for(var S=0;S<c.length;S++)Ch(o,c[S],d,m,T);return null}return d=ea(d),o&&o[pr]?o.L(c,d,h(m)?!!m.capture:!!m,T):Ah(o,c,d,!0,m,T)}function Sh(o,c,d,m,T){if(Array.isArray(c))for(var S=0;S<c.length;S++)Sh(o,c[S],d,m,T);else m=h(m)?!!m.capture:!!m,d=ea(d),o&&o[pr]?(o=o.i,c=String(c).toString(),c in o.g&&(S=o.g[c],d=Ho(S,d,m,T),-1<d&&(Is(S[d]),Array.prototype.splice.call(S,d,1),S.length==0&&(delete o.g[c],o.h--)))):o&&(o=Zo(o))&&(c=o.g[c.toString()],o=-1,c&&(o=Ho(c,d,m,T)),(d=-1<o?c[o]:null)&&Jo(d))}function Jo(o){if(typeof o!="number"&&o&&!o.da){var c=o.src;if(c&&c[pr])Qo(c.i,o);else{var d=o.type,m=o.proxy;c.removeEventListener?c.removeEventListener(d,m,o.capture):c.detachEvent?c.detachEvent(bh(d),m):c.addListener&&c.removeListener&&c.removeListener(m),(d=Zo(c))?(Qo(d,o),d.h==0&&(d.src=null,c[Yo]=null)):Is(o)}}}function bh(o){return o in Xo?Xo[o]:Xo[o]="on"+o}function b_(o,c){if(o.da)o=!0;else{c=new mr(c,this);var d=o.listener,m=o.ha||o.src;o.fa&&Jo(o),o=d.call(m,c)}return o}function Zo(o){return o=o[Yo],o instanceof Ts?o:null}var ta="__closure_events_fn_"+(1e9*Math.random()>>>0);function ea(o){return typeof o=="function"?o:(o[ta]||(o[ta]=function(c){return o.handleEvent(c)}),o[ta])}function It(){Ce.call(this),this.i=new Ts(this),this.M=this,this.F=null}b(It,Ce),It.prototype[pr]=!0,It.prototype.removeEventListener=function(o,c,d,m){Sh(this,o,c,d,m)};function Pt(o,c){var d,m=o.F;if(m)for(d=[];m;m=m.F)d.push(m);if(o=o.M,m=c.type||c,typeof c=="string")c=new Et(c,o);else if(c instanceof Et)c.target=c.target||o;else{var T=c;c=new Et(m,o),w(c,T)}if(T=!0,d)for(var S=d.length-1;0<=S;S--){var k=c.g=d[S];T=As(k,m,!0,c)&&T}if(k=c.g=o,T=As(k,m,!0,c)&&T,T=As(k,m,!1,c)&&T,d)for(S=0;S<d.length;S++)k=c.g=d[S],T=As(k,m,!1,c)&&T}It.prototype.N=function(){if(It.aa.N.call(this),this.i){var o=this.i,c;for(c in o.g){for(var d=o.g[c],m=0;m<d.length;m++)Is(d[m]);delete o.g[c],o.h--}}this.F=null},It.prototype.K=function(o,c,d,m){return this.i.add(String(o),c,!1,d,m)},It.prototype.L=function(o,c,d,m){return this.i.add(String(o),c,!0,d,m)};function As(o,c,d,m){if(c=o.i.g[String(c)],!c)return!0;c=c.concat();for(var T=!0,S=0;S<c.length;++S){var k=c[S];if(k&&!k.da&&k.capture==d){var tt=k.listener,yt=k.ha||k.src;k.fa&&Qo(o.i,k),T=tt.call(yt,m)!==!1&&T}}return T&&!m.defaultPrevented}function Rh(o,c,d){if(typeof o=="function")d&&(o=g(o,d));else if(o&&typeof o.handleEvent=="function")o=g(o.handleEvent,o);else throw Error("Invalid listener argument");return 2147483647<Number(c)?-1:l.setTimeout(o,c||0)}function Ph(o){o.g=Rh(()=>{o.g=null,o.i&&(o.i=!1,Ph(o))},o.l);let c=o.h;o.h=null,o.m.apply(null,c)}class R_ extends Ce{constructor(c,d){super(),this.m=c,this.l=d,this.h=null,this.i=!1,this.g=null}j(c){this.h=arguments,this.g?this.i=!0:Ph(this)}N(){super.N(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function gr(o){Ce.call(this),this.h=o,this.g={}}b(gr,Ce);var xh=[];function Nh(o){nt(o.g,function(c,d){this.g.hasOwnProperty(d)&&Jo(c)},o),o.g={}}gr.prototype.N=function(){gr.aa.N.call(this),Nh(this)},gr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var na=l.JSON.stringify,P_=l.JSON.parse,x_=class{stringify(o){return l.JSON.stringify(o,void 0)}parse(o){return l.JSON.parse(o,void 0)}};function ra(){}ra.prototype.h=null;function Dh(o){return o.h||(o.h=o.i())}function kh(){}var _r={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function sa(){Et.call(this,"d")}b(sa,Et);function ia(){Et.call(this,"c")}b(ia,Et);var Ue={},Vh=null;function Cs(){return Vh=Vh||new It}Ue.La="serverreachability";function Oh(o){Et.call(this,Ue.La,o)}b(Oh,Et);function yr(o){let c=Cs();Pt(c,new Oh(c))}Ue.STAT_EVENT="statevent";function Fh(o,c){Et.call(this,Ue.STAT_EVENT,o),this.stat=c}b(Fh,Et);function xt(o){let c=Cs();Pt(c,new Fh(c,o))}Ue.Ma="timingevent";function Mh(o,c){Et.call(this,Ue.Ma,o),this.size=c}b(Mh,Et);function vr(o,c){if(typeof o!="function")throw Error("Fn must not be null and must be a function");return l.setTimeout(function(){o()},c)}function wr(){this.g=!0}wr.prototype.xa=function(){this.g=!1};function N_(o,c,d,m,T,S){o.info(function(){if(o.g)if(S)for(var k="",tt=S.split("&"),yt=0;yt<tt.length;yt++){var Y=tt[yt].split("=");if(1<Y.length){var Tt=Y[0];Y=Y[1];var At=Tt.split("_");k=2<=At.length&&At[1]=="type"?k+(Tt+"="+Y+"&"):k+(Tt+"=redacted&")}}else k=null;else k=S;return"XMLHTTP REQ ("+m+") [attempt "+T+"]: "+c+`
`+d+`
`+k})}function D_(o,c,d,m,T,S,k){o.info(function(){return"XMLHTTP RESP ("+m+") [ attempt "+T+"]: "+c+`
`+d+`
`+S+" "+k})}function fn(o,c,d,m){o.info(function(){return"XMLHTTP TEXT ("+c+"): "+V_(o,d)+(m?" "+m:"")})}function k_(o,c){o.info(function(){return"TIMEOUT: "+c})}wr.prototype.info=function(){};function V_(o,c){if(!o.g)return c;if(!c)return null;try{var d=JSON.parse(c);if(d){for(o=0;o<d.length;o++)if(Array.isArray(d[o])){var m=d[o];if(!(2>m.length)){var T=m[1];if(Array.isArray(T)&&!(1>T.length)){var S=T[0];if(S!="noop"&&S!="stop"&&S!="close")for(var k=1;k<T.length;k++)T[k]=""}}}}return na(d)}catch{return c}}var Ss={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Lh={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},oa;function bs(){}b(bs,ra),bs.prototype.g=function(){return new XMLHttpRequest},bs.prototype.i=function(){return{}},oa=new bs;function Se(o,c,d,m){this.j=o,this.i=c,this.l=d,this.R=m||1,this.U=new gr(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Bh}function Bh(){this.i=null,this.g="",this.h=!1}var Uh={},aa={};function la(o,c,d){o.L=1,o.v=Ns(he(c)),o.m=d,o.P=!0,qh(o,null)}function qh(o,c){o.F=Date.now(),Rs(o),o.A=he(o.v);var d=o.A,m=o.R;Array.isArray(m)||(m=[String(m)]),ed(d.i,"t",m),o.C=0,d=o.j.J,o.h=new Bh,o.g=vd(o.j,d?c:null,!o.m),0<o.O&&(o.M=new R_(g(o.Y,o,o.g),o.O)),c=o.U,d=o.g,m=o.ca;var T="readystatechange";Array.isArray(T)||(T&&(xh[0]=T.toString()),T=xh);for(var S=0;S<T.length;S++){var k=Th(d,T[S],m||c.handleEvent,!1,c.h||c);if(!k)break;c.g[k.key]=k}c=o.H?_(o.H):{},o.m?(o.u||(o.u="POST"),c["Content-Type"]="application/x-www-form-urlencoded",o.g.ea(o.A,o.u,o.m,c)):(o.u="GET",o.g.ea(o.A,o.u,null,c)),yr(),N_(o.i,o.u,o.A,o.l,o.R,o.m)}Se.prototype.ca=function(o){o=o.target;let c=this.M;c&&de(o)==3?c.j():this.Y(o)},Se.prototype.Y=function(o){try{if(o==this.g)t:{let At=de(this.g);var c=this.g.Ba();let gn=this.g.Z();if(!(3>At)&&(At!=3||this.g&&(this.h.h||this.g.oa()||ld(this.g)))){this.J||At!=4||c==7||(c==8||0>=gn?yr(3):yr(2)),ca(this);var d=this.g.Z();this.X=d;e:if($h(this)){var m=ld(this.g);o="";var T=m.length,S=de(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){qe(this),Er(this);var k="";break e}this.h.i=new l.TextDecoder}for(c=0;c<T;c++)this.h.h=!0,o+=this.h.i.decode(m[c],{stream:!(S&&c==T-1)});m.length=0,this.h.g+=o,this.C=0,k=this.h.g}else k=this.g.oa();if(this.o=d==200,D_(this.i,this.u,this.A,this.l,this.R,At,d),this.o){if(this.T&&!this.K){e:{if(this.g){var tt,yt=this.g;if((tt=yt.g?yt.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!q(tt)){var Y=tt;break e}}Y=null}if(d=Y)fn(this.i,this.l,d,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,ua(this,d);else{this.o=!1,this.s=3,xt(12),qe(this),Er(this);break t}}if(this.P){d=!0;let jt;for(;!this.J&&this.C<k.length;)if(jt=O_(this,k),jt==aa){At==4&&(this.s=4,xt(14),d=!1),fn(this.i,this.l,null,"[Incomplete Response]");break}else if(jt==Uh){this.s=4,xt(15),fn(this.i,this.l,k,"[Invalid Chunk]"),d=!1;break}else fn(this.i,this.l,jt,null),ua(this,jt);if($h(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),At!=4||k.length!=0||this.h.h||(this.s=1,xt(16),d=!1),this.o=this.o&&d,!d)fn(this.i,this.l,k,"[Invalid Chunked Response]"),qe(this),Er(this);else if(0<k.length&&!this.W){this.W=!0;var Tt=this.j;Tt.g==this&&Tt.ba&&!Tt.M&&(Tt.j.info("Great, no buffering proxy detected. Bytes received: "+k.length),ga(Tt),Tt.M=!0,xt(11))}}else fn(this.i,this.l,k,null),ua(this,k);At==4&&qe(this),this.o&&!this.J&&(At==4?pd(this.j,this):(this.o=!1,Rs(this)))}else J_(this.g),d==400&&0<k.indexOf("Unknown SID")?(this.s=3,xt(12)):(this.s=0,xt(13)),qe(this),Er(this)}}}catch{}finally{}};function $h(o){return o.g?o.u=="GET"&&o.L!=2&&o.j.Ca:!1}function O_(o,c){var d=o.C,m=c.indexOf(`
`,d);return m==-1?aa:(d=Number(c.substring(d,m)),isNaN(d)?Uh:(m+=1,m+d>c.length?aa:(c=c.slice(m,m+d),o.C=m+d,c)))}Se.prototype.cancel=function(){this.J=!0,qe(this)};function Rs(o){o.S=Date.now()+o.I,Gh(o,o.I)}function Gh(o,c){if(o.B!=null)throw Error("WatchDog timer not null");o.B=vr(g(o.ba,o),c)}function ca(o){o.B&&(l.clearTimeout(o.B),o.B=null)}Se.prototype.ba=function(){this.B=null;let o=Date.now();0<=o-this.S?(k_(this.i,this.A),this.L!=2&&(yr(),xt(17)),qe(this),this.s=2,Er(this)):Gh(this,this.S-o)};function Er(o){o.j.G==0||o.J||pd(o.j,o)}function qe(o){ca(o);var c=o.M;c&&typeof c.ma=="function"&&c.ma(),o.M=null,Nh(o.U),o.g&&(c=o.g,o.g=null,c.abort(),c.ma())}function ua(o,c){try{var d=o.j;if(d.G!=0&&(d.g==o||ha(d.h,o))){if(!o.K&&ha(d.h,o)&&d.G==3){try{var m=d.Da.g.parse(c)}catch{m=null}if(Array.isArray(m)&&m.length==3){var T=m;if(T[0]==0){t:if(!d.u){if(d.g)if(d.g.F+3e3<o.F)Fs(d),Vs(d);else break t;pa(d),xt(18)}}else d.za=T[1],0<d.za-d.T&&37500>T[2]&&d.F&&d.v==0&&!d.C&&(d.C=vr(g(d.Za,d),6e3));if(1>=Kh(d.h)&&d.ca){try{d.ca()}catch{}d.ca=void 0}}else Ge(d,11)}else if((o.K||d.g==o)&&Fs(d),!q(c))for(T=d.Da.g.parse(c),c=0;c<T.length;c++){let Y=T[c];if(d.T=Y[0],Y=Y[1],d.G==2)if(Y[0]=="c"){d.K=Y[1],d.ia=Y[2];let Tt=Y[3];Tt!=null&&(d.la=Tt,d.j.info("VER="+d.la));let At=Y[4];At!=null&&(d.Aa=At,d.j.info("SVER="+d.Aa));let gn=Y[5];gn!=null&&typeof gn=="number"&&0<gn&&(m=1.5*gn,d.L=m,d.j.info("backChannelRequestTimeoutMs_="+m)),m=d;let jt=o.g;if(jt){let Ls=jt.g?jt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Ls){var S=m.h;S.g||Ls.indexOf("spdy")==-1&&Ls.indexOf("quic")==-1&&Ls.indexOf("h2")==-1||(S.j=S.l,S.g=new Set,S.h&&(da(S,S.h),S.h=null))}if(m.D){let _a=jt.g?jt.g.getResponseHeader("X-HTTP-Session-Id"):null;_a&&(m.ya=_a,rt(m.I,m.D,_a))}}d.G=3,d.l&&d.l.ua(),d.ba&&(d.R=Date.now()-o.F,d.j.info("Handshake RTT: "+d.R+"ms")),m=d;var k=o;if(m.qa=yd(m,m.J?m.ia:null,m.W),k.K){Wh(m.h,k);var tt=k,yt=m.L;yt&&(tt.I=yt),tt.B&&(ca(tt),Rs(tt)),m.g=k}else fd(m);0<d.i.length&&Os(d)}else Y[0]!="stop"&&Y[0]!="close"||Ge(d,7);else d.G==3&&(Y[0]=="stop"||Y[0]=="close"?Y[0]=="stop"?Ge(d,7):ma(d):Y[0]!="noop"&&d.l&&d.l.ta(Y),d.v=0)}}yr(4)}catch{}}var F_=class{constructor(o,c){this.g=o,this.map=c}};function zh(o){this.l=o||10,l.PerformanceNavigationTiming?(o=l.performance.getEntriesByType("navigation"),o=0<o.length&&(o[0].nextHopProtocol=="hq"||o[0].nextHopProtocol=="h2")):o=!!(l.chrome&&l.chrome.loadTimes&&l.chrome.loadTimes()&&l.chrome.loadTimes().wasFetchedViaSpdy),this.j=o?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function jh(o){return o.h?!0:o.g?o.g.size>=o.j:!1}function Kh(o){return o.h?1:o.g?o.g.size:0}function ha(o,c){return o.h?o.h==c:o.g?o.g.has(c):!1}function da(o,c){o.g?o.g.add(c):o.h=c}function Wh(o,c){o.h&&o.h==c?o.h=null:o.g&&o.g.has(c)&&o.g.delete(c)}zh.prototype.cancel=function(){if(this.i=Qh(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let o of this.g.values())o.cancel();this.g.clear()}};function Qh(o){if(o.h!=null)return o.i.concat(o.h.D);if(o.g!=null&&o.g.size!==0){let c=o.i;for(let d of o.g.values())c=c.concat(d.D);return c}return N(o.i)}function M_(o){if(o.V&&typeof o.V=="function")return o.V();if(typeof Map<"u"&&o instanceof Map||typeof Set<"u"&&o instanceof Set)return Array.from(o.values());if(typeof o=="string")return o.split("");if(u(o)){for(var c=[],d=o.length,m=0;m<d;m++)c.push(o[m]);return c}c=[],d=0;for(m in o)c[d++]=o[m];return c}function L_(o){if(o.na&&typeof o.na=="function")return o.na();if(!o.V||typeof o.V!="function"){if(typeof Map<"u"&&o instanceof Map)return Array.from(o.keys());if(!(typeof Set<"u"&&o instanceof Set)){if(u(o)||typeof o=="string"){var c=[];o=o.length;for(var d=0;d<o;d++)c.push(d);return c}c=[],d=0;for(let m in o)c[d++]=m;return c}}}function Hh(o,c){if(o.forEach&&typeof o.forEach=="function")o.forEach(c,void 0);else if(u(o)||typeof o=="string")Array.prototype.forEach.call(o,c,void 0);else for(var d=L_(o),m=M_(o),T=m.length,S=0;S<T;S++)c.call(void 0,m[S],d&&d[S],o)}var Yh=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function B_(o,c){if(o){o=o.split("&");for(var d=0;d<o.length;d++){var m=o[d].indexOf("="),T=null;if(0<=m){var S=o[d].substring(0,m);T=o[d].substring(m+1)}else S=o[d];c(S,T?decodeURIComponent(T.replace(/\+/g," ")):"")}}}function $e(o){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,o instanceof $e){this.h=o.h,Ps(this,o.j),this.o=o.o,this.g=o.g,xs(this,o.s),this.l=o.l;var c=o.i,d=new Ar;d.i=c.i,c.g&&(d.g=new Map(c.g),d.h=c.h),Xh(this,d),this.m=o.m}else o&&(c=String(o).match(Yh))?(this.h=!1,Ps(this,c[1]||"",!0),this.o=Ir(c[2]||""),this.g=Ir(c[3]||"",!0),xs(this,c[4]),this.l=Ir(c[5]||"",!0),Xh(this,c[6]||"",!0),this.m=Ir(c[7]||"")):(this.h=!1,this.i=new Ar(null,this.h))}$e.prototype.toString=function(){var o=[],c=this.j;c&&o.push(Tr(c,Jh,!0),":");var d=this.g;return(d||c=="file")&&(o.push("//"),(c=this.o)&&o.push(Tr(c,Jh,!0),"@"),o.push(encodeURIComponent(String(d)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),d=this.s,d!=null&&o.push(":",String(d))),(d=this.l)&&(this.g&&d.charAt(0)!="/"&&o.push("/"),o.push(Tr(d,d.charAt(0)=="/"?$_:q_,!0))),(d=this.i.toString())&&o.push("?",d),(d=this.m)&&o.push("#",Tr(d,z_)),o.join("")};function he(o){return new $e(o)}function Ps(o,c,d){o.j=d?Ir(c,!0):c,o.j&&(o.j=o.j.replace(/:$/,""))}function xs(o,c){if(c){if(c=Number(c),isNaN(c)||0>c)throw Error("Bad port number "+c);o.s=c}else o.s=null}function Xh(o,c,d){c instanceof Ar?(o.i=c,j_(o.i,o.h)):(d||(c=Tr(c,G_)),o.i=new Ar(c,o.h))}function rt(o,c,d){o.i.set(c,d)}function Ns(o){return rt(o,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),o}function Ir(o,c){return o?c?decodeURI(o.replace(/%25/g,"%2525")):decodeURIComponent(o):""}function Tr(o,c,d){return typeof o=="string"?(o=encodeURI(o).replace(c,U_),d&&(o=o.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),o):null}function U_(o){return o=o.charCodeAt(0),"%"+(o>>4&15).toString(16)+(o&15).toString(16)}var Jh=/[#\/\?@]/g,q_=/[#\?:]/g,$_=/[#\?]/g,G_=/[#\?@]/g,z_=/#/g;function Ar(o,c){this.h=this.g=null,this.i=o||null,this.j=!!c}function be(o){o.g||(o.g=new Map,o.h=0,o.i&&B_(o.i,function(c,d){o.add(decodeURIComponent(c.replace(/\+/g," ")),d)}))}n=Ar.prototype,n.add=function(o,c){be(this),this.i=null,o=mn(this,o);var d=this.g.get(o);return d||this.g.set(o,d=[]),d.push(c),this.h+=1,this};function Zh(o,c){be(o),c=mn(o,c),o.g.has(c)&&(o.i=null,o.h-=o.g.get(c).length,o.g.delete(c))}function td(o,c){return be(o),c=mn(o,c),o.g.has(c)}n.forEach=function(o,c){be(this),this.g.forEach(function(d,m){d.forEach(function(T){o.call(c,T,m,this)},this)},this)},n.na=function(){be(this);let o=Array.from(this.g.values()),c=Array.from(this.g.keys()),d=[];for(let m=0;m<c.length;m++){let T=o[m];for(let S=0;S<T.length;S++)d.push(c[m])}return d},n.V=function(o){be(this);let c=[];if(typeof o=="string")td(this,o)&&(c=c.concat(this.g.get(mn(this,o))));else{o=Array.from(this.g.values());for(let d=0;d<o.length;d++)c=c.concat(o[d])}return c},n.set=function(o,c){return be(this),this.i=null,o=mn(this,o),td(this,o)&&(this.h-=this.g.get(o).length),this.g.set(o,[c]),this.h+=1,this},n.get=function(o,c){return o?(o=this.V(o),0<o.length?String(o[0]):c):c};function ed(o,c,d){Zh(o,c),0<d.length&&(o.i=null,o.g.set(mn(o,c),N(d)),o.h+=d.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";let o=[],c=Array.from(this.g.keys());for(var d=0;d<c.length;d++){var m=c[d];let S=encodeURIComponent(String(m)),k=this.V(m);for(m=0;m<k.length;m++){var T=S;k[m]!==""&&(T+="="+encodeURIComponent(String(k[m]))),o.push(T)}}return this.i=o.join("&")};function mn(o,c){return c=String(c),o.j&&(c=c.toLowerCase()),c}function j_(o,c){c&&!o.j&&(be(o),o.i=null,o.g.forEach(function(d,m){var T=m.toLowerCase();m!=T&&(Zh(this,m),ed(this,T,d))},o)),o.j=c}function K_(o,c){let d=new wr;if(l.Image){let m=new Image;m.onload=A(Re,d,"TestLoadImage: loaded",!0,c,m),m.onerror=A(Re,d,"TestLoadImage: error",!1,c,m),m.onabort=A(Re,d,"TestLoadImage: abort",!1,c,m),m.ontimeout=A(Re,d,"TestLoadImage: timeout",!1,c,m),l.setTimeout(function(){m.ontimeout&&m.ontimeout()},1e4),m.src=o}else c(!1)}function W_(o,c){let d=new wr,m=new AbortController,T=setTimeout(()=>{m.abort(),Re(d,"TestPingServer: timeout",!1,c)},1e4);fetch(o,{signal:m.signal}).then(S=>{clearTimeout(T),S.ok?Re(d,"TestPingServer: ok",!0,c):Re(d,"TestPingServer: server error",!1,c)}).catch(()=>{clearTimeout(T),Re(d,"TestPingServer: error",!1,c)})}function Re(o,c,d,m,T){try{T&&(T.onload=null,T.onerror=null,T.onabort=null,T.ontimeout=null),m(d)}catch{}}function Q_(){this.g=new x_}function H_(o,c,d){let m=d||"";try{Hh(o,function(T,S){let k=T;h(T)&&(k=na(T)),c.push(m+S+"="+encodeURIComponent(k))})}catch(T){throw c.push(m+"type="+encodeURIComponent("_badmap")),T}}function Cr(o){this.l=o.Ub||null,this.j=o.eb||!1}b(Cr,ra),Cr.prototype.g=function(){return new Ds(this.l,this.j)},Cr.prototype.i=function(o){return function(){return o}}({});function Ds(o,c){It.call(this),this.D=o,this.o=c,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}b(Ds,It),n=Ds.prototype,n.open=function(o,c){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=o,this.A=c,this.readyState=1,br(this)},n.send=function(o){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let c={headers:this.u,method:this.B,credentials:this.m,cache:void 0};o&&(c.body=o),(this.D||l).fetch(new Request(this.A,c)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Sr(this)),this.readyState=0},n.Sa=function(o){if(this.g&&(this.l=o,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=o.headers,this.readyState=2,br(this)),this.g&&(this.readyState=3,br(this),this.g)))if(this.responseType==="arraybuffer")o.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof l.ReadableStream<"u"&&"body"in o){if(this.j=o.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;nd(this)}else o.text().then(this.Ra.bind(this),this.ga.bind(this))};function nd(o){o.j.read().then(o.Pa.bind(o)).catch(o.ga.bind(o))}n.Pa=function(o){if(this.g){if(this.o&&o.value)this.response.push(o.value);else if(!this.o){var c=o.value?o.value:new Uint8Array(0);(c=this.v.decode(c,{stream:!o.done}))&&(this.response=this.responseText+=c)}o.done?Sr(this):br(this),this.readyState==3&&nd(this)}},n.Ra=function(o){this.g&&(this.response=this.responseText=o,Sr(this))},n.Qa=function(o){this.g&&(this.response=o,Sr(this))},n.ga=function(){this.g&&Sr(this)};function Sr(o){o.readyState=4,o.l=null,o.j=null,o.v=null,br(o)}n.setRequestHeader=function(o,c){this.u.append(o,c)},n.getResponseHeader=function(o){return this.h&&this.h.get(o.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";let o=[],c=this.h.entries();for(var d=c.next();!d.done;)d=d.value,o.push(d[0]+": "+d[1]),d=c.next();return o.join(`\r
`)};function br(o){o.onreadystatechange&&o.onreadystatechange.call(o)}Object.defineProperty(Ds.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(o){this.m=o?"include":"same-origin"}});function rd(o){let c="";return nt(o,function(d,m){c+=m,c+=":",c+=d,c+=`\r
`}),c}function fa(o,c,d){t:{for(m in d){var m=!1;break t}m=!0}m||(d=rd(d),typeof o=="string"?d!=null&&encodeURIComponent(String(d)):rt(o,c,d))}function at(o){It.call(this),this.headers=new Map,this.o=o||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}b(at,It);var Y_=/^https?$/i,X_=["POST","PUT"];n=at.prototype,n.Ha=function(o){this.J=o},n.ea=function(o,c,d,m){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+o);c=c?c.toUpperCase():"GET",this.D=o,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():oa.g(),this.v=this.o?Dh(this.o):Dh(oa),this.g.onreadystatechange=g(this.Ea,this);try{this.B=!0,this.g.open(c,String(o),!0),this.B=!1}catch(S){sd(this,S);return}if(o=d||"",d=new Map(this.headers),m)if(Object.getPrototypeOf(m)===Object.prototype)for(var T in m)d.set(T,m[T]);else if(typeof m.keys=="function"&&typeof m.get=="function")for(let S of m.keys())d.set(S,m.get(S));else throw Error("Unknown input type for opt_headers: "+String(m));m=Array.from(d.keys()).find(S=>S.toLowerCase()=="content-type"),T=l.FormData&&o instanceof l.FormData,!(0<=Array.prototype.indexOf.call(X_,c,void 0))||m||T||d.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[S,k]of d)this.g.setRequestHeader(S,k);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{ad(this),this.u=!0,this.g.send(o),this.u=!1}catch(S){sd(this,S)}};function sd(o,c){o.h=!1,o.g&&(o.j=!0,o.g.abort(),o.j=!1),o.l=c,o.m=5,id(o),ks(o)}function id(o){o.A||(o.A=!0,Pt(o,"complete"),Pt(o,"error"))}n.abort=function(o){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=o||7,Pt(this,"complete"),Pt(this,"abort"),ks(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),ks(this,!0)),at.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?od(this):this.bb())},n.bb=function(){od(this)};function od(o){if(o.h&&typeof a<"u"&&(!o.v[1]||de(o)!=4||o.Z()!=2)){if(o.u&&de(o)==4)Rh(o.Ea,0,o);else if(Pt(o,"readystatechange"),de(o)==4){o.h=!1;try{let k=o.Z();t:switch(k){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var c=!0;break t;default:c=!1}var d;if(!(d=c)){var m;if(m=k===0){var T=String(o.D).match(Yh)[1]||null;!T&&l.self&&l.self.location&&(T=l.self.location.protocol.slice(0,-1)),m=!Y_.test(T?T.toLowerCase():"")}d=m}if(d)Pt(o,"complete"),Pt(o,"success");else{o.m=6;try{var S=2<de(o)?o.g.statusText:""}catch{S=""}o.l=S+" ["+o.Z()+"]",id(o)}}finally{ks(o)}}}}function ks(o,c){if(o.g){ad(o);let d=o.g,m=o.v[0]?()=>{}:null;o.g=null,o.v=null,c||Pt(o,"ready");try{d.onreadystatechange=m}catch{}}}function ad(o){o.I&&(l.clearTimeout(o.I),o.I=null)}n.isActive=function(){return!!this.g};function de(o){return o.g?o.g.readyState:0}n.Z=function(){try{return 2<de(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(o){if(this.g){var c=this.g.responseText;return o&&c.indexOf(o)==0&&(c=c.substring(o.length)),P_(c)}};function ld(o){try{if(!o.g)return null;if("response"in o.g)return o.g.response;switch(o.H){case"":case"text":return o.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in o.g)return o.g.mozResponseArrayBuffer}return null}catch{return null}}function J_(o){let c={};o=(o.g&&2<=de(o)&&o.g.getAllResponseHeaders()||"").split(`\r
`);for(let m=0;m<o.length;m++){if(q(o[m]))continue;var d=E(o[m]);let T=d[0];if(d=d[1],typeof d!="string")continue;d=d.trim();let S=c[T]||[];c[T]=S,S.push(d)}I(c,function(m){return m.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Rr(o,c,d){return d&&d.internalChannelParams&&d.internalChannelParams[o]||c}function cd(o){this.Aa=0,this.i=[],this.j=new wr,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Rr("failFast",!1,o),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Rr("baseRetryDelayMs",5e3,o),this.cb=Rr("retryDelaySeedMs",1e4,o),this.Wa=Rr("forwardChannelMaxRetries",2,o),this.wa=Rr("forwardChannelRequestTimeoutMs",2e4,o),this.pa=o&&o.xmlHttpFactory||void 0,this.Xa=o&&o.Tb||void 0,this.Ca=o&&o.useFetchStreams||!1,this.L=void 0,this.J=o&&o.supportsCrossDomainXhr||!1,this.K="",this.h=new zh(o&&o.concurrentRequestLimit),this.Da=new Q_,this.P=o&&o.fastHandshake||!1,this.O=o&&o.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=o&&o.Rb||!1,o&&o.xa&&this.j.xa(),o&&o.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&o&&o.detectBufferingProxy||!1,this.ja=void 0,o&&o.longPollingTimeout&&0<o.longPollingTimeout&&(this.ja=o.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=cd.prototype,n.la=8,n.G=1,n.connect=function(o,c,d,m){xt(0),this.W=o,this.H=c||{},d&&m!==void 0&&(this.H.OSID=d,this.H.OAID=m),this.F=this.X,this.I=yd(this,null,this.W),Os(this)};function ma(o){if(ud(o),o.G==3){var c=o.U++,d=he(o.I);if(rt(d,"SID",o.K),rt(d,"RID",c),rt(d,"TYPE","terminate"),Pr(o,d),c=new Se(o,o.j,c),c.L=2,c.v=Ns(he(d)),d=!1,l.navigator&&l.navigator.sendBeacon)try{d=l.navigator.sendBeacon(c.v.toString(),"")}catch{}!d&&l.Image&&(new Image().src=c.v,d=!0),d||(c.g=vd(c.j,null),c.g.ea(c.v)),c.F=Date.now(),Rs(c)}_d(o)}function Vs(o){o.g&&(ga(o),o.g.cancel(),o.g=null)}function ud(o){Vs(o),o.u&&(l.clearTimeout(o.u),o.u=null),Fs(o),o.h.cancel(),o.s&&(typeof o.s=="number"&&l.clearTimeout(o.s),o.s=null)}function Os(o){if(!jh(o.h)&&!o.s){o.s=!0;var c=o.Ga;dr||Ih(),fr||(dr(),fr=!0),Wo.add(c,o),o.B=0}}function Z_(o,c){return Kh(o.h)>=o.h.j-(o.s?1:0)?!1:o.s?(o.i=c.D.concat(o.i),!0):o.G==1||o.G==2||o.B>=(o.Va?0:o.Wa)?!1:(o.s=vr(g(o.Ga,o,c),gd(o,o.B)),o.B++,!0)}n.Ga=function(o){if(this.s)if(this.s=null,this.G==1){if(!o){this.U=Math.floor(1e5*Math.random()),o=this.U++;let T=new Se(this,this.j,o),S=this.o;if(this.S&&(S?(S=_(S),w(S,this.S)):S=this.S),this.m!==null||this.O||(T.H=S,S=null),this.P)t:{for(var c=0,d=0;d<this.i.length;d++){e:{var m=this.i[d];if("__data__"in m.map&&(m=m.map.__data__,typeof m=="string")){m=m.length;break e}m=void 0}if(m===void 0)break;if(c+=m,4096<c){c=d;break t}if(c===4096||d===this.i.length-1){c=d+1;break t}}c=1e3}else c=1e3;c=dd(this,T,c),d=he(this.I),rt(d,"RID",o),rt(d,"CVER",22),this.D&&rt(d,"X-HTTP-Session-Id",this.D),Pr(this,d),S&&(this.O?c="headers="+encodeURIComponent(String(rd(S)))+"&"+c:this.m&&fa(d,this.m,S)),da(this.h,T),this.Ua&&rt(d,"TYPE","init"),this.P?(rt(d,"$req",c),rt(d,"SID","null"),T.T=!0,la(T,d,null)):la(T,d,c),this.G=2}}else this.G==3&&(o?hd(this,o):this.i.length==0||jh(this.h)||hd(this))};function hd(o,c){var d;c?d=c.l:d=o.U++;let m=he(o.I);rt(m,"SID",o.K),rt(m,"RID",d),rt(m,"AID",o.T),Pr(o,m),o.m&&o.o&&fa(m,o.m,o.o),d=new Se(o,o.j,d,o.B+1),o.m===null&&(d.H=o.o),c&&(o.i=c.D.concat(o.i)),c=dd(o,d,1e3),d.I=Math.round(.5*o.wa)+Math.round(.5*o.wa*Math.random()),da(o.h,d),la(d,m,c)}function Pr(o,c){o.H&&nt(o.H,function(d,m){rt(c,m,d)}),o.l&&Hh({},function(d,m){rt(c,m,d)})}function dd(o,c,d){d=Math.min(o.i.length,d);var m=o.l?g(o.l.Na,o.l,o):null;t:{var T=o.i;let S=-1;for(;;){let k=["count="+d];S==-1?0<d?(S=T[0].g,k.push("ofs="+S)):S=0:k.push("ofs="+S);let tt=!0;for(let yt=0;yt<d;yt++){let Y=T[yt].g,Tt=T[yt].map;if(Y-=S,0>Y)S=Math.max(0,T[yt].g-100),tt=!1;else try{H_(Tt,k,"req"+Y+"_")}catch{m&&m(Tt)}}if(tt){m=k.join("&");break t}}}return o=o.i.splice(0,d),c.D=o,m}function fd(o){if(!o.g&&!o.u){o.Y=1;var c=o.Fa;dr||Ih(),fr||(dr(),fr=!0),Wo.add(c,o),o.v=0}}function pa(o){return o.g||o.u||3<=o.v?!1:(o.Y++,o.u=vr(g(o.Fa,o),gd(o,o.v)),o.v++,!0)}n.Fa=function(){if(this.u=null,md(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var o=2*this.R;this.j.info("BP detection timer enabled: "+o),this.A=vr(g(this.ab,this),o)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,xt(10),Vs(this),md(this))};function ga(o){o.A!=null&&(l.clearTimeout(o.A),o.A=null)}function md(o){o.g=new Se(o,o.j,"rpc",o.Y),o.m===null&&(o.g.H=o.o),o.g.O=0;var c=he(o.qa);rt(c,"RID","rpc"),rt(c,"SID",o.K),rt(c,"AID",o.T),rt(c,"CI",o.F?"0":"1"),!o.F&&o.ja&&rt(c,"TO",o.ja),rt(c,"TYPE","xmlhttp"),Pr(o,c),o.m&&o.o&&fa(c,o.m,o.o),o.L&&(o.g.I=o.L);var d=o.g;o=o.ia,d.L=1,d.v=Ns(he(c)),d.m=null,d.P=!0,qh(d,o)}n.Za=function(){this.C!=null&&(this.C=null,Vs(this),pa(this),xt(19))};function Fs(o){o.C!=null&&(l.clearTimeout(o.C),o.C=null)}function pd(o,c){var d=null;if(o.g==c){Fs(o),ga(o),o.g=null;var m=2}else if(ha(o.h,c))d=c.D,Wh(o.h,c),m=1;else return;if(o.G!=0){if(c.o)if(m==1){d=c.m?c.m.length:0,c=Date.now()-c.F;var T=o.B;m=Cs(),Pt(m,new Mh(m,d)),Os(o)}else fd(o);else if(T=c.s,T==3||T==0&&0<c.X||!(m==1&&Z_(o,c)||m==2&&pa(o)))switch(d&&0<d.length&&(c=o.h,c.i=c.i.concat(d)),T){case 1:Ge(o,5);break;case 4:Ge(o,10);break;case 3:Ge(o,6);break;default:Ge(o,2)}}}function gd(o,c){let d=o.Ta+Math.floor(Math.random()*o.cb);return o.isActive()||(d*=2),d*c}function Ge(o,c){if(o.j.info("Error code "+c),c==2){var d=g(o.fb,o),m=o.Xa;let T=!m;m=new $e(m||"//www.google.com/images/cleardot.gif"),l.location&&l.location.protocol=="http"||Ps(m,"https"),Ns(m),T?K_(m.toString(),d):W_(m.toString(),d)}else xt(2);o.G=0,o.l&&o.l.sa(c),_d(o),ud(o)}n.fb=function(o){o?(this.j.info("Successfully pinged google.com"),xt(2)):(this.j.info("Failed to ping google.com"),xt(1))};function _d(o){if(o.G=0,o.ka=[],o.l){let c=Qh(o.h);(c.length!=0||o.i.length!=0)&&(x(o.ka,c),x(o.ka,o.i),o.h.i.length=0,N(o.i),o.i.length=0),o.l.ra()}}function yd(o,c,d){var m=d instanceof $e?he(d):new $e(d);if(m.g!="")c&&(m.g=c+"."+m.g),xs(m,m.s);else{var T=l.location;m=T.protocol,c=c?c+"."+T.hostname:T.hostname,T=+T.port;var S=new $e(null);m&&Ps(S,m),c&&(S.g=c),T&&xs(S,T),d&&(S.l=d),m=S}return d=o.D,c=o.ya,d&&c&&rt(m,d,c),rt(m,"VER",o.la),Pr(o,m),m}function vd(o,c,d){if(c&&!o.J)throw Error("Can't create secondary domain capable XhrIo object.");return c=o.Ca&&!o.pa?new at(new Cr({eb:d})):new at(o.pa),c.Ha(o.J),c}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function wd(){}n=wd.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function Ms(){}Ms.prototype.g=function(o,c){return new Ft(o,c)};function Ft(o,c){It.call(this),this.g=new cd(c),this.l=o,this.h=c&&c.messageUrlParams||null,o=c&&c.messageHeaders||null,c&&c.clientProtocolHeaderRequired&&(o?o["X-Client-Protocol"]="webchannel":o={"X-Client-Protocol":"webchannel"}),this.g.o=o,o=c&&c.initMessageHeaders||null,c&&c.messageContentType&&(o?o["X-WebChannel-Content-Type"]=c.messageContentType:o={"X-WebChannel-Content-Type":c.messageContentType}),c&&c.va&&(o?o["X-WebChannel-Client-Profile"]=c.va:o={"X-WebChannel-Client-Profile":c.va}),this.g.S=o,(o=c&&c.Sb)&&!q(o)&&(this.g.m=o),this.v=c&&c.supportsCrossDomainXhr||!1,this.u=c&&c.sendRawJson||!1,(c=c&&c.httpSessionIdParam)&&!q(c)&&(this.g.D=c,o=this.h,o!==null&&c in o&&(o=this.h,c in o&&delete o[c])),this.j=new pn(this)}b(Ft,It),Ft.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Ft.prototype.close=function(){ma(this.g)},Ft.prototype.o=function(o){var c=this.g;if(typeof o=="string"){var d={};d.__data__=o,o=d}else this.u&&(d={},d.__data__=na(o),o=d);c.i.push(new F_(c.Ya++,o)),c.G==3&&Os(c)},Ft.prototype.N=function(){this.g.l=null,delete this.j,ma(this.g),delete this.g,Ft.aa.N.call(this)};function Ed(o){sa.call(this),o.__headers__&&(this.headers=o.__headers__,this.statusCode=o.__status__,delete o.__headers__,delete o.__status__);var c=o.__sm__;if(c){t:{for(let d in c){o=d;break t}o=void 0}(this.i=o)&&(o=this.i,c=c!==null&&o in c?c[o]:void 0),this.data=c}else this.data=o}b(Ed,sa);function Id(){ia.call(this),this.status=1}b(Id,ia);function pn(o){this.g=o}b(pn,wd),pn.prototype.ua=function(){Pt(this.g,"a")},pn.prototype.ta=function(o){Pt(this.g,new Ed(o))},pn.prototype.sa=function(o){Pt(this.g,new Id)},pn.prototype.ra=function(){Pt(this.g,"b")},Ms.prototype.createWebChannel=Ms.prototype.g,Ft.prototype.send=Ft.prototype.o,Ft.prototype.open=Ft.prototype.m,Ft.prototype.close=Ft.prototype.close,Ca=pe.createWebChannelTransport=function(){return new Ms},Aa=pe.getStatEventTarget=function(){return Cs()},Ta=pe.Event=Ue,hi=pe.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Ss.NO_ERROR=0,Ss.TIMEOUT=8,Ss.HTTP_ERROR=6,Dr=pe.ErrorCode=Ss,Lh.COMPLETE="complete",Ia=pe.EventType=Lh,kh.EventType=_r,_r.OPEN="a",_r.CLOSE="b",_r.ERROR="c",_r.MESSAGE="d",It.prototype.listen=It.prototype.K,En=pe.WebChannel=kh,ty=pe.FetchXmlHttpFactory=Cr,at.prototype.listenOnce=at.prototype.L,at.prototype.getLastError=at.prototype.Ka,at.prototype.getLastErrorCode=at.prototype.Ba,at.prototype.getStatus=at.prototype.Z,at.prototype.getResponseJson=at.prototype.Oa,at.prototype.getResponseText=at.prototype.oa,at.prototype.send=at.prototype.ea,at.prototype.setWithCredentials=at.prototype.Ha,Ea=pe.XhrIo=at}).apply(typeof ui<"u"?ui:typeof self<"u"?self:typeof window<"u"?window:{});var zd="@firebase/firestore",jd="4.7.17";var gt=class{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}};gt.UNAUTHENTICATED=new gt(null),gt.GOOGLE_CREDENTIALS=new gt("google-credentials-uid"),gt.FIRST_PARTY=new gt("first-party-uid"),gt.MOCK_USER=new gt("mock-user");var Gn="11.9.0";var Ye=new Ys("@firebase/firestore");function In(){return Ye.logLevel}function V(n,...t){if(Ye.logLevel<=Ut.DEBUG){let e=t.map(fc);Ye.debug(`Firestore (${Gn}): ${n}`,...e)}}function ge(n,...t){if(Ye.logLevel<=Ut.ERROR){let e=t.map(fc);Ye.error(`Firestore (${Gn}): ${n}`,...e)}}function Pn(n,...t){if(Ye.logLevel<=Ut.WARN){let e=t.map(fc);Ye.warn(`Firestore (${Gn}): ${n}`,...e)}}function fc(n){if(typeof n=="string")return n;try{return function(e){return JSON.stringify(e)}(n)}catch{return n}}function F(n,t,e){let r="Unexpected state";typeof t=="string"?r=t:e=t,Vf(n,r,e)}function Vf(n,t,e){let r=`FIRESTORE (${Gn}) INTERNAL ASSERTION FAILED: ${t} (ID: ${n.toString(16)})`;if(e!==void 0)try{r+=" CONTEXT: "+JSON.stringify(e)}catch{r+=" CONTEXT: "+e}throw ge(r),new Error(r)}function Z(n,t,e,r){let s="Unexpected state";typeof e=="string"?s=e:r=e,n||Vf(t,s,r)}function L(n,t){return n}var P={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},O=class extends Vd{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var te=class{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}};var yi=class{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}},xa=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable(()=>e(gt.UNAUTHENTICATED))}shutdown(){}},Na=class{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable(()=>e(this.token.user))}shutdown(){this.changeListener=null}},Da=class{constructor(t){this.t=t,this.currentUser=gt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){Z(this.o===void 0,42304);let r=this.i,s=u=>this.i!==r?(r=this.i,e(u)):Promise.resolve(),i=new te;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new te,t.enqueueRetryable(()=>s(this.currentUser))};let a=()=>{let u=i;t.enqueueRetryable(async()=>{await u.promise,await s(this.currentUser)})},l=u=>{V("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(u=>l(u)),setTimeout(()=>{if(!this.auth){let u=this.t.getImmediate({optional:!0});u?l(u):(V("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new te)}},0),a()}getToken(){let t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(r=>this.i!==t?(V("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Z(typeof r.accessToken=="string",31837,{l:r}),new yi(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let t=this.auth&&this.auth.getUid();return Z(t===null||typeof t=="string",2055,{h:t}),new gt(t)}},ka=class{constructor(t,e,r){this.P=t,this.T=e,this.I=r,this.type="FirstParty",this.user=gt.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);let t=this.R();return t&&this.A.set("Authorization",t),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}},Va=class{constructor(t,e,r){this.P=t,this.T=e,this.I=r}getToken(){return Promise.resolve(new ka(this.P,this.T,this.I))}start(t,e){t.enqueueRetryable(()=>e(gt.FIRST_PARTY))}shutdown(){}invalidateToken(){}},vi=class{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},Oa=class{constructor(t,e){this.V=e,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Zs(t)&&t.settings.appCheckToken&&(this.p=t.settings.appCheckToken)}start(t,e){Z(this.o===void 0,3512);let r=i=>{i.error!=null&&V("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);let a=i.token!==this.m;return this.m=i.token,V("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?e(i.token):Promise.resolve()};this.o=i=>{t.enqueueRetryable(()=>r(i))};let s=i=>{V("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){let i=this.V.getImmediate({optional:!0});i?s(i):V("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new vi(this.p));let t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(e=>e?(Z(typeof e.token=="string",44558,{tokenResult:e}),this.m=e.token,new vi(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}};function ey(n){let t=typeof self<"u"&&(self.crypto||self.msCrypto),e=new Uint8Array(n);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(e);else for(let r=0;r<n;r++)e[r]=Math.floor(256*Math.random());return e}function Of(){return new TextEncoder}var wi=class{static newId(){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=62*Math.floor(4.129032258064516),r="";for(;r.length<20;){let s=ey(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<e&&(r+=t.charAt(s[i]%62))}return r}};function G(n,t){return n<t?-1:n>t?1:0}function Fa(n,t){let e=0;for(;e<n.length&&e<t.length;){let r=n.codePointAt(e),s=t.codePointAt(e);if(r!==s){if(r<128&&s<128)return G(r,s);{let i=Of(),a=ny(i.encode(Kd(n,e)),i.encode(Kd(t,e)));return a!==0?a:G(r,s)}}e+=r>65535?2:1}return G(n.length,t.length)}function Kd(n,t){return n.codePointAt(t)>65535?n.substring(t,t+2):n.substring(t,t+1)}function ny(n,t){for(let e=0;e<n.length&&e<t.length;++e)if(n[e]!==t[e])return G(n[e],t[e]);return G(n.length,t.length)}function xn(n,t,e){return n.length===t.length&&n.every((r,s)=>e(r,t[s]))}var Wd=-62135596800,Qd=1e6,vt=class n{static now(){return n.fromMillis(Date.now())}static fromDate(t){return n.fromMillis(t.getTime())}static fromMillis(t){let e=Math.floor(t/1e3),r=Math.floor((t-1e3*e)*Qd);return new n(e,r)}constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new O(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new O(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<Wd)throw new O(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new O(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Qd}_compareTo(t){return this.seconds===t.seconds?G(this.nanoseconds,t.nanoseconds):G(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let t=this.seconds-Wd;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var B=class n{static fromTimestamp(t){return new n(t)}static min(){return new n(new vt(0,0))}static max(){return new n(new vt(253402300799,999999999))}constructor(t){this.timestamp=t}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var Hd="__name__",Ei=class n{constructor(t,e,r){e===void 0?e=0:e>t.length&&F(637,{offset:e,range:t.length}),r===void 0?r=t.length-e:r>t.length-e&&F(1746,{length:r,range:t.length-e}),this.segments=t,this.offset=e,this.len=r}get length(){return this.len}isEqual(t){return n.comparator(this,t)===0}child(t){let e=this.segments.slice(this.offset,this.limit());return t instanceof n?t.forEach(r=>{e.push(r)}):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,r=this.limit();e<r;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){let r=Math.min(t.length,e.length);for(let s=0;s<r;s++){let i=n.compareSegments(t.get(s),e.get(s));if(i!==0)return i}return G(t.length,e.length)}static compareSegments(t,e){let r=n.isNumericId(t),s=n.isNumericId(e);return r&&!s?-1:!r&&s?1:r&&s?n.extractNumericId(t).compare(n.extractNumericId(e)):Fa(t,e)}static isNumericId(t){return t.startsWith("__id")&&t.endsWith("__")}static extractNumericId(t){return me.fromString(t.substring(4,t.length-2))}},dt=class n extends Ei{construct(t,e,r){return new n(t,e,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){let e=[];for(let r of t){if(r.indexOf("//")>=0)throw new O(P.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);e.push(...r.split("/").filter(s=>s.length>0))}return new n(e)}static emptyPath(){return new n([])}},ry=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Lt=class n extends Ei{construct(t,e,r){return new n(t,e,r)}static isValidIdentifier(t){return ry.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Hd}static keyField(){return new n([Hd])}static fromServerFormat(t){let e=[],r="",s=0,i=()=>{if(r.length===0)throw new O(P.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(r),r=""},a=!1;for(;s<t.length;){let l=t[s];if(l==="\\"){if(s+1===t.length)throw new O(P.INVALID_ARGUMENT,"Path has trailing escape character: "+t);let u=t[s+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new O(P.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=u,s+=2}else l==="`"?(a=!a,s++):l!=="."||a?(r+=l,s++):(i(),s++)}if(i(),a)throw new O(P.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new n(e)}static emptyPath(){return new n([])}};var M=class n{constructor(t){this.path=t}static fromPath(t){return new n(dt.fromString(t))}static fromName(t){return new n(dt.fromString(t).popFirst(5))}static empty(){return new n(dt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&dt.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,e){return dt.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new n(new dt(t.slice()))}};var Lr=-1,Ma=class{constructor(t,e,r,s){this.indexId=t,this.collectionGroup=e,this.fields=r,this.indexState=s}};Ma.UNKNOWN_ID=-1;function sy(n,t){let e=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=B.fromTimestamp(r===1e9?new vt(e+1,0):new vt(e,r));return new Xe(s,M.empty(),t)}function iy(n){return new Xe(n.readTime,n.key,Lr)}var Xe=class n{constructor(t,e,r){this.readTime=t,this.documentKey=e,this.largestBatchId=r}static min(){return new n(B.min(),M.empty(),Lr)}static max(){return new n(B.max(),M.empty(),Lr)}};function oy(n,t){let e=n.readTime.compareTo(t.readTime);return e!==0?e:(e=M.comparator(n.documentKey,t.documentKey),e!==0?e:G(n.largestBatchId,t.largestBatchId))}var ay="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",La=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}};async function zn(n){if(n.code!==P.FAILED_PRECONDITION||n.message!==ay)throw n;V("LocalStore","Unexpectedly lost primary lease")}var R=class n{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&F(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new n((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(t,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(e,i).next(r,s)}})}toPromise(){return new Promise((t,e)=>{this.next(t,e)})}wrapUserFunction(t){try{let e=t();return e instanceof n?e:n.resolve(e)}catch(e){return n.reject(e)}}wrapSuccess(t,e){return t?this.wrapUserFunction(()=>t(e)):n.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction(()=>t(e)):n.reject(e)}static resolve(t){return new n((e,r)=>{e(t)})}static reject(t){return new n((e,r)=>{r(t)})}static waitFor(t){return new n((e,r)=>{let s=0,i=0,a=!1;t.forEach(l=>{++s,l.next(()=>{++i,a&&i===s&&e()},u=>r(u))}),a=!0,i===s&&e()})}static or(t){let e=n.resolve(!1);for(let r of t)e=e.next(s=>s?n.resolve(s):r());return e}static forEach(t,e){let r=[];return t.forEach((s,i)=>{r.push(e.call(this,s,i))}),this.waitFor(r)}static mapArray(t,e){return new n((r,s)=>{let i=t.length,a=new Array(i),l=0;for(let u=0;u<i;u++){let h=u;e(t[h]).next(f=>{a[h]=f,++l,l===i&&r(a)},f=>s(f))}})}static doWhile(t,e){return new n((r,s)=>{let i=()=>{t()===!0?e().next(()=>{i()},s):r()};i()})}};function ly(n){let t=n.match(/Android ([\d.]+)/i),e=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(e)}function jn(n){return n.name==="IndexedDbTransactionError"}var mc=(()=>{class n{constructor(e,r){this.previousValue=e,r&&(r.sequenceNumberHandler=s=>this.ue(s),this.ce=s=>r.writeSequenceNumber(s))}ue(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.ce&&this.ce(e),e}}n.le=-1;return n})(),pc=-1;function ro(n){return n==null}function Br(n){return n===0&&1/n==-1/0}function cy(n){return typeof n=="number"&&Number.isInteger(n)&&!Br(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}var Ff="";function uy(n){let t="";for(let e=0;e<n.length;e++)t.length>0&&(t=Yd(t)),t=hy(n.get(e),t);return Yd(t)}function hy(n,t){let e=t,r=n.length;for(let s=0;s<r;s++){let i=n.charAt(s);switch(i){case"\0":e+="";break;case Ff:e+="";break;default:e+=i}}return e}function Yd(n){return n+Ff+""}var dy="remoteDocuments",Mf="owner";var Lf="mutationQueues";var Bf="mutations";var Uf="documentMutations",fy="remoteDocumentsV14";var qf="remoteDocumentGlobal";var $f="targets";var Gf="targetDocuments";var zf="targetGlobal",jf="collectionParents";var Kf="clientMetadata";var Wf="bundles";var Qf="namedQueries";var my="indexConfiguration";var py="indexState";var gy="indexEntries";var Hf="documentOverlays";var _y="globals";var yy=[Lf,Bf,Uf,dy,$f,Mf,zf,Gf,Kf,qf,jf,Wf,Qf],hT=[...yy,Hf],vy=[Lf,Bf,Uf,fy,$f,Mf,zf,Gf,Kf,qf,jf,Wf,Qf,Hf],wy=vy,Ey=[...wy,my,py,gy];var dT=[...Ey,_y];function Xd(n){let t=0;for(let e in n)Object.prototype.hasOwnProperty.call(n,e)&&t++;return t}function Fe(n,t){for(let e in n)Object.prototype.hasOwnProperty.call(n,e)&&t(e,n[e])}function Yf(n){for(let t in n)if(Object.prototype.hasOwnProperty.call(n,t))return!1;return!0}var lt=class n{constructor(t,e){this.comparator=t,this.root=e||ee.EMPTY}insert(t,e){return new n(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,ee.BLACK,null,null))}remove(t){return new n(this.comparator,this.root.remove(t,this.comparator).copy(null,null,ee.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){let r=this.comparator(t,e.key);if(r===0)return e.value;r<0?e=e.left:r>0&&(e=e.right)}return null}indexOf(t){let e=0,r=this.root;for(;!r.isEmpty();){let s=this.comparator(t,r.key);if(s===0)return e+r.left.size;s<0?r=r.left:(e+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((e,r)=>(t(e,r),!1))}toString(){let t=[];return this.inorderTraversal((e,r)=>(t.push(`${e}:${r}`),!1)),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new Sn(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new Sn(this.root,t,this.comparator,!1)}getReverseIterator(){return new Sn(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new Sn(this.root,t,this.comparator,!0)}},Sn=class{constructor(t,e,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!t.isEmpty();)if(i=e?r(t.key,e):1,e&&s&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(i===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}},ee=class n{constructor(t,e,r,s,i){this.key=t,this.value=e,this.color=r??n.RED,this.left=s??n.EMPTY,this.right=i??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,r,s,i){return new n(t??this.key,e??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,r){let s=this,i=r(t,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(t,e,r),null):i===0?s.copy(null,e,null,null,null):s.copy(null,null,null,null,s.right.insert(t,e,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let r,s=this;if(e(t,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,e),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),e(t,s.key)===0){if(s.right.isEmpty())return n.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,e))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){let t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){let t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw F(43730,{key:this.key,value:this.value});if(this.right.isRed())throw F(14113,{key:this.key,value:this.value});let t=this.left.check();if(t!==this.right.check())throw F(27949);return t+(this.isRed()?0:1)}};ee.EMPTY=null,ee.RED=!0,ee.BLACK=!1;ee.EMPTY=new class{constructor(){this.size=0}get key(){throw F(57766)}get value(){throw F(16141)}get color(){throw F(16727)}get left(){throw F(29726)}get right(){throw F(36894)}copy(t,e,r,s,i){return this}insert(t,e,r){return new ee(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var _t=class n{constructor(t){this.comparator=t,this.data=new lt(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((e,r)=>(t(e),!1))}forEachInRange(t,e){let r=this.data.getIteratorFrom(t[0]);for(;r.hasNext();){let s=r.getNext();if(this.comparator(s.key,t[1])>=0)return;e(s.key)}}forEachWhile(t,e){let r;for(r=e!==void 0?this.data.getIteratorFrom(e):this.data.getIterator();r.hasNext();)if(!t(r.getNext().key))return}firstAfterOrEqual(t){let e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new Ii(this.data.getIterator())}getIteratorFrom(t){return new Ii(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach(r=>{e=e.add(r)}),e}isEqual(t){if(!(t instanceof n)||this.size!==t.size)return!1;let e=this.data.getIterator(),r=t.data.getIterator();for(;e.hasNext();){let s=e.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){let t=[];return this.forEach(e=>{t.push(e)}),t}toString(){let t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(t){let e=new n(this.comparator);return e.data=t,e}},Ii=class{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};var $t=class n{constructor(t){this.fields=t,t.sort(Lt.comparator)}static empty(){return new n([])}unionWith(t){let e=new _t(Lt.comparator);for(let r of this.fields)e=e.add(r);for(let r of t)e=e.add(r);return new n(e.toArray())}covers(t){for(let e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return xn(this.fields,t.fields,(e,r)=>e.isEqual(r))}};var Ti=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var bt=class n{constructor(t){this.binaryString=t}static fromBase64String(t){let e=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new Ti("Invalid base64 string: "+i):i}}(t);return new n(e)}static fromUint8Array(t){let e=function(s){let i="";for(let a=0;a<s.length;++a)i+=String.fromCharCode(s[a]);return i}(t);return new n(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(e){return btoa(e)}(this.binaryString)}toUint8Array(){return function(e){let r=new Uint8Array(e.length);for(let s=0;s<e.length;s++)r[s]=e.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return G(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}};bt.EMPTY_BYTE_STRING=new bt("");var Iy=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function _e(n){if(Z(!!n,39018),typeof n=="string"){let t=0,e=Iy.exec(n);if(Z(!!e,46558,{timestamp:n}),e[1]){let s=e[1];s=(s+"000000000").substr(0,9),t=Number(s)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:it(n.seconds),nanos:it(n.nanos)}}function it(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function ye(n){return typeof n=="string"?bt.fromBase64String(n):bt.fromUint8Array(n)}var Xf="server_timestamp",Jf="__type__",Zf="__previous_value__",tm="__local_write_time__";function gc(n){var t,e;return((e=(((t=n?.mapValue)===null||t===void 0?void 0:t.fields)||{})[Jf])===null||e===void 0?void 0:e.stringValue)===Xf}function so(n){let t=n.mapValue.fields[Zf];return gc(t)?so(t):t}function Ur(n){let t=_e(n.mapValue.fields[tm].timestampValue);return new vt(t.seconds,t.nanos)}var Ba=class{constructor(t,e,r,s,i,a,l,u,h,f){this.databaseId=t,this.appId=e,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=a,this.autoDetectLongPolling=l,this.longPollingOptions=u,this.useFetchStreams=h,this.isUsingEmulator=f}},Ai="(default)",Ci=class n{constructor(t,e){this.projectId=t,this.database=e||Ai}static empty(){return new n("","")}get isDefaultDatabase(){return this.database===Ai}isEqual(t){return t instanceof n&&t.projectId===this.projectId&&t.database===this.database}};var _c="__type__",em="__max__",di={mapValue:{fields:{__type__:{stringValue:em}}}},yc="__vector__",Nn="value";function xe(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?gc(n)?4:rm(n)?9007199254740991:nm(n)?10:11:F(28295,{value:n})}function ie(n,t){if(n===t)return!0;let e=xe(n);if(e!==xe(t))return!1;switch(e){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===t.booleanValue;case 4:return Ur(n).isEqual(Ur(t));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;let a=_e(s.timestampValue),l=_e(i.timestampValue);return a.seconds===l.seconds&&a.nanos===l.nanos}(n,t);case 5:return n.stringValue===t.stringValue;case 6:return function(s,i){return ye(s.bytesValue).isEqual(ye(i.bytesValue))}(n,t);case 7:return n.referenceValue===t.referenceValue;case 8:return function(s,i){return it(s.geoPointValue.latitude)===it(i.geoPointValue.latitude)&&it(s.geoPointValue.longitude)===it(i.geoPointValue.longitude)}(n,t);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return it(s.integerValue)===it(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){let a=it(s.doubleValue),l=it(i.doubleValue);return a===l?Br(a)===Br(l):isNaN(a)&&isNaN(l)}return!1}(n,t);case 9:return xn(n.arrayValue.values||[],t.arrayValue.values||[],ie);case 10:case 11:return function(s,i){let a=s.mapValue.fields||{},l=i.mapValue.fields||{};if(Xd(a)!==Xd(l))return!1;for(let u in a)if(a.hasOwnProperty(u)&&(l[u]===void 0||!ie(a[u],l[u])))return!1;return!0}(n,t);default:return F(52216,{left:n})}}function qr(n,t){return(n.values||[]).find(e=>ie(e,t))!==void 0}function Dn(n,t){if(n===t)return 0;let e=xe(n),r=xe(t);if(e!==r)return G(e,r);switch(e){case 0:case 9007199254740991:return 0;case 1:return G(n.booleanValue,t.booleanValue);case 2:return function(i,a){let l=it(i.integerValue||i.doubleValue),u=it(a.integerValue||a.doubleValue);return l<u?-1:l>u?1:l===u?0:isNaN(l)?isNaN(u)?0:-1:1}(n,t);case 3:return Jd(n.timestampValue,t.timestampValue);case 4:return Jd(Ur(n),Ur(t));case 5:return Fa(n.stringValue,t.stringValue);case 6:return function(i,a){let l=ye(i),u=ye(a);return l.compareTo(u)}(n.bytesValue,t.bytesValue);case 7:return function(i,a){let l=i.split("/"),u=a.split("/");for(let h=0;h<l.length&&h<u.length;h++){let f=G(l[h],u[h]);if(f!==0)return f}return G(l.length,u.length)}(n.referenceValue,t.referenceValue);case 8:return function(i,a){let l=G(it(i.latitude),it(a.latitude));return l!==0?l:G(it(i.longitude),it(a.longitude))}(n.geoPointValue,t.geoPointValue);case 9:return Zd(n.arrayValue,t.arrayValue);case 10:return function(i,a){var l,u,h,f;let p=i.fields||{},g=a.fields||{},A=(l=p[Nn])===null||l===void 0?void 0:l.arrayValue,b=(u=g[Nn])===null||u===void 0?void 0:u.arrayValue,N=G(((h=A?.values)===null||h===void 0?void 0:h.length)||0,((f=b?.values)===null||f===void 0?void 0:f.length)||0);return N!==0?N:Zd(A,b)}(n.mapValue,t.mapValue);case 11:return function(i,a){if(i===di.mapValue&&a===di.mapValue)return 0;if(i===di.mapValue)return 1;if(a===di.mapValue)return-1;let l=i.fields||{},u=Object.keys(l),h=a.fields||{},f=Object.keys(h);u.sort(),f.sort();for(let p=0;p<u.length&&p<f.length;++p){let g=Fa(u[p],f[p]);if(g!==0)return g;let A=Dn(l[u[p]],h[f[p]]);if(A!==0)return A}return G(u.length,f.length)}(n.mapValue,t.mapValue);default:throw F(23264,{Pe:e})}}function Jd(n,t){if(typeof n=="string"&&typeof t=="string"&&n.length===t.length)return G(n,t);let e=_e(n),r=_e(t),s=G(e.seconds,r.seconds);return s!==0?s:G(e.nanos,r.nanos)}function Zd(n,t){let e=n.values||[],r=t.values||[];for(let s=0;s<e.length&&s<r.length;++s){let i=Dn(e[s],r[s]);if(i)return i}return G(e.length,r.length)}function kn(n){return Ua(n)}function Ua(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(e){let r=_e(e);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(e){return ye(e).toBase64()}(n.bytesValue):"referenceValue"in n?function(e){return M.fromName(e).toString()}(n.referenceValue):"geoPointValue"in n?function(e){return`geo(${e.latitude},${e.longitude})`}(n.geoPointValue):"arrayValue"in n?function(e){let r="[",s=!0;for(let i of e.values||[])s?s=!1:r+=",",r+=Ua(i);return r+"]"}(n.arrayValue):"mapValue"in n?function(e){let r=Object.keys(e.fields||{}).sort(),s="{",i=!0;for(let a of r)i?i=!1:s+=",",s+=`${a}:${Ua(e.fields[a])}`;return s+"}"}(n.mapValue):F(61005,{value:n})}function pi(n){switch(xe(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let t=so(n);return t?16+pi(t):16;case 5:return 2*n.stringValue.length;case 6:return ye(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((s,i)=>s+pi(i),0)}(n.arrayValue);case 10:case 11:return function(r){let s=0;return Fe(r.fields,(i,a)=>{s+=i.length+pi(a)}),s}(n.mapValue);default:throw F(13486,{value:n})}}function qa(n){return!!n&&"integerValue"in n}function vc(n){return!!n&&"arrayValue"in n}function tf(n){return!!n&&"nullValue"in n}function ef(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function gi(n){return!!n&&"mapValue"in n}function nm(n){var t,e;return((e=(((t=n?.mapValue)===null||t===void 0?void 0:t.fields)||{})[_c])===null||e===void 0?void 0:e.stringValue)===yc}function Vr(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let t={mapValue:{fields:{}}};return Fe(n.mapValue.fields,(e,r)=>t.mapValue.fields[e]=Vr(r)),t}if(n.arrayValue){let t={arrayValue:{values:[]}};for(let e=0;e<(n.arrayValue.values||[]).length;++e)t.arrayValue.values[e]=Vr(n.arrayValue.values[e]);return t}return Object.assign({},n)}function rm(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===em}var mT={mapValue:{fields:{[_c]:{stringValue:yc},[Nn]:{arrayValue:{}}}}};var Mt=class n{constructor(t){this.value=t}static empty(){return new n({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let r=0;r<t.length-1;++r)if(e=(e.mapValue.fields||{})[t.get(r)],!gi(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=Vr(e)}setAll(t){let e=Lt.emptyPath(),r={},s=[];t.forEach((a,l)=>{if(!e.isImmediateParentOf(l)){let u=this.getFieldsMap(e);this.applyChanges(u,r,s),r={},s=[],e=l.popLast()}a?r[l.lastSegment()]=Vr(a):s.push(l.lastSegment())});let i=this.getFieldsMap(e);this.applyChanges(i,r,s)}delete(t){let e=this.field(t.popLast());gi(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return ie(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let r=0;r<t.length;++r){let s=e.mapValue.fields[t.get(r)];gi(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},e.mapValue.fields[t.get(r)]=s),e=s}return e.mapValue.fields}applyChanges(t,e,r){Fe(e,(s,i)=>t[s]=i);for(let s of r)delete t[s]}clone(){return new n(Vr(this.value))}};function sm(n){let t=[];return Fe(n.fields,(e,r)=>{let s=new Lt([e]);if(gi(r)){let i=sm(r.mapValue).fields;if(i.length===0)t.push(s);else for(let a of i)t.push(s.child(a))}else t.push(s)}),new $t(t)}var Wt=class n{constructor(t,e,r,s,i,a,l){this.key=t,this.documentType=e,this.version=r,this.readTime=s,this.createTime=i,this.data=a,this.documentState=l}static newInvalidDocument(t){return new n(t,0,B.min(),B.min(),B.min(),Mt.empty(),0)}static newFoundDocument(t,e,r,s){return new n(t,1,e,B.min(),r,s,0)}static newNoDocument(t,e){return new n(t,2,e,B.min(),B.min(),Mt.empty(),0)}static newUnknownDocument(t,e){return new n(t,3,e,B.min(),B.min(),Mt.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(B.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=Mt.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=Mt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=B.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof n&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var Vn=class{constructor(t,e){this.position=t,this.inclusive=e}};function nf(n,t,e){let r=0;for(let s=0;s<n.position.length;s++){let i=t[s],a=n.position[s];if(i.field.isKeyField()?r=M.comparator(M.fromName(a.referenceValue),e.key):r=Dn(a,e.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function rf(n,t){if(n===null)return t===null;if(t===null||n.inclusive!==t.inclusive||n.position.length!==t.position.length)return!1;for(let e=0;e<n.position.length;e++)if(!ie(n.position[e],t.position[e]))return!1;return!0}var On=class{constructor(t,e="asc"){this.field=t,this.dir=e}};function Ty(n,t){return n.dir===t.dir&&n.field.isEqual(t.field)}var Si=class{},pt=class n extends Si{constructor(t,e,r){super(),this.field=t,this.op=e,this.value=r}static create(t,e,r){return t.isKeyField()?e==="in"||e==="not-in"?this.createKeyFieldInFilter(t,e,r):new Ga(t,e,r):e==="array-contains"?new Ka(t,r):e==="in"?new Wa(t,r):e==="not-in"?new Qa(t,r):e==="array-contains-any"?new Ha(t,r):new n(t,e,r)}static createKeyFieldInFilter(t,e,r){return e==="in"?new za(t,r):new ja(t,r)}matches(t){let e=t.data.field(this.field);return this.op==="!="?e!==null&&e.nullValue===void 0&&this.matchesComparison(Dn(e,this.value)):e!==null&&xe(this.value)===xe(e)&&this.matchesComparison(Dn(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return F(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},oe=class n extends Si{constructor(t,e){super(),this.filters=t,this.op=e,this.Te=null}static create(t,e){return new n(t,e)}matches(t){return im(this)?this.filters.find(e=>!e.matches(t))===void 0:this.filters.find(e=>e.matches(t))!==void 0}getFlattenedFilters(){return this.Te!==null||(this.Te=this.filters.reduce((t,e)=>t.concat(e.getFlattenedFilters()),[])),this.Te}getFilters(){return Object.assign([],this.filters)}};function im(n){return n.op==="and"}function om(n){return Ay(n)&&im(n)}function Ay(n){for(let t of n.filters)if(t instanceof oe)return!1;return!0}function $a(n){if(n instanceof pt)return n.field.canonicalString()+n.op.toString()+kn(n.value);if(om(n))return n.filters.map(t=>$a(t)).join(",");{let t=n.filters.map(e=>$a(e)).join(",");return`${n.op}(${t})`}}function am(n,t){return n instanceof pt?function(r,s){return s instanceof pt&&r.op===s.op&&r.field.isEqual(s.field)&&ie(r.value,s.value)}(n,t):n instanceof oe?function(r,s){return s instanceof oe&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((i,a,l)=>i&&am(a,s.filters[l]),!0):!1}(n,t):void F(19439)}function lm(n){return n instanceof pt?function(e){return`${e.field.canonicalString()} ${e.op} ${kn(e.value)}`}(n):n instanceof oe?function(e){return e.op.toString()+" {"+e.getFilters().map(lm).join(" ,")+"}"}(n):"Filter"}var Ga=class extends pt{constructor(t,e,r){super(t,e,r),this.key=M.fromName(r.referenceValue)}matches(t){let e=M.comparator(t.key,this.key);return this.matchesComparison(e)}},za=class extends pt{constructor(t,e){super(t,"in",e),this.keys=cm("in",e)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}},ja=class extends pt{constructor(t,e){super(t,"not-in",e),this.keys=cm("not-in",e)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}};function cm(n,t){var e;return(((e=t.arrayValue)===null||e===void 0?void 0:e.values)||[]).map(r=>M.fromName(r.referenceValue))}var Ka=class extends pt{constructor(t,e){super(t,"array-contains",e)}matches(t){let e=t.data.field(this.field);return vc(e)&&qr(e.arrayValue,this.value)}},Wa=class extends pt{constructor(t,e){super(t,"in",e)}matches(t){let e=t.data.field(this.field);return e!==null&&qr(this.value.arrayValue,e)}},Qa=class extends pt{constructor(t,e){super(t,"not-in",e)}matches(t){if(qr(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let e=t.data.field(this.field);return e!==null&&e.nullValue===void 0&&!qr(this.value.arrayValue,e)}},Ha=class extends pt{constructor(t,e){super(t,"array-contains-any",e)}matches(t){let e=t.data.field(this.field);return!(!vc(e)||!e.arrayValue.values)&&e.arrayValue.values.some(r=>qr(this.value.arrayValue,r))}};var Ya=class{constructor(t,e=null,r=[],s=[],i=null,a=null,l=null){this.path=t,this.collectionGroup=e,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=a,this.endAt=l,this.Ie=null}};function sf(n,t=null,e=[],r=[],s=null,i=null,a=null){return new Ya(n,t,e,r,s,i,a)}function wc(n){let t=L(n);if(t.Ie===null){let e=t.path.canonicalString();t.collectionGroup!==null&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(r=>$a(r)).join(","),e+="|ob:",e+=t.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),ro(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(r=>kn(r)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(r=>kn(r)).join(",")),t.Ie=e}return t.Ie}function Ec(n,t){if(n.limit!==t.limit||n.orderBy.length!==t.orderBy.length)return!1;for(let e=0;e<n.orderBy.length;e++)if(!Ty(n.orderBy[e],t.orderBy[e]))return!1;if(n.filters.length!==t.filters.length)return!1;for(let e=0;e<n.filters.length;e++)if(!am(n.filters[e],t.filters[e]))return!1;return n.collectionGroup===t.collectionGroup&&!!n.path.isEqual(t.path)&&!!rf(n.startAt,t.startAt)&&rf(n.endAt,t.endAt)}function Xa(n){return M.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}var Fn=class{constructor(t,e=null,r=[],s=[],i=null,a="F",l=null,u=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=a,this.startAt=l,this.endAt=u,this.Ee=null,this.de=null,this.Ae=null,this.startAt,this.endAt}};function Cy(n,t,e,r,s,i,a,l){return new Fn(n,t,e,r,s,i,a,l)}function io(n){return new Fn(n)}function of(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Sy(n){return n.collectionGroup!==null}function Or(n){let t=L(n);if(t.Ee===null){t.Ee=[];let e=new Set;for(let i of t.explicitOrderBy)t.Ee.push(i),e.add(i.field.canonicalString());let r=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(a){let l=new _t(Lt.comparator);return a.filters.forEach(u=>{u.getFlattenedFilters().forEach(h=>{h.isInequality()&&(l=l.add(h.field))})}),l})(t).forEach(i=>{e.has(i.canonicalString())||i.isKeyField()||t.Ee.push(new On(i,r))}),e.has(Lt.keyField().canonicalString())||t.Ee.push(new On(Lt.keyField(),r))}return t.Ee}function ne(n){let t=L(n);return t.de||(t.de=by(t,Or(n))),t.de}function by(n,t){if(n.limitType==="F")return sf(n.path,n.collectionGroup,t,n.filters,n.limit,n.startAt,n.endAt);{t=t.map(s=>{let i=s.dir==="desc"?"asc":"desc";return new On(s.field,i)});let e=n.endAt?new Vn(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Vn(n.startAt.position,n.startAt.inclusive):null;return sf(n.path,n.collectionGroup,t,n.filters,n.limit,e,r)}}function Ja(n,t,e){return new Fn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),t,e,n.startAt,n.endAt)}function oo(n,t){return Ec(ne(n),ne(t))&&n.limitType===t.limitType}function um(n){return`${wc(ne(n))}|lt:${n.limitType}`}function Tn(n){return`Query(target=${function(e){let r=e.path.canonicalString();return e.collectionGroup!==null&&(r+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(r+=`, filters: [${e.filters.map(s=>lm(s)).join(", ")}]`),ro(e.limit)||(r+=", limit: "+e.limit),e.orderBy.length>0&&(r+=`, orderBy: [${e.orderBy.map(s=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(s)).join(", ")}]`),e.startAt&&(r+=", startAt: ",r+=e.startAt.inclusive?"b:":"a:",r+=e.startAt.position.map(s=>kn(s)).join(",")),e.endAt&&(r+=", endAt: ",r+=e.endAt.inclusive?"a:":"b:",r+=e.endAt.position.map(s=>kn(s)).join(",")),`Target(${r})`}(ne(n))}; limitType=${n.limitType})`}function ao(n,t){return t.isFoundDocument()&&function(r,s){let i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):M.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)}(n,t)&&function(r,s){for(let i of Or(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(n,t)&&function(r,s){for(let i of r.filters)if(!i.matches(s))return!1;return!0}(n,t)&&function(r,s){return!(r.startAt&&!function(a,l,u){let h=nf(a,l,u);return a.inclusive?h<=0:h<0}(r.startAt,Or(r),s)||r.endAt&&!function(a,l,u){let h=nf(a,l,u);return a.inclusive?h>=0:h>0}(r.endAt,Or(r),s))}(n,t)}function Ry(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function hm(n){return(t,e)=>{let r=!1;for(let s of Or(n)){let i=Py(s,t,e);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function Py(n,t,e){let r=n.field.isKeyField()?M.comparator(t.key,e.key):function(i,a,l){let u=a.data.field(i),h=l.data.field(i);return u!==null&&h!==null?Dn(u,h):F(42886)}(n.field,t,e);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return F(19790,{direction:n.dir})}}var ve=class{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){let e=this.mapKeyFn(t),r=this.inner[e];if(r!==void 0){for(let[s,i]of r)if(this.equalsFn(s,t))return i}}has(t){return this.get(t)!==void 0}set(t,e){let r=this.mapKeyFn(t),s=this.inner[r];if(s===void 0)return this.inner[r]=[[t,e]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],t))return void(s[i]=[t,e]);s.push([t,e]),this.innerSize++}delete(t){let e=this.mapKeyFn(t),r=this.inner[e];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],t))return r.length===1?delete this.inner[e]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(t){Fe(this.inner,(e,r)=>{for(let[s,i]of r)t(s,i)})}isEmpty(){return Yf(this.inner)}size(){return this.innerSize}};var xy=new lt(M.comparator);function we(){return xy}var dm=new lt(M.comparator);function kr(...n){let t=dm;for(let e of n)t=t.insert(e.key,e);return t}function fm(n){let t=dm;return n.forEach((e,r)=>t=t.insert(e,r.overlayedDocument)),t}function We(){return Fr()}function mm(){return Fr()}function Fr(){return new ve(n=>n.toString(),(n,t)=>n.isEqual(t))}var Ny=new lt(M.comparator),Dy=new _t(M.comparator);function Q(...n){let t=Dy;for(let e of n)t=t.add(e);return t}var ky=new _t(G);function Vy(){return ky}function Ic(n,t){if(n.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Br(t)?"-0":t}}function pm(n){return{integerValue:""+n}}function Oy(n,t){return cy(t)?pm(t):Ic(n,t)}var Mn=class{constructor(){this._=void 0}};function Fy(n,t,e){return n instanceof Ln?function(s,i){let a={fields:{[Jf]:{stringValue:Xf},[tm]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&gc(i)&&(i=so(i)),i&&(a.fields[Zf]=i),{mapValue:a}}(e,t):n instanceof Ne?_m(n,t):n instanceof De?ym(n,t):function(s,i){let a=gm(s,i),l=af(a)+af(s.Re);return qa(a)&&qa(s.Re)?pm(l):Ic(s.serializer,l)}(n,t)}function My(n,t,e){return n instanceof Ne?_m(n,t):n instanceof De?ym(n,t):e}function gm(n,t){return n instanceof Bn?function(r){return qa(r)||function(i){return!!i&&"doubleValue"in i}(r)}(t)?t:{integerValue:0}:null}var Ln=class extends Mn{},Ne=class extends Mn{constructor(t){super(),this.elements=t}};function _m(n,t){let e=vm(t);for(let r of n.elements)e.some(s=>ie(s,r))||e.push(r);return{arrayValue:{values:e}}}var De=class extends Mn{constructor(t){super(),this.elements=t}};function ym(n,t){let e=vm(t);for(let r of n.elements)e=e.filter(s=>!ie(s,r));return{arrayValue:{values:e}}}var Bn=class extends Mn{constructor(t,e){super(),this.serializer=t,this.Re=e}};function af(n){return it(n.integerValue||n.doubleValue)}function vm(n){return vc(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}var bi=class{constructor(t,e){this.field=t,this.transform=e}};function Ly(n,t){return n.field.isEqual(t.field)&&function(r,s){return r instanceof Ne&&s instanceof Ne||r instanceof De&&s instanceof De?xn(r.elements,s.elements,ie):r instanceof Bn&&s instanceof Bn?ie(r.Re,s.Re):r instanceof Ln&&s instanceof Ln}(n.transform,t.transform)}var Za=class{constructor(t,e){this.version=t,this.transformResults=e}},Pe=class n{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new n}static exists(t){return new n(void 0,t)}static updateTime(t){return new n(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}};function _i(n,t){return n.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(n.updateTime):n.exists===void 0||n.exists===t.isFoundDocument()}var Un=class{};function wm(n,t){if(!n.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return n.isNoDocument()?new Ri(n.key,Pe.none()):new Je(n.key,n.data,Pe.none());{let e=n.data,r=Mt.empty(),s=new _t(Lt.comparator);for(let i of t.fields)if(!s.has(i)){let a=e.field(i);a===null&&i.length>1&&(i=i.popLast(),a=e.field(i)),a===null?r.delete(i):r.set(i,a),s=s.add(i)}return new ae(n.key,r,new $t(s.toArray()),Pe.none())}}function By(n,t,e){n instanceof Je?function(s,i,a){let l=s.value.clone(),u=cf(s.fieldTransforms,i,a.transformResults);l.setAll(u),i.convertToFoundDocument(a.version,l).setHasCommittedMutations()}(n,t,e):n instanceof ae?function(s,i,a){if(!_i(s.precondition,i))return void i.convertToUnknownDocument(a.version);let l=cf(s.fieldTransforms,i,a.transformResults),u=i.data;u.setAll(Em(s)),u.setAll(l),i.convertToFoundDocument(a.version,u).setHasCommittedMutations()}(n,t,e):function(s,i,a){i.convertToNoDocument(a.version).setHasCommittedMutations()}(0,t,e)}function Mr(n,t,e,r){return n instanceof Je?function(i,a,l,u){if(!_i(i.precondition,a))return l;let h=i.value.clone(),f=uf(i.fieldTransforms,u,a);return h.setAll(f),a.convertToFoundDocument(a.version,h).setHasLocalMutations(),null}(n,t,e,r):n instanceof ae?function(i,a,l,u){if(!_i(i.precondition,a))return l;let h=uf(i.fieldTransforms,u,a),f=a.data;return f.setAll(Em(i)),f.setAll(h),a.convertToFoundDocument(a.version,f).setHasLocalMutations(),l===null?null:l.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(p=>p.field))}(n,t,e,r):function(i,a,l){return _i(i.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):l}(n,t,e)}function Uy(n,t){let e=null;for(let r of n.fieldTransforms){let s=t.data.field(r.field),i=gm(r.transform,s||null);i!=null&&(e===null&&(e=Mt.empty()),e.set(r.field,i))}return e||null}function lf(n,t){return n.type===t.type&&!!n.key.isEqual(t.key)&&!!n.precondition.isEqual(t.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&xn(r,s,(i,a)=>Ly(i,a))}(n.fieldTransforms,t.fieldTransforms)&&(n.type===0?n.value.isEqual(t.value):n.type!==1||n.data.isEqual(t.data)&&n.fieldMask.isEqual(t.fieldMask))}var Je=class extends Un{constructor(t,e,r,s=[]){super(),this.key=t,this.value=e,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}},ae=class extends Un{constructor(t,e,r,s,i=[]){super(),this.key=t,this.data=e,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}};function Em(n){let t=new Map;return n.fieldMask.fields.forEach(e=>{if(!e.isEmpty()){let r=n.data.field(e);t.set(e,r)}}),t}function cf(n,t,e){let r=new Map;Z(n.length===e.length,32656,{Ve:e.length,me:n.length});for(let s=0;s<e.length;s++){let i=n[s],a=i.transform,l=t.data.field(i.field);r.set(i.field,My(a,l,e[s]))}return r}function uf(n,t,e){let r=new Map;for(let s of n){let i=s.transform,a=e.data.field(s.field);r.set(s.field,Fy(i,a,t))}return r}var Ri=class extends Un{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},tl=class extends Un{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var el=class{constructor(t,e,r,s){this.batchId=t,this.localWriteTime=e,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(t,e){let r=e.mutationResults;for(let s=0;s<this.mutations.length;s++){let i=this.mutations[s];i.key.isEqual(t.key)&&By(i,t,r[s])}}applyToLocalView(t,e){for(let r of this.baseMutations)r.key.isEqual(t.key)&&(e=Mr(r,t,e,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(t.key)&&(e=Mr(r,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){let r=mm();return this.mutations.forEach(s=>{let i=t.get(s.key),a=i.overlayedDocument,l=this.applyToLocalView(a,i.mutatedFields);l=e.has(s.key)?null:l;let u=wm(a,l);u!==null&&r.set(s.key,u),a.isValidDocument()||a.convertToNoDocument(B.min())}),r}keys(){return this.mutations.reduce((t,e)=>t.add(e.key),Q())}isEqual(t){return this.batchId===t.batchId&&xn(this.mutations,t.mutations,(e,r)=>lf(e,r))&&xn(this.baseMutations,t.baseMutations,(e,r)=>lf(e,r))}},nl=class n{constructor(t,e,r,s){this.batch=t,this.commitVersion=e,this.mutationResults=r,this.docVersions=s}static from(t,e,r){Z(t.mutations.length===r.length,58842,{fe:t.mutations.length,ge:r.length});let s=function(){return Ny}(),i=t.mutations;for(let a=0;a<i.length;a++)s=s.insert(i[a].key,r[a].version);return new n(t,e,r,s)}};var rl=class{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var sl=class{constructor(t,e){this.count=t,this.unchangedNames=e}};var ut,H;function qy(n){switch(n){case P.OK:return F(64938);case P.CANCELLED:case P.UNKNOWN:case P.DEADLINE_EXCEEDED:case P.RESOURCE_EXHAUSTED:case P.INTERNAL:case P.UNAVAILABLE:case P.UNAUTHENTICATED:return!1;case P.INVALID_ARGUMENT:case P.NOT_FOUND:case P.ALREADY_EXISTS:case P.PERMISSION_DENIED:case P.FAILED_PRECONDITION:case P.ABORTED:case P.OUT_OF_RANGE:case P.UNIMPLEMENTED:case P.DATA_LOSS:return!0;default:return F(15467,{code:n})}}function Im(n){if(n===void 0)return ge("GRPC error has no .code"),P.UNKNOWN;switch(n){case ut.OK:return P.OK;case ut.CANCELLED:return P.CANCELLED;case ut.UNKNOWN:return P.UNKNOWN;case ut.DEADLINE_EXCEEDED:return P.DEADLINE_EXCEEDED;case ut.RESOURCE_EXHAUSTED:return P.RESOURCE_EXHAUSTED;case ut.INTERNAL:return P.INTERNAL;case ut.UNAVAILABLE:return P.UNAVAILABLE;case ut.UNAUTHENTICATED:return P.UNAUTHENTICATED;case ut.INVALID_ARGUMENT:return P.INVALID_ARGUMENT;case ut.NOT_FOUND:return P.NOT_FOUND;case ut.ALREADY_EXISTS:return P.ALREADY_EXISTS;case ut.PERMISSION_DENIED:return P.PERMISSION_DENIED;case ut.FAILED_PRECONDITION:return P.FAILED_PRECONDITION;case ut.ABORTED:return P.ABORTED;case ut.OUT_OF_RANGE:return P.OUT_OF_RANGE;case ut.UNIMPLEMENTED:return P.UNIMPLEMENTED;case ut.DATA_LOSS:return P.DATA_LOSS;default:return F(39323,{code:n})}}(H=ut||(ut={}))[H.OK=0]="OK",H[H.CANCELLED=1]="CANCELLED",H[H.UNKNOWN=2]="UNKNOWN",H[H.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",H[H.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",H[H.NOT_FOUND=5]="NOT_FOUND",H[H.ALREADY_EXISTS=6]="ALREADY_EXISTS",H[H.PERMISSION_DENIED=7]="PERMISSION_DENIED",H[H.UNAUTHENTICATED=16]="UNAUTHENTICATED",H[H.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",H[H.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",H[H.ABORTED=10]="ABORTED",H[H.OUT_OF_RANGE=11]="OUT_OF_RANGE",H[H.UNIMPLEMENTED=12]="UNIMPLEMENTED",H[H.INTERNAL=13]="INTERNAL",H[H.UNAVAILABLE=14]="UNAVAILABLE",H[H.DATA_LOSS=15]="DATA_LOSS";var hf=null;var $y=new me([4294967295,4294967295],0);function df(n){let t=Of().encode(n),e=new wa;return e.update(t),new Uint8Array(e.digest())}function ff(n){let t=new DataView(n.buffer),e=t.getUint32(0,!0),r=t.getUint32(4,!0),s=t.getUint32(8,!0),i=t.getUint32(12,!0);return[new me([e,r],0),new me([s,i],0)]}var il=class n{constructor(t,e,r){if(this.bitmap=t,this.padding=e,this.hashCount=r,e<0||e>=8)throw new Qe(`Invalid padding: ${e}`);if(r<0)throw new Qe(`Invalid hash count: ${r}`);if(t.length>0&&this.hashCount===0)throw new Qe(`Invalid hash count: ${r}`);if(t.length===0&&e!==0)throw new Qe(`Invalid padding when bitmap length is 0: ${e}`);this.pe=8*t.length-e,this.ye=me.fromNumber(this.pe)}we(t,e,r){let s=t.add(e.multiply(me.fromNumber(r)));return s.compare($y)===1&&(s=new me([s.getBits(0),s.getBits(1)],0)),s.modulo(this.ye).toNumber()}be(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(this.pe===0)return!1;let e=df(t),[r,s]=ff(e);for(let i=0;i<this.hashCount;i++){let a=this.we(r,s,i);if(!this.be(a))return!1}return!0}static create(t,e,r){let s=t%8==0?0:8-t%8,i=new Uint8Array(Math.ceil(t/8)),a=new n(i,s,e);return r.forEach(l=>a.insert(l)),a}insert(t){if(this.pe===0)return;let e=df(t),[r,s]=ff(e);for(let i=0;i<this.hashCount;i++){let a=this.we(r,s,i);this.Se(a)}}Se(t){let e=Math.floor(t/8),r=t%8;this.bitmap[e]|=1<<r}},Qe=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var Pi=class n{constructor(t,e,r,s,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(t,e,r){let s=new Map;return s.set(t,$r.createSynthesizedTargetChangeForCurrentChange(t,e,r)),new n(B.min(),s,new lt(G),we(),Q())}},$r=class n{constructor(t,e,r,s,i){this.resumeToken=t,this.current=e,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(t,e,r){return new n(r,e,Q(),Q(),Q())}};var bn=class{constructor(t,e,r,s){this.De=t,this.removedTargetIds=e,this.key=r,this.ve=s}},xi=class{constructor(t,e){this.targetId=t,this.Ce=e}},Ni=class{constructor(t,e,r=bt.EMPTY_BYTE_STRING,s=null){this.state=t,this.targetIds=e,this.resumeToken=r,this.cause=s}},Di=class{constructor(){this.Fe=0,this.Me=mf(),this.xe=bt.EMPTY_BYTE_STRING,this.Oe=!1,this.Ne=!0}get current(){return this.Oe}get resumeToken(){return this.xe}get Be(){return this.Fe!==0}get Le(){return this.Ne}ke(t){t.approximateByteSize()>0&&(this.Ne=!0,this.xe=t)}qe(){let t=Q(),e=Q(),r=Q();return this.Me.forEach((s,i)=>{switch(i){case 0:t=t.add(s);break;case 2:e=e.add(s);break;case 1:r=r.add(s);break;default:F(38017,{changeType:i})}}),new $r(this.xe,this.Oe,t,e,r)}Qe(){this.Ne=!1,this.Me=mf()}$e(t,e){this.Ne=!0,this.Me=this.Me.insert(t,e)}Ue(t){this.Ne=!0,this.Me=this.Me.remove(t)}Ke(){this.Fe+=1}We(){this.Fe-=1,Z(this.Fe>=0,3241,{Fe:this.Fe})}Ge(){this.Ne=!0,this.Oe=!0}},ol=class{constructor(t){this.ze=t,this.je=new Map,this.He=we(),this.Je=fi(),this.Ye=fi(),this.Ze=new lt(G)}Xe(t){for(let e of t.De)t.ve&&t.ve.isFoundDocument()?this.et(e,t.ve):this.tt(e,t.key,t.ve);for(let e of t.removedTargetIds)this.tt(e,t.key,t.ve)}nt(t){this.forEachTarget(t,e=>{let r=this.rt(e);switch(t.state){case 0:this.it(e)&&r.ke(t.resumeToken);break;case 1:r.We(),r.Be||r.Qe(),r.ke(t.resumeToken);break;case 2:r.We(),r.Be||this.removeTarget(e);break;case 3:this.it(e)&&(r.Ge(),r.ke(t.resumeToken));break;case 4:this.it(e)&&(this.st(e),r.ke(t.resumeToken));break;default:F(56790,{state:t.state})}})}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.je.forEach((r,s)=>{this.it(s)&&e(s)})}ot(t){let e=t.targetId,r=t.Ce.count,s=this._t(e);if(s){let i=s.target;if(Xa(i))if(r===0){let a=new M(i.path);this.tt(e,a,Wt.newNoDocument(a,B.min()))}else Z(r===1,20013,{expectedCount:r});else{let a=this.ut(e);if(a!==r){let l=this.ct(t),u=l?this.lt(l,t,a):1;if(u!==0){this.st(e);let h=u===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ze=this.Ze.insert(e,h)}hf?.ht(function(f,p,g,A,b){var N,x,U,q,W,st;let Bt={localCacheCount:f,existenceFilterCount:p.count,databaseId:g.database,projectId:g.projectId},nt=p.unchangedNames;return nt&&(Bt.bloomFilter={applied:b===0,hashCount:(N=nt?.hashCount)!==null&&N!==void 0?N:0,bitmapLength:(q=(U=(x=nt?.bits)===null||x===void 0?void 0:x.bitmap)===null||U===void 0?void 0:U.length)!==null&&q!==void 0?q:0,padding:(st=(W=nt?.bits)===null||W===void 0?void 0:W.padding)!==null&&st!==void 0?st:0,mightContain:I=>{var _;return(_=A?.mightContain(I))!==null&&_!==void 0&&_}}),Bt}(a,t.Ce,this.ze.Pt(),l,u))}}}}ct(t){let e=t.Ce.unchangedNames;if(!e||!e.bits)return null;let{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=e,a,l;try{a=ye(r).toUint8Array()}catch(u){if(u instanceof Ti)return Pn("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{l=new il(a,s,i)}catch(u){return Pn(u instanceof Qe?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return l.pe===0?null:l}lt(t,e,r){return e.Ce.count===r-this.Tt(t,e.targetId)?0:2}Tt(t,e){let r=this.ze.getRemoteKeysForTarget(e),s=0;return r.forEach(i=>{let a=this.ze.Pt(),l=`projects/${a.projectId}/databases/${a.database}/documents/${i.path.canonicalString()}`;t.mightContain(l)||(this.tt(e,i,null),s++)}),s}It(t){let e=new Map;this.je.forEach((i,a)=>{let l=this._t(a);if(l){if(i.current&&Xa(l.target)){let u=new M(l.target.path);this.Et(u).has(a)||this.dt(a,u)||this.tt(a,u,Wt.newNoDocument(u,t))}i.Le&&(e.set(a,i.qe()),i.Qe())}});let r=Q();this.Ye.forEach((i,a)=>{let l=!0;a.forEachWhile(u=>{let h=this._t(u);return!h||h.purpose==="TargetPurposeLimboResolution"||(l=!1,!1)}),l&&(r=r.add(i))}),this.He.forEach((i,a)=>a.setReadTime(t));let s=new Pi(t,e,this.Ze,this.He,r);return this.He=we(),this.Je=fi(),this.Ye=fi(),this.Ze=new lt(G),s}et(t,e){if(!this.it(t))return;let r=this.dt(t,e.key)?2:0;this.rt(t).$e(e.key,r),this.He=this.He.insert(e.key,e),this.Je=this.Je.insert(e.key,this.Et(e.key).add(t)),this.Ye=this.Ye.insert(e.key,this.At(e.key).add(t))}tt(t,e,r){if(!this.it(t))return;let s=this.rt(t);this.dt(t,e)?s.$e(e,1):s.Ue(e),this.Ye=this.Ye.insert(e,this.At(e).delete(t)),this.Ye=this.Ye.insert(e,this.At(e).add(t)),r&&(this.He=this.He.insert(e,r))}removeTarget(t){this.je.delete(t)}ut(t){let e=this.rt(t).qe();return this.ze.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Ke(t){this.rt(t).Ke()}rt(t){let e=this.je.get(t);return e||(e=new Di,this.je.set(t,e)),e}At(t){let e=this.Ye.get(t);return e||(e=new _t(G),this.Ye=this.Ye.insert(t,e)),e}Et(t){let e=this.Je.get(t);return e||(e=new _t(G),this.Je=this.Je.insert(t,e)),e}it(t){let e=this._t(t)!==null;return e||V("WatchChangeAggregator","Detected inactive target",t),e}_t(t){let e=this.je.get(t);return e&&e.Be?null:this.ze.Rt(t)}st(t){this.je.set(t,new Di),this.ze.getRemoteKeysForTarget(t).forEach(e=>{this.tt(t,e,null)})}dt(t,e){return this.ze.getRemoteKeysForTarget(t).has(e)}};function fi(){return new lt(M.comparator)}function mf(){return new lt(M.comparator)}var Gy={asc:"ASCENDING",desc:"DESCENDING"},zy={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},jy={and:"AND",or:"OR"},al=class{constructor(t,e){this.databaseId=t,this.useProto3Json=e}};function ll(n,t){return n.useProto3Json||ro(t)?t:{value:t}}function ki(n,t){return n.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function Tm(n,t){return n.useProto3Json?t.toBase64():t.toUint8Array()}function Ky(n,t){return ki(n,t.toTimestamp())}function re(n){return Z(!!n,49232),B.fromTimestamp(function(e){let r=_e(e);return new vt(r.seconds,r.nanos)}(n))}function Tc(n,t){return cl(n,t).canonicalString()}function cl(n,t){let e=function(s){return new dt(["projects",s.projectId,"databases",s.database])}(n).child("documents");return t===void 0?e:e.child(t)}function Am(n){let t=dt.fromString(n);return Z(Pm(t),10190,{key:t.toString()}),t}function ul(n,t){return Tc(n.databaseId,t.path)}function Sa(n,t){let e=Am(t);if(e.get(1)!==n.databaseId.projectId)throw new O(P.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+n.databaseId.projectId);if(e.get(3)!==n.databaseId.database)throw new O(P.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+n.databaseId.database);return new M(Sm(e))}function Cm(n,t){return Tc(n.databaseId,t)}function Wy(n){let t=Am(n);return t.length===4?dt.emptyPath():Sm(t)}function hl(n){return new dt(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Sm(n){return Z(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function pf(n,t,e){return{name:ul(n,t),fields:e.value.mapValue.fields}}function Qy(n,t){let e;if("targetChange"in t){t.targetChange;let r=function(h){return h==="NO_CHANGE"?0:h==="ADD"?1:h==="REMOVE"?2:h==="CURRENT"?3:h==="RESET"?4:F(39313,{state:h})}(t.targetChange.targetChangeType||"NO_CHANGE"),s=t.targetChange.targetIds||[],i=function(h,f){return h.useProto3Json?(Z(f===void 0||typeof f=="string",58123),bt.fromBase64String(f||"")):(Z(f===void 0||f instanceof Buffer||f instanceof Uint8Array,16193),bt.fromUint8Array(f||new Uint8Array))}(n,t.targetChange.resumeToken),a=t.targetChange.cause,l=a&&function(h){let f=h.code===void 0?P.UNKNOWN:Im(h.code);return new O(f,h.message||"")}(a);e=new Ni(r,s,i,l||null)}else if("documentChange"in t){t.documentChange;let r=t.documentChange;r.document,r.document.name,r.document.updateTime;let s=Sa(n,r.document.name),i=re(r.document.updateTime),a=r.document.createTime?re(r.document.createTime):B.min(),l=new Mt({mapValue:{fields:r.document.fields}}),u=Wt.newFoundDocument(s,i,a,l),h=r.targetIds||[],f=r.removedTargetIds||[];e=new bn(h,f,u.key,u)}else if("documentDelete"in t){t.documentDelete;let r=t.documentDelete;r.document;let s=Sa(n,r.document),i=r.readTime?re(r.readTime):B.min(),a=Wt.newNoDocument(s,i),l=r.removedTargetIds||[];e=new bn([],l,a.key,a)}else if("documentRemove"in t){t.documentRemove;let r=t.documentRemove;r.document;let s=Sa(n,r.document),i=r.removedTargetIds||[];e=new bn([],i,s,null)}else{if(!("filter"in t))return F(11601,{Vt:t});{t.filter;let r=t.filter;r.targetId;let{count:s=0,unchangedNames:i}=r,a=new sl(s,i),l=r.targetId;e=new xi(l,a)}}return e}function Hy(n,t){let e;if(t instanceof Je)e={update:pf(n,t.key,t.value)};else if(t instanceof Ri)e={delete:ul(n,t.key)};else if(t instanceof ae)e={update:pf(n,t.key,t.data),updateMask:sv(t.fieldMask)};else{if(!(t instanceof tl))return F(16599,{ft:t.type});e={verify:ul(n,t.key)}}return t.fieldTransforms.length>0&&(e.updateTransforms=t.fieldTransforms.map(r=>function(i,a){let l=a.transform;if(l instanceof Ln)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(l instanceof Ne)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:l.elements}};if(l instanceof De)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:l.elements}};if(l instanceof Bn)return{fieldPath:a.field.canonicalString(),increment:l.Re};throw F(20930,{transform:a.transform})}(0,r))),t.precondition.isNone||(e.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:Ky(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:F(27497)}(n,t.precondition)),e}function Yy(n,t){return n&&n.length>0?(Z(t!==void 0,14353),n.map(e=>function(s,i){let a=s.updateTime?re(s.updateTime):re(i);return a.isEqual(B.min())&&(a=re(i)),new Za(a,s.transformResults||[])}(e,t))):[]}function Xy(n,t){return{documents:[Cm(n,t.path)]}}function Jy(n,t){let e={structuredQuery:{}},r=t.path,s;t.collectionGroup!==null?(s=r,e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(s=r.popLast(),e.structuredQuery.from=[{collectionId:r.lastSegment()}]),e.parent=Cm(n,s);let i=function(h){if(h.length!==0)return Rm(oe.create(h,"and"))}(t.filters);i&&(e.structuredQuery.where=i);let a=function(h){if(h.length!==0)return h.map(f=>function(g){return{field:An(g.field),direction:ev(g.dir)}}(f))}(t.orderBy);a&&(e.structuredQuery.orderBy=a);let l=ll(n,t.limit);return l!==null&&(e.structuredQuery.limit=l),t.startAt&&(e.structuredQuery.startAt=function(h){return{before:h.inclusive,values:h.position}}(t.startAt)),t.endAt&&(e.structuredQuery.endAt=function(h){return{before:!h.inclusive,values:h.position}}(t.endAt)),{gt:e,parent:s}}function Zy(n){let t=Wy(n.parent),e=n.structuredQuery,r=e.from?e.from.length:0,s=null;if(r>0){Z(r===1,65062);let f=e.from[0];f.allDescendants?s=f.collectionId:t=t.child(f.collectionId)}let i=[];e.where&&(i=function(p){let g=bm(p);return g instanceof oe&&om(g)?g.getFilters():[g]}(e.where));let a=[];e.orderBy&&(a=function(p){return p.map(g=>function(b){return new On(Cn(b.field),function(x){switch(x){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(b.direction))}(g))}(e.orderBy));let l=null;e.limit&&(l=function(p){let g;return g=typeof p=="object"?p.value:p,ro(g)?null:g}(e.limit));let u=null;e.startAt&&(u=function(p){let g=!!p.before,A=p.values||[];return new Vn(A,g)}(e.startAt));let h=null;return e.endAt&&(h=function(p){let g=!p.before,A=p.values||[];return new Vn(A,g)}(e.endAt)),Cy(t,s,a,i,l,"F",u,h)}function tv(n,t){let e=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return F(28987,{purpose:s})}}(t.purpose);return e==null?null:{"goog-listen-tags":e}}function bm(n){return n.unaryFilter!==void 0?function(e){switch(e.unaryFilter.op){case"IS_NAN":let r=Cn(e.unaryFilter.field);return pt.create(r,"==",{doubleValue:NaN});case"IS_NULL":let s=Cn(e.unaryFilter.field);return pt.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let i=Cn(e.unaryFilter.field);return pt.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let a=Cn(e.unaryFilter.field);return pt.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return F(61313);default:return F(60726)}}(n):n.fieldFilter!==void 0?function(e){return pt.create(Cn(e.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return F(58110);default:return F(50506)}}(e.fieldFilter.op),e.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(e){return oe.create(e.compositeFilter.filters.map(r=>bm(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return F(1026)}}(e.compositeFilter.op))}(n):F(30097,{filter:n})}function ev(n){return Gy[n]}function nv(n){return zy[n]}function rv(n){return jy[n]}function An(n){return{fieldPath:n.canonicalString()}}function Cn(n){return Lt.fromServerFormat(n.fieldPath)}function Rm(n){return n instanceof pt?function(e){if(e.op==="=="){if(ef(e.value))return{unaryFilter:{field:An(e.field),op:"IS_NAN"}};if(tf(e.value))return{unaryFilter:{field:An(e.field),op:"IS_NULL"}}}else if(e.op==="!="){if(ef(e.value))return{unaryFilter:{field:An(e.field),op:"IS_NOT_NAN"}};if(tf(e.value))return{unaryFilter:{field:An(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:An(e.field),op:nv(e.op),value:e.value}}}(n):n instanceof oe?function(e){let r=e.getFilters().map(s=>Rm(s));return r.length===1?r[0]:{compositeFilter:{op:rv(e.op),filters:r}}}(n):F(54877,{filter:n})}function sv(n){let t=[];return n.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function Pm(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var Gr=class n{constructor(t,e,r,s,i=B.min(),a=B.min(),l=bt.EMPTY_BYTE_STRING,u=null){this.target=t,this.targetId=e,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=l,this.expectedCount=u}withSequenceNumber(t){return new n(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}};var dl=class{constructor(t){this.wt=t}};function iv(n){let t=Zy({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Ja(t,t.limit,"L"):t}var Vi=class{constructor(){}vt(t,e){this.Ct(t,e),e.Ft()}Ct(t,e){if("nullValue"in t)this.Mt(e,5);else if("booleanValue"in t)this.Mt(e,10),e.xt(t.booleanValue?1:0);else if("integerValue"in t)this.Mt(e,15),e.xt(it(t.integerValue));else if("doubleValue"in t){let r=it(t.doubleValue);isNaN(r)?this.Mt(e,13):(this.Mt(e,15),Br(r)?e.xt(0):e.xt(r))}else if("timestampValue"in t){let r=t.timestampValue;this.Mt(e,20),typeof r=="string"&&(r=_e(r)),e.Ot(`${r.seconds||""}`),e.xt(r.nanos||0)}else if("stringValue"in t)this.Nt(t.stringValue,e),this.Bt(e);else if("bytesValue"in t)this.Mt(e,30),e.Lt(ye(t.bytesValue)),this.Bt(e);else if("referenceValue"in t)this.kt(t.referenceValue,e);else if("geoPointValue"in t){let r=t.geoPointValue;this.Mt(e,45),e.xt(r.latitude||0),e.xt(r.longitude||0)}else"mapValue"in t?rm(t)?this.Mt(e,Number.MAX_SAFE_INTEGER):nm(t)?this.qt(t.mapValue,e):(this.Qt(t.mapValue,e),this.Bt(e)):"arrayValue"in t?(this.$t(t.arrayValue,e),this.Bt(e)):F(19022,{Ut:t})}Nt(t,e){this.Mt(e,25),this.Kt(t,e)}Kt(t,e){e.Ot(t)}Qt(t,e){let r=t.fields||{};this.Mt(e,55);for(let s of Object.keys(r))this.Nt(s,e),this.Ct(r[s],e)}qt(t,e){var r,s;let i=t.fields||{};this.Mt(e,53);let a=Nn,l=((s=(r=i[a].arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.length)||0;this.Mt(e,15),e.xt(it(l)),this.Nt(a,e),this.Ct(i[a],e)}$t(t,e){let r=t.values||[];this.Mt(e,50);for(let s of r)this.Ct(s,e)}kt(t,e){this.Mt(e,37),M.fromName(t).path.forEach(r=>{this.Mt(e,60),this.Kt(r,e)})}Mt(t,e){t.xt(e)}Bt(t){t.xt(2)}};Vi.Wt=new Vi;var fl=class{constructor(){this.Cn=new ml}addToCollectionParentIndex(t,e){return this.Cn.add(e),R.resolve()}getCollectionParents(t,e){return R.resolve(this.Cn.getEntries(e))}addFieldIndex(t,e){return R.resolve()}deleteFieldIndex(t,e){return R.resolve()}deleteAllFieldIndexes(t){return R.resolve()}createTargetIndexes(t,e){return R.resolve()}getDocumentsMatchingTarget(t,e){return R.resolve(null)}getIndexType(t,e){return R.resolve(0)}getFieldIndexes(t,e){return R.resolve([])}getNextCollectionGroupToUpdate(t){return R.resolve(null)}getMinOffset(t,e){return R.resolve(Xe.min())}getMinOffsetFromCollectionGroup(t,e){return R.resolve(Xe.min())}updateCollectionGroup(t,e,r){return R.resolve()}updateIndexEntries(t,e){return R.resolve()}},ml=class{constructor(){this.index={}}add(t){let e=t.lastSegment(),r=t.popLast(),s=this.index[e]||new _t(dt.comparator),i=!s.has(r);return this.index[e]=s.add(r),i}has(t){let e=t.lastSegment(),r=t.popLast(),s=this.index[e];return s&&s.has(r)}getEntries(t){return(this.index[t]||new _t(dt.comparator)).toArray()}};var pT=new Uint8Array(0);var gf={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},xm=41943040,qt=class n{static withCacheSize(t){return new n(t,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(t,e,r){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=r}};qt.DEFAULT_COLLECTION_PERCENTILE=10,qt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,qt.DEFAULT=new qt(xm,qt.DEFAULT_COLLECTION_PERCENTILE,qt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),qt.DISABLED=new qt(-1,0,0);var zr=class n{constructor(t){this.ur=t}next(){return this.ur+=2,this.ur}static cr(){return new n(0)}static lr(){return new n(-1)}};var _f="LruGarbageCollector",ov=1048576;function yf([n,t],[e,r]){let s=G(n,e);return s===0?G(t,r):s}var pl=class{constructor(t){this.Er=t,this.buffer=new _t(yf),this.dr=0}Ar(){return++this.dr}Rr(t){let e=[t,this.Ar()];if(this.buffer.size<this.Er)this.buffer=this.buffer.add(e);else{let r=this.buffer.last();yf(e,r)<0&&(this.buffer=this.buffer.delete(r).add(e))}}get maxValue(){return this.buffer.last()[0]}},gl=class{constructor(t,e,r){this.garbageCollector=t,this.asyncQueue=e,this.localStore=r,this.Vr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.mr(6e4)}stop(){this.Vr&&(this.Vr.cancel(),this.Vr=null)}get started(){return this.Vr!==null}mr(t){V(_f,`Garbage collection scheduled in ${t}ms`),this.Vr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,async()=>{this.Vr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){jn(e)?V(_f,"Ignoring IndexedDB error during garbage collection: ",e):await zn(e)}await this.mr(3e5)})}},_l=class{constructor(t,e){this.gr=t,this.params=e}calculateTargetCount(t,e){return this.gr.pr(t).next(r=>Math.floor(e/100*r))}nthSequenceNumber(t,e){if(e===0)return R.resolve(mc.le);let r=new pl(e);return this.gr.forEachTarget(t,s=>r.Rr(s.sequenceNumber)).next(()=>this.gr.yr(t,s=>r.Rr(s))).next(()=>r.maxValue)}removeTargets(t,e,r){return this.gr.removeTargets(t,e,r)}removeOrphanedDocuments(t,e){return this.gr.removeOrphanedDocuments(t,e)}collect(t,e){return this.params.cacheSizeCollectionThreshold===-1?(V("LruGarbageCollector","Garbage collection skipped; disabled"),R.resolve(gf)):this.getCacheSize(t).next(r=>r<this.params.cacheSizeCollectionThreshold?(V("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),gf):this.wr(t,e))}getCacheSize(t){return this.gr.getCacheSize(t)}wr(t,e){let r,s,i,a,l,u,h,f=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(p=>(p>this.params.maximumSequenceNumbersToCollect?(V("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${p}`),s=this.params.maximumSequenceNumbersToCollect):s=p,a=Date.now(),this.nthSequenceNumber(t,s))).next(p=>(r=p,l=Date.now(),this.removeTargets(t,r,e))).next(p=>(i=p,u=Date.now(),this.removeOrphanedDocuments(t,r))).next(p=>(h=Date.now(),In()<=Ut.DEBUG&&V("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-f}ms
	Determined least recently used ${s} in `+(l-a)+`ms
	Removed ${i} targets in `+(u-l)+`ms
	Removed ${p} documents in `+(h-u)+`ms
Total Duration: ${h-f}ms`),R.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:p})))}};function av(n,t){return new _l(n,t)}var yl=class{constructor(){this.changes=new ve(t=>t.toString(),(t,e)=>t.isEqual(e)),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,Wt.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();let r=this.changes.get(e);return r!==void 0?R.resolve(r):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}};var vl=class{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}};var wl=class{constructor(t,e,r,s){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=r,this.indexManager=s}getDocument(t,e){let r=null;return this.documentOverlayCache.getOverlay(t,e).next(s=>(r=s,this.remoteDocumentCache.getEntry(t,e))).next(s=>(r!==null&&Mr(r.mutation,s,$t.empty(),vt.now()),s))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next(r=>this.getLocalViewOfDocuments(t,r,Q()).next(()=>r))}getLocalViewOfDocuments(t,e,r=Q()){let s=We();return this.populateOverlays(t,s,e).next(()=>this.computeViews(t,e,s,r).next(i=>{let a=kr();return i.forEach((l,u)=>{a=a.insert(l,u.overlayedDocument)}),a}))}getOverlayedDocuments(t,e){let r=We();return this.populateOverlays(t,r,e).next(()=>this.computeViews(t,e,r,Q()))}populateOverlays(t,e,r){let s=[];return r.forEach(i=>{e.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(t,s).next(i=>{i.forEach((a,l)=>{e.set(a,l)})})}computeViews(t,e,r,s){let i=we(),a=Fr(),l=function(){return Fr()}();return e.forEach((u,h)=>{let f=r.get(h.key);s.has(h.key)&&(f===void 0||f.mutation instanceof ae)?i=i.insert(h.key,h):f!==void 0?(a.set(h.key,f.mutation.getFieldMask()),Mr(f.mutation,h,f.mutation.getFieldMask(),vt.now())):a.set(h.key,$t.empty())}),this.recalculateAndSaveOverlays(t,i).next(u=>(u.forEach((h,f)=>a.set(h,f)),e.forEach((h,f)=>{var p;return l.set(h,new vl(f,(p=a.get(h))!==null&&p!==void 0?p:null))}),l))}recalculateAndSaveOverlays(t,e){let r=Fr(),s=new lt((a,l)=>a-l),i=Q();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next(a=>{for(let l of a)l.keys().forEach(u=>{let h=e.get(u);if(h===null)return;let f=r.get(u)||$t.empty();f=l.applyToLocalView(h,f),r.set(u,f);let p=(s.get(l.batchId)||Q()).add(u);s=s.insert(l.batchId,p)})}).next(()=>{let a=[],l=s.getReverseIterator();for(;l.hasNext();){let u=l.getNext(),h=u.key,f=u.value,p=mm();f.forEach(g=>{if(!i.has(g)){let A=wm(e.get(g),r.get(g));A!==null&&p.set(g,A),i=i.add(g)}}),a.push(this.documentOverlayCache.saveOverlays(t,h,p))}return R.waitFor(a)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next(r=>this.recalculateAndSaveOverlays(t,r))}getDocumentsMatchingQuery(t,e,r,s){return function(a){return M.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):Sy(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,r,s):this.getDocumentsMatchingCollectionQuery(t,e,r,s)}getNextDocuments(t,e,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,r,s).next(i=>{let a=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,r.largestBatchId,s-i.size):R.resolve(We()),l=Lr,u=i;return a.next(h=>R.forEach(h,(f,p)=>(l<p.largestBatchId&&(l=p.largestBatchId),i.get(f)?R.resolve():this.remoteDocumentCache.getEntry(t,f).next(g=>{u=u.insert(f,g)}))).next(()=>this.populateOverlays(t,h,i)).next(()=>this.computeViews(t,u,h,Q())).next(f=>({batchId:l,changes:fm(f)})))})}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new M(e)).next(r=>{let s=kr();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(t,e,r,s){let i=e.collectionGroup,a=kr();return this.indexManager.getCollectionParents(t,i).next(l=>R.forEach(l,u=>{let h=function(p,g){return new Fn(g,null,p.explicitOrderBy.slice(),p.filters.slice(),p.limit,p.limitType,p.startAt,p.endAt)}(e,u.child(i));return this.getDocumentsMatchingCollectionQuery(t,h,r,s).next(f=>{f.forEach((p,g)=>{a=a.insert(p,g)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(t,e,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,r.largestBatchId).next(a=>(i=a,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,r,i,s))).next(a=>{i.forEach((u,h)=>{let f=h.getKey();a.get(f)===null&&(a=a.insert(f,Wt.newInvalidDocument(f)))});let l=kr();return a.forEach((u,h)=>{let f=i.get(u);f!==void 0&&Mr(f.mutation,h,$t.empty(),vt.now()),ao(e,h)&&(l=l.insert(u,h))}),l})}};var El=class{constructor(t){this.serializer=t,this.kr=new Map,this.qr=new Map}getBundleMetadata(t,e){return R.resolve(this.kr.get(e))}saveBundleMetadata(t,e){return this.kr.set(e.id,function(s){return{id:s.id,version:s.version,createTime:re(s.createTime)}}(e)),R.resolve()}getNamedQuery(t,e){return R.resolve(this.qr.get(e))}saveNamedQuery(t,e){return this.qr.set(e.name,function(s){return{name:s.name,query:iv(s.bundledQuery),readTime:re(s.readTime)}}(e)),R.resolve()}};var Il=class{constructor(){this.overlays=new lt(M.comparator),this.Qr=new Map}getOverlay(t,e){return R.resolve(this.overlays.get(e))}getOverlays(t,e){let r=We();return R.forEach(e,s=>this.getOverlay(t,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(t,e,r){return r.forEach((s,i)=>{this.St(t,e,i)}),R.resolve()}removeOverlaysForBatchId(t,e,r){let s=this.Qr.get(r);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.Qr.delete(r)),R.resolve()}getOverlaysForCollection(t,e,r){let s=We(),i=e.length+1,a=new M(e.child("")),l=this.overlays.getIteratorFrom(a);for(;l.hasNext();){let u=l.getNext().value,h=u.getKey();if(!e.isPrefixOf(h.path))break;h.path.length===i&&u.largestBatchId>r&&s.set(u.getKey(),u)}return R.resolve(s)}getOverlaysForCollectionGroup(t,e,r,s){let i=new lt((h,f)=>h-f),a=this.overlays.getIterator();for(;a.hasNext();){let h=a.getNext().value;if(h.getKey().getCollectionGroup()===e&&h.largestBatchId>r){let f=i.get(h.largestBatchId);f===null&&(f=We(),i=i.insert(h.largestBatchId,f)),f.set(h.getKey(),h)}}let l=We(),u=i.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((h,f)=>l.set(h,f)),!(l.size()>=s)););return R.resolve(l)}St(t,e,r){let s=this.overlays.get(r.key);if(s!==null){let a=this.Qr.get(s.largestBatchId).delete(r.key);this.Qr.set(s.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new rl(e,r));let i=this.Qr.get(e);i===void 0&&(i=Q(),this.Qr.set(e,i)),this.Qr.set(e,i.add(r.key))}};var Tl=class{constructor(){this.sessionToken=bt.EMPTY_BYTE_STRING}getSessionToken(t){return R.resolve(this.sessionToken)}setSessionToken(t,e){return this.sessionToken=e,R.resolve()}};var jr=class{constructor(){this.$r=new _t(ht.Ur),this.Kr=new _t(ht.Wr)}isEmpty(){return this.$r.isEmpty()}addReference(t,e){let r=new ht(t,e);this.$r=this.$r.add(r),this.Kr=this.Kr.add(r)}Gr(t,e){t.forEach(r=>this.addReference(r,e))}removeReference(t,e){this.zr(new ht(t,e))}jr(t,e){t.forEach(r=>this.removeReference(r,e))}Hr(t){let e=new M(new dt([])),r=new ht(e,t),s=new ht(e,t+1),i=[];return this.Kr.forEachInRange([r,s],a=>{this.zr(a),i.push(a.key)}),i}Jr(){this.$r.forEach(t=>this.zr(t))}zr(t){this.$r=this.$r.delete(t),this.Kr=this.Kr.delete(t)}Yr(t){let e=new M(new dt([])),r=new ht(e,t),s=new ht(e,t+1),i=Q();return this.Kr.forEachInRange([r,s],a=>{i=i.add(a.key)}),i}containsKey(t){let e=new ht(t,0),r=this.$r.firstAfterOrEqual(e);return r!==null&&t.isEqual(r.key)}},ht=class{constructor(t,e){this.key=t,this.Zr=e}static Ur(t,e){return M.comparator(t.key,e.key)||G(t.Zr,e.Zr)}static Wr(t,e){return G(t.Zr,e.Zr)||M.comparator(t.key,e.key)}};var Al=class{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.nr=1,this.Xr=new _t(ht.Ur)}checkEmpty(t){return R.resolve(this.mutationQueue.length===0)}addMutationBatch(t,e,r,s){let i=this.nr;this.nr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let a=new el(i,e,r,s);this.mutationQueue.push(a);for(let l of s)this.Xr=this.Xr.add(new ht(l.key,i)),this.indexManager.addToCollectionParentIndex(t,l.key.path.popLast());return R.resolve(a)}lookupMutationBatch(t,e){return R.resolve(this.ei(e))}getNextMutationBatchAfterBatchId(t,e){let r=e+1,s=this.ti(r),i=s<0?0:s;return R.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return R.resolve(this.mutationQueue.length===0?pc:this.nr-1)}getAllMutationBatches(t){return R.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){let r=new ht(e,0),s=new ht(e,Number.POSITIVE_INFINITY),i=[];return this.Xr.forEachInRange([r,s],a=>{let l=this.ei(a.Zr);i.push(l)}),R.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(t,e){let r=new _t(G);return e.forEach(s=>{let i=new ht(s,0),a=new ht(s,Number.POSITIVE_INFINITY);this.Xr.forEachInRange([i,a],l=>{r=r.add(l.Zr)})}),R.resolve(this.ni(r))}getAllMutationBatchesAffectingQuery(t,e){let r=e.path,s=r.length+1,i=r;M.isDocumentKey(i)||(i=i.child(""));let a=new ht(new M(i),0),l=new _t(G);return this.Xr.forEachWhile(u=>{let h=u.key.path;return!!r.isPrefixOf(h)&&(h.length===s&&(l=l.add(u.Zr)),!0)},a),R.resolve(this.ni(l))}ni(t){let e=[];return t.forEach(r=>{let s=this.ei(r);s!==null&&e.push(s)}),e}removeMutationBatch(t,e){Z(this.ri(e.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Xr;return R.forEach(e.mutations,s=>{let i=new ht(s.key,e.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(t,s.key)}).next(()=>{this.Xr=r})}sr(t){}containsKey(t,e){let r=new ht(e,0),s=this.Xr.firstAfterOrEqual(r);return R.resolve(e.isEqual(s&&s.key))}performConsistencyCheck(t){return this.mutationQueue.length,R.resolve()}ri(t,e){return this.ti(t)}ti(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}ei(t){let e=this.ti(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}};var Cl=class{constructor(t){this.ii=t,this.docs=function(){return new lt(M.comparator)}(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){let r=e.key,s=this.docs.get(r),i=s?s.size:0,a=this.ii(e);return this.docs=this.docs.insert(r,{document:e.mutableCopy(),size:a}),this.size+=a-i,this.indexManager.addToCollectionParentIndex(t,r.path.popLast())}removeEntry(t){let e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){let r=this.docs.get(e);return R.resolve(r?r.document.mutableCopy():Wt.newInvalidDocument(e))}getEntries(t,e){let r=we();return e.forEach(s=>{let i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():Wt.newInvalidDocument(s))}),R.resolve(r)}getDocumentsMatchingQuery(t,e,r,s){let i=we(),a=e.path,l=new M(a.child("__id-9223372036854775808__")),u=this.docs.getIteratorFrom(l);for(;u.hasNext();){let{key:h,value:{document:f}}=u.getNext();if(!a.isPrefixOf(h.path))break;h.path.length>a.length+1||oy(iy(f),r)<=0||(s.has(f.key)||ao(e,f))&&(i=i.insert(f.key,f.mutableCopy()))}return R.resolve(i)}getAllFromCollectionGroup(t,e,r,s){F(9500)}si(t,e){return R.forEach(this.docs,r=>e(r))}newChangeBuffer(t){return new Sl(this)}getSize(t){return R.resolve(this.size)}},Sl=class extends yl{constructor(t){super(),this.Br=t}applyChanges(t){let e=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?e.push(this.Br.addEntry(t,s)):this.Br.removeEntry(r)}),R.waitFor(e)}getFromCache(t,e){return this.Br.getEntry(t,e)}getAllFromCache(t,e){return this.Br.getEntries(t,e)}};var bl=class{constructor(t){this.persistence=t,this.oi=new ve(e=>wc(e),Ec),this.lastRemoteSnapshotVersion=B.min(),this.highestTargetId=0,this._i=0,this.ai=new jr,this.targetCount=0,this.ui=zr.cr()}forEachTarget(t,e){return this.oi.forEach((r,s)=>e(s)),R.resolve()}getLastRemoteSnapshotVersion(t){return R.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return R.resolve(this._i)}allocateTargetId(t){return this.highestTargetId=this.ui.next(),R.resolve(this.highestTargetId)}setTargetsMetadata(t,e,r){return r&&(this.lastRemoteSnapshotVersion=r),e>this._i&&(this._i=e),R.resolve()}Tr(t){this.oi.set(t.target,t);let e=t.targetId;e>this.highestTargetId&&(this.ui=new zr(e),this.highestTargetId=e),t.sequenceNumber>this._i&&(this._i=t.sequenceNumber)}addTargetData(t,e){return this.Tr(e),this.targetCount+=1,R.resolve()}updateTargetData(t,e){return this.Tr(e),R.resolve()}removeTargetData(t,e){return this.oi.delete(e.target),this.ai.Hr(e.targetId),this.targetCount-=1,R.resolve()}removeTargets(t,e,r){let s=0,i=[];return this.oi.forEach((a,l)=>{l.sequenceNumber<=e&&r.get(l.targetId)===null&&(this.oi.delete(a),i.push(this.removeMatchingKeysForTargetId(t,l.targetId)),s++)}),R.waitFor(i).next(()=>s)}getTargetCount(t){return R.resolve(this.targetCount)}getTargetData(t,e){let r=this.oi.get(e)||null;return R.resolve(r)}addMatchingKeys(t,e,r){return this.ai.Gr(e,r),R.resolve()}removeMatchingKeys(t,e,r){this.ai.jr(e,r);let s=this.persistence.referenceDelegate,i=[];return s&&e.forEach(a=>{i.push(s.markPotentiallyOrphaned(t,a))}),R.waitFor(i)}removeMatchingKeysForTargetId(t,e){return this.ai.Hr(e),R.resolve()}getMatchingKeysForTargetId(t,e){let r=this.ai.Yr(e);return R.resolve(r)}containsKey(t,e){return R.resolve(this.ai.containsKey(e))}};var Oi=class{constructor(t,e){this.ci={},this.overlays={},this.li=new mc(0),this.hi=!1,this.hi=!0,this.Pi=new Tl,this.referenceDelegate=t(this),this.Ti=new bl(this),this.indexManager=new fl,this.remoteDocumentCache=function(s){return new Cl(s)}(r=>this.referenceDelegate.Ii(r)),this.serializer=new dl(e),this.Ei=new El(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.hi=!1,Promise.resolve()}get started(){return this.hi}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new Il,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let r=this.ci[t.toKey()];return r||(r=new Al(e,this.referenceDelegate),this.ci[t.toKey()]=r),r}getGlobalsCache(){return this.Pi}getTargetCache(){return this.Ti}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ei}runTransaction(t,e,r){V("MemoryPersistence","Starting transaction:",t);let s=new Rl(this.li.next());return this.referenceDelegate.di(),r(s).next(i=>this.referenceDelegate.Ai(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Ri(t,e){return R.or(Object.values(this.ci).map(r=>()=>r.containsKey(t,e)))}},Rl=class extends La{constructor(t){super(),this.currentSequenceNumber=t}},Pl=class n{constructor(t){this.persistence=t,this.Vi=new jr,this.mi=null}static fi(t){return new n(t)}get gi(){if(this.mi)return this.mi;throw F(60996)}addReference(t,e,r){return this.Vi.addReference(r,e),this.gi.delete(r.toString()),R.resolve()}removeReference(t,e,r){return this.Vi.removeReference(r,e),this.gi.add(r.toString()),R.resolve()}markPotentiallyOrphaned(t,e){return this.gi.add(e.toString()),R.resolve()}removeTarget(t,e){this.Vi.Hr(e.targetId).forEach(s=>this.gi.add(s.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next(s=>{s.forEach(i=>this.gi.add(i.toString()))}).next(()=>r.removeTargetData(t,e))}di(){this.mi=new Set}Ai(t){let e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return R.forEach(this.gi,r=>{let s=M.fromPath(r);return this.pi(t,s).next(i=>{i||e.removeEntry(s,B.min())})}).next(()=>(this.mi=null,e.apply(t)))}updateLimboDocument(t,e){return this.pi(t,e).next(r=>{r?this.gi.delete(e.toString()):this.gi.add(e.toString())})}Ii(t){return 0}pi(t,e){return R.or([()=>R.resolve(this.Vi.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Ri(t,e)])}},Fi=class n{constructor(t,e){this.persistence=t,this.yi=new ve(r=>uy(r.path),(r,s)=>r.isEqual(s)),this.garbageCollector=av(this,e)}static fi(t,e){return new n(t,e)}di(){}Ai(t){return R.resolve()}forEachTarget(t,e){return this.persistence.getTargetCache().forEachTarget(t,e)}pr(t){let e=this.br(t);return this.persistence.getTargetCache().getTargetCount(t).next(r=>e.next(s=>r+s))}br(t){let e=0;return this.yr(t,r=>{e++}).next(()=>e)}yr(t,e){return R.forEach(this.yi,(r,s)=>this.Dr(t,r,s).next(i=>i?R.resolve():e(s)))}removeTargets(t,e,r){return this.persistence.getTargetCache().removeTargets(t,e,r)}removeOrphanedDocuments(t,e){let r=0,s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.si(t,a=>this.Dr(t,a,e).next(l=>{l||(r++,i.removeEntry(a,B.min()))})).next(()=>i.apply(t)).next(()=>r)}markPotentiallyOrphaned(t,e){return this.yi.set(e,t.currentSequenceNumber),R.resolve()}removeTarget(t,e){let r=e.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,r)}addReference(t,e,r){return this.yi.set(r,t.currentSequenceNumber),R.resolve()}removeReference(t,e,r){return this.yi.set(r,t.currentSequenceNumber),R.resolve()}updateLimboDocument(t,e){return this.yi.set(e,t.currentSequenceNumber),R.resolve()}Ii(t){let e=t.key.toString().length;return t.isFoundDocument()&&(e+=pi(t.data.value)),e}Dr(t,e,r){return R.or([()=>this.persistence.Ri(t,e),()=>this.persistence.getTargetCache().containsKey(t,e),()=>{let s=this.yi.get(e);return R.resolve(s!==void 0&&s>r)}])}getCacheSize(t){return this.persistence.getRemoteDocumentCache().getSize(t)}};var xl=class n{constructor(t,e,r,s){this.targetId=t,this.fromCache=e,this.ds=r,this.As=s}static Rs(t,e){let r=Q(),s=Q();for(let i of e.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new n(t,e.fromCache,r,s)}};var Nl=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}};var Dl=class{constructor(){this.Vs=!1,this.fs=!1,this.gs=100,this.ps=function(){return kd()?8:ly(Nd())>0?6:4}()}initialize(t,e){this.ys=t,this.indexManager=e,this.Vs=!0}getDocumentsMatchingQuery(t,e,r,s){let i={result:null};return this.ws(t,e).next(a=>{i.result=a}).next(()=>{if(!i.result)return this.bs(t,e,s,r).next(a=>{i.result=a})}).next(()=>{if(i.result)return;let a=new Nl;return this.Ss(t,e,a).next(l=>{if(i.result=l,this.fs)return this.Ds(t,e,a,l.size)})}).next(()=>i.result)}Ds(t,e,r,s){return r.documentReadCount<this.gs?(In()<=Ut.DEBUG&&V("QueryEngine","SDK will not create cache indexes for query:",Tn(e),"since it only creates cache indexes for collection contains","more than or equal to",this.gs,"documents"),R.resolve()):(In()<=Ut.DEBUG&&V("QueryEngine","Query:",Tn(e),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.ps*s?(In()<=Ut.DEBUG&&V("QueryEngine","The SDK decides to create cache indexes for query:",Tn(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,ne(e))):R.resolve())}ws(t,e){if(of(e))return R.resolve(null);let r=ne(e);return this.indexManager.getIndexType(t,r).next(s=>s===0?null:(e.limit!==null&&s===1&&(e=Ja(e,null,"F"),r=ne(e)),this.indexManager.getDocumentsMatchingTarget(t,r).next(i=>{let a=Q(...i);return this.ys.getDocuments(t,a).next(l=>this.indexManager.getMinOffset(t,r).next(u=>{let h=this.vs(e,l);return this.Cs(e,h,a,u.readTime)?this.ws(t,Ja(e,null,"F")):this.Fs(t,h,e,u)}))})))}bs(t,e,r,s){return of(e)||s.isEqual(B.min())?R.resolve(null):this.ys.getDocuments(t,r).next(i=>{let a=this.vs(e,i);return this.Cs(e,a,r,s)?R.resolve(null):(In()<=Ut.DEBUG&&V("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Tn(e)),this.Fs(t,a,e,sy(s,Lr)).next(l=>l))})}vs(t,e){let r=new _t(hm(t));return e.forEach((s,i)=>{ao(t,i)&&(r=r.add(i))}),r}Cs(t,e,r,s){if(t.limit===null)return!1;if(r.size!==e.size)return!0;let i=t.limitType==="F"?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Ss(t,e,r){return In()<=Ut.DEBUG&&V("QueryEngine","Using full collection scan to execute query:",Tn(e)),this.ys.getDocumentsMatchingQuery(t,e,Xe.min(),r)}Fs(t,e,r,s){return this.ys.getDocumentsMatchingQuery(t,r,s).next(i=>(e.forEach(a=>{i=i.insert(a.key,a)}),i))}};var Ac="LocalStore",lv=3e8,kl=class{constructor(t,e,r,s){this.persistence=t,this.Ms=e,this.serializer=s,this.xs=new lt(G),this.Os=new ve(i=>wc(i),Ec),this.Ns=new Map,this.Bs=t.getRemoteDocumentCache(),this.Ti=t.getTargetCache(),this.Ei=t.getBundleCache(),this.Ls(r)}Ls(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new wl(this.Bs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Bs.setIndexManager(this.indexManager),this.Ms.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.xs))}};function cv(n,t,e,r){return new kl(n,t,e,r)}async function Nm(n,t){let e=L(n);return await e.persistence.runTransaction("Handle user change","readonly",r=>{let s;return e.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,e.Ls(t),e.mutationQueue.getAllMutationBatches(r))).next(i=>{let a=[],l=[],u=Q();for(let h of s){a.push(h.batchId);for(let f of h.mutations)u=u.add(f.key)}for(let h of i){l.push(h.batchId);for(let f of h.mutations)u=u.add(f.key)}return e.localDocuments.getDocuments(r,u).next(h=>({ks:h,removedBatchIds:a,addedBatchIds:l}))})})}function uv(n,t){let e=L(n);return e.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let s=t.batch.keys(),i=e.Bs.newChangeBuffer({trackRemovals:!0});return function(l,u,h,f){let p=h.batch,g=p.keys(),A=R.resolve();return g.forEach(b=>{A=A.next(()=>f.getEntry(u,b)).next(N=>{let x=h.docVersions.get(b);Z(x!==null,48541),N.version.compareTo(x)<0&&(p.applyToRemoteDocument(N,h),N.isValidDocument()&&(N.setReadTime(h.commitVersion),f.addEntry(N)))})}),A.next(()=>l.mutationQueue.removeMutationBatch(u,p))}(e,r,t,i).next(()=>i.apply(r)).next(()=>e.mutationQueue.performConsistencyCheck(r)).next(()=>e.documentOverlayCache.removeOverlaysForBatchId(r,s,t.batch.batchId)).next(()=>e.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(l){let u=Q();for(let h=0;h<l.mutationResults.length;++h)l.mutationResults[h].transformResults.length>0&&(u=u.add(l.batch.mutations[h].key));return u}(t))).next(()=>e.localDocuments.getDocuments(r,s))})}function Dm(n){let t=L(n);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Ti.getLastRemoteSnapshotVersion(e))}function hv(n,t){let e=L(n),r=t.snapshotVersion,s=e.xs;return e.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{let a=e.Bs.newChangeBuffer({trackRemovals:!0});s=e.xs;let l=[];t.targetChanges.forEach((f,p)=>{let g=s.get(p);if(!g)return;l.push(e.Ti.removeMatchingKeys(i,f.removedDocuments,p).next(()=>e.Ti.addMatchingKeys(i,f.addedDocuments,p)));let A=g.withSequenceNumber(i.currentSequenceNumber);t.targetMismatches.get(p)!==null?A=A.withResumeToken(bt.EMPTY_BYTE_STRING,B.min()).withLastLimboFreeSnapshotVersion(B.min()):f.resumeToken.approximateByteSize()>0&&(A=A.withResumeToken(f.resumeToken,r)),s=s.insert(p,A),function(N,x,U){return N.resumeToken.approximateByteSize()===0||x.snapshotVersion.toMicroseconds()-N.snapshotVersion.toMicroseconds()>=lv?!0:U.addedDocuments.size+U.modifiedDocuments.size+U.removedDocuments.size>0}(g,A,f)&&l.push(e.Ti.updateTargetData(i,A))});let u=we(),h=Q();if(t.documentUpdates.forEach(f=>{t.resolvedLimboDocuments.has(f)&&l.push(e.persistence.referenceDelegate.updateLimboDocument(i,f))}),l.push(dv(i,a,t.documentUpdates).next(f=>{u=f.qs,h=f.Qs})),!r.isEqual(B.min())){let f=e.Ti.getLastRemoteSnapshotVersion(i).next(p=>e.Ti.setTargetsMetadata(i,i.currentSequenceNumber,r));l.push(f)}return R.waitFor(l).next(()=>a.apply(i)).next(()=>e.localDocuments.getLocalViewOfDocuments(i,u,h)).next(()=>u)}).then(i=>(e.xs=s,i))}function dv(n,t,e){let r=Q(),s=Q();return e.forEach(i=>r=r.add(i)),t.getEntries(n,r).next(i=>{let a=we();return e.forEach((l,u)=>{let h=i.get(l);u.isFoundDocument()!==h.isFoundDocument()&&(s=s.add(l)),u.isNoDocument()&&u.version.isEqual(B.min())?(t.removeEntry(l,u.readTime),a=a.insert(l,u)):!h.isValidDocument()||u.version.compareTo(h.version)>0||u.version.compareTo(h.version)===0&&h.hasPendingWrites?(t.addEntry(u),a=a.insert(l,u)):V(Ac,"Ignoring outdated watch update for ",l,". Current version:",h.version," Watch version:",u.version)}),{qs:a,Qs:s}})}function fv(n,t){let e=L(n);return e.persistence.runTransaction("Get next mutation batch","readonly",r=>(t===void 0&&(t=pc),e.mutationQueue.getNextMutationBatchAfterBatchId(r,t)))}function mv(n,t){let e=L(n);return e.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return e.Ti.getTargetData(r,t).next(i=>i?(s=i,R.resolve(s)):e.Ti.allocateTargetId(r).next(a=>(s=new Gr(t,a,"TargetPurposeListen",r.currentSequenceNumber),e.Ti.addTargetData(r,s).next(()=>s))))}).then(r=>{let s=e.xs.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(e.xs=e.xs.insert(r.targetId,r),e.Os.set(t,r.targetId)),r})}async function Vl(n,t,e){let r=L(n),s=r.xs.get(t),i=e?"readwrite":"readwrite-primary";try{e||await r.persistence.runTransaction("Release target",i,a=>r.persistence.referenceDelegate.removeTarget(a,s))}catch(a){if(!jn(a))throw a;V(Ac,`Failed to update sequence numbers for target ${t}: ${a}`)}r.xs=r.xs.remove(t),r.Os.delete(s.target)}function vf(n,t,e){let r=L(n),s=B.min(),i=Q();return r.persistence.runTransaction("Execute query","readwrite",a=>function(u,h,f){let p=L(u),g=p.Os.get(f);return g!==void 0?R.resolve(p.xs.get(g)):p.Ti.getTargetData(h,f)}(r,a,ne(t)).next(l=>{if(l)return s=l.lastLimboFreeSnapshotVersion,r.Ti.getMatchingKeysForTargetId(a,l.targetId).next(u=>{i=u})}).next(()=>r.Ms.getDocumentsMatchingQuery(a,t,e?s:B.min(),e?i:Q())).next(l=>(pv(r,Ry(t),l),{documents:l,$s:i})))}function pv(n,t,e){let r=n.Ns.get(t)||B.min();e.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),n.Ns.set(t,r)}var Mi=class{constructor(){this.activeTargetIds=Vy()}js(t){this.activeTargetIds=this.activeTargetIds.add(t)}Hs(t){this.activeTargetIds=this.activeTargetIds.delete(t)}zs(){let t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}};var Ol=class{constructor(){this.xo=new Mi,this.Oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,r){}addLocalQueryTarget(t,e=!0){return e&&this.xo.js(t),this.Oo[t]||"not-current"}updateQueryState(t,e,r){this.Oo[t]=e}removeLocalQueryTarget(t){this.xo.Hs(t)}isLocalQueryTarget(t){return this.xo.activeTargetIds.has(t)}clearQueryState(t){delete this.Oo[t]}getAllActiveQueryTargets(){return this.xo.activeTargetIds}isActiveQueryTarget(t){return this.xo.activeTargetIds.has(t)}start(){return this.xo=new Mi,Promise.resolve()}handleUserChange(t,e,r){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}};var Fl=class{No(t){}shutdown(){}};var wf="ConnectivityMonitor",Li=class{constructor(){this.Bo=()=>this.Lo(),this.ko=()=>this.qo(),this.Qo=[],this.$o()}No(t){this.Qo.push(t)}shutdown(){window.removeEventListener("online",this.Bo),window.removeEventListener("offline",this.ko)}$o(){window.addEventListener("online",this.Bo),window.addEventListener("offline",this.ko)}Lo(){V(wf,"Network connectivity changed: AVAILABLE");for(let t of this.Qo)t(0)}qo(){V(wf,"Network connectivity changed: UNAVAILABLE");for(let t of this.Qo)t(1)}static C(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var mi=null;function Ml(){return mi===null?mi=function(){return 268435456+Math.round(2147483648*Math.random())}():mi++,"0x"+mi.toString(16)}var ba="RestConnection",gv={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"},Ll=class{get Uo(){return!1}constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;let e=t.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Ko=e+"://"+t.host,this.Wo=`projects/${r}/databases/${s}`,this.Go=this.databaseId.database===Ai?`project_id=${r}`:`project_id=${r}&database_id=${s}`}zo(t,e,r,s,i){let a=Ml(),l=this.jo(t,e.toUriEncodedString());V(ba,`Sending RPC '${t}' ${a}:`,l,r);let u={"google-cloud-resource-prefix":this.Wo,"x-goog-request-params":this.Go};this.Ho(u,s,i);let{host:h}=new URL(l),f=vn(h);return this.Jo(t,l,u,r,f).then(p=>(V(ba,`Received RPC '${t}' ${a}: `,p),p),p=>{throw Pn(ba,`RPC '${t}' ${a} failed with error: `,p,"url: ",l,"request:",r),p})}Yo(t,e,r,s,i,a){return this.zo(t,e,r,s,i)}Ho(t,e,r){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Gn}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach((s,i)=>t[i]=s),r&&r.headers.forEach((s,i)=>t[i]=s)}jo(t,e){let r=gv[t];return`${this.Ko}/v1/${e}:${r}`}terminate(){}};var Bl=class{constructor(t){this.Zo=t.Zo,this.Xo=t.Xo}e_(t){this.t_=t}n_(t){this.r_=t}i_(t){this.s_=t}onMessage(t){this.o_=t}close(){this.Xo()}send(t){this.Zo(t)}__(){this.t_()}a_(){this.r_()}u_(t){this.s_(t)}c_(t){this.o_(t)}};var St="WebChannelConnection",Ul=class extends Ll{constructor(t){super(t),this.l_=[],this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Jo(t,e,r,s,i){let a=Ml();return new Promise((l,u)=>{let h=new Ea;h.setWithCredentials(!0),h.listenOnce(Ia.COMPLETE,()=>{try{switch(h.getLastErrorCode()){case Dr.NO_ERROR:let p=h.getResponseJson();V(St,`XHR for RPC '${t}' ${a} received:`,JSON.stringify(p)),l(p);break;case Dr.TIMEOUT:V(St,`RPC '${t}' ${a} timed out`),u(new O(P.DEADLINE_EXCEEDED,"Request time out"));break;case Dr.HTTP_ERROR:let g=h.getStatus();if(V(St,`RPC '${t}' ${a} failed with status:`,g,"response text:",h.getResponseText()),g>0){let A=h.getResponseJson();Array.isArray(A)&&(A=A[0]);let b=A?.error;if(b&&b.status&&b.message){let N=function(U){let q=U.toLowerCase().replace(/_/g,"-");return Object.values(P).indexOf(q)>=0?q:P.UNKNOWN}(b.status);u(new O(N,b.message))}else u(new O(P.UNKNOWN,"Server responded with status "+h.getStatus()))}else u(new O(P.UNAVAILABLE,"Connection failed."));break;default:F(9055,{h_:t,streamId:a,P_:h.getLastErrorCode(),T_:h.getLastError()})}}finally{V(St,`RPC '${t}' ${a} completed.`)}});let f=JSON.stringify(s);V(St,`RPC '${t}' ${a} sending request:`,s),h.send(e,"POST",f,r,15)})}I_(t,e,r){let s=Ml(),i=[this.Ko,"/","google.firestore.v1.Firestore","/",t,"/channel"],a=Ca(),l=Aa(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;h!==void 0&&(u.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(u.useFetchStreams=!0),this.Ho(u.initMessageHeaders,e,r),u.encodeInitMessageHeaders=!0;let f=i.join("");V(St,`Creating RPC '${t}' stream ${s}: ${f}`,u);let p=a.createWebChannel(f,u);this.E_(p);let g=!1,A=!1,b=new Bl({Zo:x=>{A?V(St,`Not sending because RPC '${t}' stream ${s} is closed:`,x):(g||(V(St,`Opening RPC '${t}' stream ${s} transport.`),p.open(),g=!0),V(St,`RPC '${t}' stream ${s} sending:`,x),p.send(x))},Xo:()=>p.close()}),N=(x,U,q)=>{x.listen(U,W=>{try{q(W)}catch(st){setTimeout(()=>{throw st},0)}})};return N(p,En.EventType.OPEN,()=>{A||(V(St,`RPC '${t}' stream ${s} transport opened.`),b.__())}),N(p,En.EventType.CLOSE,()=>{A||(A=!0,V(St,`RPC '${t}' stream ${s} transport closed`),b.u_(),this.d_(p))}),N(p,En.EventType.ERROR,x=>{A||(A=!0,Pn(St,`RPC '${t}' stream ${s} transport errored. Name:`,x.name,"Message:",x.message),b.u_(new O(P.UNAVAILABLE,"The operation could not be completed")))}),N(p,En.EventType.MESSAGE,x=>{var U;if(!A){let q=x.data[0];Z(!!q,16349);let W=q,st=W?.error||((U=W[0])===null||U===void 0?void 0:U.error);if(st){V(St,`RPC '${t}' stream ${s} received error:`,st);let Bt=st.status,nt=function(v){let w=ut[v];if(w!==void 0)return Im(w)}(Bt),I=st.message;nt===void 0&&(nt=P.INTERNAL,I="Unknown error status: "+Bt+" with message "+st.message),A=!0,b.u_(new O(nt,I)),p.close()}else V(St,`RPC '${t}' stream ${s} received:`,q),b.c_(q)}}),N(l,Ta.STAT_EVENT,x=>{x.stat===hi.PROXY?V(St,`RPC '${t}' stream ${s} detected buffering proxy`):x.stat===hi.NOPROXY&&V(St,`RPC '${t}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{b.a_()},0),b}terminate(){this.l_.forEach(t=>t.close()),this.l_=[]}E_(t){this.l_.push(t)}d_(t){this.l_=this.l_.filter(e=>e===t)}};function Ra(){return typeof document<"u"?document:null}function lo(n){return new al(n,!0)}var Bi=class{constructor(t,e,r=1e3,s=1.5,i=6e4){this.xi=t,this.timerId=e,this.A_=r,this.R_=s,this.V_=i,this.m_=0,this.f_=null,this.g_=Date.now(),this.reset()}reset(){this.m_=0}p_(){this.m_=this.V_}y_(t){this.cancel();let e=Math.floor(this.m_+this.w_()),r=Math.max(0,Date.now()-this.g_),s=Math.max(0,e-r);s>0&&V("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.m_} ms, delay with jitter: ${e} ms, last attempt: ${r} ms ago)`),this.f_=this.xi.enqueueAfterDelay(this.timerId,s,()=>(this.g_=Date.now(),t())),this.m_*=this.R_,this.m_<this.A_&&(this.m_=this.A_),this.m_>this.V_&&(this.m_=this.V_)}b_(){this.f_!==null&&(this.f_.skipDelay(),this.f_=null)}cancel(){this.f_!==null&&(this.f_.cancel(),this.f_=null)}w_(){return(Math.random()-.5)*this.m_}};var Ef="PersistentStream",Ui=class{constructor(t,e,r,s,i,a,l,u){this.xi=t,this.S_=r,this.D_=s,this.connection=i,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=l,this.listener=u,this.state=0,this.v_=0,this.C_=null,this.F_=null,this.stream=null,this.M_=0,this.x_=new Bi(t,e)}O_(){return this.state===1||this.state===5||this.N_()}N_(){return this.state===2||this.state===3}start(){this.M_=0,this.state!==4?this.auth():this.B_()}async stop(){this.O_()&&await this.close(0)}L_(){this.state=0,this.x_.reset()}k_(){this.N_()&&this.C_===null&&(this.C_=this.xi.enqueueAfterDelay(this.S_,6e4,()=>this.q_()))}Q_(t){this.U_(),this.stream.send(t)}async q_(){if(this.N_())return this.close(0)}U_(){this.C_&&(this.C_.cancel(),this.C_=null)}K_(){this.F_&&(this.F_.cancel(),this.F_=null)}async close(t,e){this.U_(),this.K_(),this.x_.cancel(),this.v_++,t!==4?this.x_.reset():e&&e.code===P.RESOURCE_EXHAUSTED?(ge(e.toString()),ge("Using maximum backoff delay to prevent overloading the backend."),this.x_.p_()):e&&e.code===P.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.W_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.i_(e)}W_(){}auth(){this.state=1;let t=this.G_(this.v_),e=this.v_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.v_===e&&this.z_(r,s)},r=>{t(()=>{let s=new O(P.UNKNOWN,"Fetching auth token failed: "+r.message);return this.j_(s)})})}z_(t,e){let r=this.G_(this.v_);this.stream=this.H_(t,e),this.stream.e_(()=>{r(()=>this.listener.e_())}),this.stream.n_(()=>{r(()=>(this.state=2,this.F_=this.xi.enqueueAfterDelay(this.D_,1e4,()=>(this.N_()&&(this.state=3),Promise.resolve())),this.listener.n_()))}),this.stream.i_(s=>{r(()=>this.j_(s))}),this.stream.onMessage(s=>{r(()=>++this.M_==1?this.J_(s):this.onNext(s))})}B_(){this.state=5,this.x_.y_(async()=>{this.state=0,this.start()})}j_(t){return V(Ef,`close with error: ${t}`),this.stream=null,this.close(4,t)}G_(t){return e=>{this.xi.enqueueAndForget(()=>this.v_===t?e():(V(Ef,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},ql=class extends Ui{constructor(t,e,r,s,i,a){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,r,s,a),this.serializer=i}H_(t,e){return this.connection.I_("Listen",t,e)}J_(t){return this.onNext(t)}onNext(t){this.x_.reset();let e=Qy(this.serializer,t),r=function(i){if(!("targetChange"in i))return B.min();let a=i.targetChange;return a.targetIds&&a.targetIds.length?B.min():a.readTime?re(a.readTime):B.min()}(t);return this.listener.Y_(e,r)}Z_(t){let e={};e.database=hl(this.serializer),e.addTarget=function(i,a){let l,u=a.target;if(l=Xa(u)?{documents:Xy(i,u)}:{query:Jy(i,u).gt},l.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){l.resumeToken=Tm(i,a.resumeToken);let h=ll(i,a.expectedCount);h!==null&&(l.expectedCount=h)}else if(a.snapshotVersion.compareTo(B.min())>0){l.readTime=ki(i,a.snapshotVersion.toTimestamp());let h=ll(i,a.expectedCount);h!==null&&(l.expectedCount=h)}return l}(this.serializer,t);let r=tv(this.serializer,t);r&&(e.labels=r),this.Q_(e)}X_(t){let e={};e.database=hl(this.serializer),e.removeTarget=t,this.Q_(e)}},$l=class extends Ui{constructor(t,e,r,s,i,a){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,r,s,a),this.serializer=i}get ea(){return this.M_>0}start(){this.lastStreamToken=void 0,super.start()}W_(){this.ea&&this.ta([])}H_(t,e){return this.connection.I_("Write",t,e)}J_(t){return Z(!!t.streamToken,31322),this.lastStreamToken=t.streamToken,Z(!t.writeResults||t.writeResults.length===0,55816),this.listener.na()}onNext(t){Z(!!t.streamToken,12678),this.lastStreamToken=t.streamToken,this.x_.reset();let e=Yy(t.writeResults,t.commitTime),r=re(t.commitTime);return this.listener.ra(r,e)}ia(){let t={};t.database=hl(this.serializer),this.Q_(t)}ta(t){let e={streamToken:this.lastStreamToken,writes:t.map(r=>Hy(this.serializer,r))};this.Q_(e)}};var Gl=class{},zl=class extends Gl{constructor(t,e,r,s){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=r,this.serializer=s,this.sa=!1}oa(){if(this.sa)throw new O(P.FAILED_PRECONDITION,"The client has already been terminated.")}zo(t,e,r,s){return this.oa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,a])=>this.connection.zo(t,cl(e,r),s,i,a)).catch(i=>{throw i.name==="FirebaseError"?(i.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new O(P.UNKNOWN,i.toString())})}Yo(t,e,r,s,i){return this.oa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,l])=>this.connection.Yo(t,cl(e,r),s,a,l,i)).catch(a=>{throw a.name==="FirebaseError"?(a.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new O(P.UNKNOWN,a.toString())})}terminate(){this.sa=!0,this.connection.terminate()}},jl=class{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this._a=0,this.aa=null,this.ua=!0}ca(){this._a===0&&(this.la("Unknown"),this.aa=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.aa=null,this.ha("Backend didn't respond within 10 seconds."),this.la("Offline"),Promise.resolve())))}Pa(t){this.state==="Online"?this.la("Unknown"):(this._a++,this._a>=1&&(this.Ta(),this.ha(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.la("Offline")))}set(t){this.Ta(),this._a=0,t==="Online"&&(this.ua=!1),this.la(t)}la(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}ha(t){let e=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.ua?(ge(e),this.ua=!1):V("OnlineStateTracker",e)}Ta(){this.aa!==null&&(this.aa.cancel(),this.aa=null)}};var Ze="RemoteStore",Kl=class{constructor(t,e,r,s,i){this.localStore=t,this.datastore=e,this.asyncQueue=r,this.remoteSyncer={},this.Ia=[],this.Ea=new Map,this.da=new Set,this.Aa=[],this.Ra=i,this.Ra.No(a=>{r.enqueueAndForget(async()=>{en(this)&&(V(Ze,"Restarting streams for network reachability change."),await async function(u){let h=L(u);h.da.add(4),await Jr(h),h.Va.set("Unknown"),h.da.delete(4),await co(h)}(this))})}),this.Va=new jl(r,s)}};async function co(n){if(en(n))for(let t of n.Aa)await t(!0)}async function Jr(n){for(let t of n.Aa)await t(!1)}function km(n,t){let e=L(n);e.Ea.has(t.targetId)||(e.Ea.set(t.targetId,t),Rc(e)?bc(e):Kn(e).N_()&&Sc(e,t))}function Cc(n,t){let e=L(n),r=Kn(e);e.Ea.delete(t),r.N_()&&Vm(e,t),e.Ea.size===0&&(r.N_()?r.k_():en(e)&&e.Va.set("Unknown"))}function Sc(n,t){if(n.ma.Ke(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(B.min())>0){let e=n.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(e)}Kn(n).Z_(t)}function Vm(n,t){n.ma.Ke(t),Kn(n).X_(t)}function bc(n){n.ma=new ol({getRemoteKeysForTarget:t=>n.remoteSyncer.getRemoteKeysForTarget(t),Rt:t=>n.Ea.get(t)||null,Pt:()=>n.datastore.serializer.databaseId}),Kn(n).start(),n.Va.ca()}function Rc(n){return en(n)&&!Kn(n).O_()&&n.Ea.size>0}function en(n){return L(n).da.size===0}function Om(n){n.ma=void 0}async function _v(n){n.Va.set("Online")}async function yv(n){n.Ea.forEach((t,e)=>{Sc(n,t)})}async function vv(n,t){Om(n),Rc(n)?(n.Va.Pa(t),bc(n)):n.Va.set("Unknown")}async function wv(n,t,e){if(n.Va.set("Online"),t instanceof Ni&&t.state===2&&t.cause)try{await async function(s,i){let a=i.cause;for(let l of i.targetIds)s.Ea.has(l)&&(await s.remoteSyncer.rejectListen(l,a),s.Ea.delete(l),s.ma.removeTarget(l))}(n,t)}catch(r){V(Ze,"Failed to remove targets %s: %s ",t.targetIds.join(","),r),await qi(n,r)}else if(t instanceof bn?n.ma.Xe(t):t instanceof xi?n.ma.ot(t):n.ma.nt(t),!e.isEqual(B.min()))try{let r=await Dm(n.localStore);e.compareTo(r)>=0&&await function(i,a){let l=i.ma.It(a);return l.targetChanges.forEach((u,h)=>{if(u.resumeToken.approximateByteSize()>0){let f=i.Ea.get(h);f&&i.Ea.set(h,f.withResumeToken(u.resumeToken,a))}}),l.targetMismatches.forEach((u,h)=>{let f=i.Ea.get(u);if(!f)return;i.Ea.set(u,f.withResumeToken(bt.EMPTY_BYTE_STRING,f.snapshotVersion)),Vm(i,u);let p=new Gr(f.target,u,h,f.sequenceNumber);Sc(i,p)}),i.remoteSyncer.applyRemoteEvent(l)}(n,e)}catch(r){V(Ze,"Failed to raise snapshot:",r),await qi(n,r)}}async function qi(n,t,e){if(!jn(t))throw t;n.da.add(1),await Jr(n),n.Va.set("Offline"),e||(e=()=>Dm(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{V(Ze,"Retrying IndexedDB access"),await e(),n.da.delete(1),await co(n)})}function Fm(n,t){return t().catch(e=>qi(n,e,t))}async function uo(n){let t=L(n),e=ke(t),r=t.Ia.length>0?t.Ia[t.Ia.length-1].batchId:pc;for(;Ev(t);)try{let s=await fv(t.localStore,r);if(s===null){t.Ia.length===0&&e.k_();break}r=s.batchId,Iv(t,s)}catch(s){await qi(t,s)}Mm(t)&&Lm(t)}function Ev(n){return en(n)&&n.Ia.length<10}function Iv(n,t){n.Ia.push(t);let e=ke(n);e.N_()&&e.ea&&e.ta(t.mutations)}function Mm(n){return en(n)&&!ke(n).O_()&&n.Ia.length>0}function Lm(n){ke(n).start()}async function Tv(n){ke(n).ia()}async function Av(n){let t=ke(n);for(let e of n.Ia)t.ta(e.mutations)}async function Cv(n,t,e){let r=n.Ia.shift(),s=nl.from(r,t,e);await Fm(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),await uo(n)}async function Sv(n,t){t&&ke(n).ea&&await async function(r,s){if(function(a){return qy(a)&&a!==P.ABORTED}(s.code)){let i=r.Ia.shift();ke(r).L_(),await Fm(r,()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s)),await uo(r)}}(n,t),Mm(n)&&Lm(n)}async function If(n,t){let e=L(n);e.asyncQueue.verifyOperationInProgress(),V(Ze,"RemoteStore received new credentials");let r=en(e);e.da.add(3),await Jr(e),r&&e.Va.set("Unknown"),await e.remoteSyncer.handleCredentialChange(t),e.da.delete(3),await co(e)}async function bv(n,t){let e=L(n);t?(e.da.delete(2),await co(e)):t||(e.da.add(2),await Jr(e),e.Va.set("Unknown"))}function Kn(n){return n.fa||(n.fa=function(e,r,s){let i=L(e);return i.oa(),new ql(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{e_:_v.bind(null,n),n_:yv.bind(null,n),i_:vv.bind(null,n),Y_:wv.bind(null,n)}),n.Aa.push(async t=>{t?(n.fa.L_(),Rc(n)?bc(n):n.Va.set("Unknown")):(await n.fa.stop(),Om(n))})),n.fa}function ke(n){return n.ga||(n.ga=function(e,r,s){let i=L(e);return i.oa(),new $l(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{e_:()=>Promise.resolve(),n_:Tv.bind(null,n),i_:Sv.bind(null,n),na:Av.bind(null,n),ra:Cv.bind(null,n)}),n.Aa.push(async t=>{t?(n.ga.L_(),await uo(n)):(await n.ga.stop(),n.Ia.length>0&&(V(Ze,`Stopping write stream with ${n.Ia.length} pending writes`),n.Ia=[]))})),n.ga}var Wl=class n{constructor(t,e,r,s,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new te,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(t,e,r,s,i){let a=Date.now()+r,l=new n(t,e,a,s,i);return l.start(r),l}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new O(P.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function Pc(n,t){if(ge("AsyncQueue",`${t}: ${n}`),jn(n))return new O(P.UNAVAILABLE,`${t}: ${n}`);throw n}var $i=class n{static emptySet(t){return new n(t.comparator)}constructor(t){this.comparator=t?(e,r)=>t(e,r)||M.comparator(e.key,r.key):(e,r)=>M.comparator(e.key,r.key),this.keyedMap=kr(),this.sortedSet=new lt(this.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){let e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal((e,r)=>(t(e),!1))}add(t){let e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){let e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof n)||this.size!==t.size)return!1;let e=this.sortedSet.getIterator(),r=t.sortedSet.getIterator();for(;e.hasNext();){let s=e.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){let t=[];return this.forEach(e=>{t.push(e.toString())}),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,e){let r=new n;return r.comparator=this.comparator,r.keyedMap=t,r.sortedSet=e,r}};var Gi=class{constructor(){this.pa=new lt(M.comparator)}track(t){let e=t.doc.key,r=this.pa.get(e);r?t.type!==0&&r.type===3?this.pa=this.pa.insert(e,t):t.type===3&&r.type!==1?this.pa=this.pa.insert(e,{type:r.type,doc:t.doc}):t.type===2&&r.type===2?this.pa=this.pa.insert(e,{type:2,doc:t.doc}):t.type===2&&r.type===0?this.pa=this.pa.insert(e,{type:0,doc:t.doc}):t.type===1&&r.type===0?this.pa=this.pa.remove(e):t.type===1&&r.type===2?this.pa=this.pa.insert(e,{type:1,doc:r.doc}):t.type===0&&r.type===1?this.pa=this.pa.insert(e,{type:2,doc:t.doc}):F(63341,{Vt:t,ya:r}):this.pa=this.pa.insert(e,t)}wa(){let t=[];return this.pa.inorderTraversal((e,r)=>{t.push(r)}),t}},qn=class n{constructor(t,e,r,s,i,a,l,u,h){this.query=t,this.docs=e,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=a,this.syncStateChanged=l,this.excludesMetadataChanges=u,this.hasCachedResults=h}static fromInitialDocuments(t,e,r,s,i){let a=[];return e.forEach(l=>{a.push({type:0,doc:l})}),new n(t,e,$i.emptySet(e),a,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&oo(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;let e=this.docChanges,r=t.docChanges;if(e.length!==r.length)return!1;for(let s=0;s<e.length;s++)if(e[s].type!==r[s].type||!e[s].doc.isEqual(r[s].doc))return!1;return!0}};var Ql=class{constructor(){this.ba=void 0,this.Sa=[]}Da(){return this.Sa.some(t=>t.va())}},Hl=class{constructor(){this.queries=Tf(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(e,r){let s=L(e),i=s.queries;s.queries=Tf(),i.forEach((a,l)=>{for(let u of l.Sa)u.onError(r)})})(this,new O(P.ABORTED,"Firestore shutting down"))}};function Tf(){return new ve(n=>um(n),oo)}async function Bm(n,t){let e=L(n),r=3,s=t.query,i=e.queries.get(s);i?!i.Da()&&t.va()&&(r=2):(i=new Ql,r=t.va()?0:1);try{switch(r){case 0:i.ba=await e.onListen(s,!0);break;case 1:i.ba=await e.onListen(s,!1);break;case 2:await e.onFirstRemoteStoreListen(s)}}catch(a){let l=Pc(a,`Initialization of query '${Tn(t.query)}' failed`);return void t.onError(l)}e.queries.set(s,i),i.Sa.push(t),t.Fa(e.onlineState),i.ba&&t.Ma(i.ba)&&xc(e)}async function Um(n,t){let e=L(n),r=t.query,s=3,i=e.queries.get(r);if(i){let a=i.Sa.indexOf(t);a>=0&&(i.Sa.splice(a,1),i.Sa.length===0?s=t.va()?0:1:!i.Da()&&t.va()&&(s=2))}switch(s){case 0:return e.queries.delete(r),e.onUnlisten(r,!0);case 1:return e.queries.delete(r),e.onUnlisten(r,!1);case 2:return e.onLastRemoteStoreUnlisten(r);default:return}}function Rv(n,t){let e=L(n),r=!1;for(let s of t){let i=s.query,a=e.queries.get(i);if(a){for(let l of a.Sa)l.Ma(s)&&(r=!0);a.ba=s}}r&&xc(e)}function Pv(n,t,e){let r=L(n),s=r.queries.get(t);if(s)for(let i of s.Sa)i.onError(e);r.queries.delete(t)}function xc(n){n.Ca.forEach(t=>{t.next()})}var Yl,Af;(Af=Yl||(Yl={})).xa="default",Af.Cache="cache";var zi=class{constructor(t,e,r){this.query=t,this.Oa=e,this.Na=!1,this.Ba=null,this.onlineState="Unknown",this.options=r||{}}Ma(t){if(!this.options.includeMetadataChanges){let r=[];for(let s of t.docChanges)s.type!==3&&r.push(s);t=new qn(t.query,t.docs,t.oldDocs,r,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.Na?this.La(t)&&(this.Oa.next(t),e=!0):this.ka(t,this.onlineState)&&(this.qa(t),e=!0),this.Ba=t,e}onError(t){this.Oa.error(t)}Fa(t){this.onlineState=t;let e=!1;return this.Ba&&!this.Na&&this.ka(this.Ba,t)&&(this.qa(this.Ba),e=!0),e}ka(t,e){if(!t.fromCache||!this.va())return!0;let r=e!=="Offline";return(!this.options.Qa||!r)&&(!t.docs.isEmpty()||t.hasCachedResults||e==="Offline")}La(t){if(t.docChanges.length>0)return!0;let e=this.Ba&&this.Ba.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&this.options.includeMetadataChanges===!0}qa(t){t=qn.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.Na=!0,this.Oa.next(t)}va(){return this.options.source!==Yl.Cache}};var ji=class{constructor(t){this.key=t}},Ki=class{constructor(t){this.key=t}},Xl=class{constructor(t,e){this.query=t,this.Ha=e,this.Ja=null,this.hasCachedResults=!1,this.current=!1,this.Ya=Q(),this.mutatedKeys=Q(),this.Za=hm(t),this.Xa=new $i(this.Za)}get eu(){return this.Ha}tu(t,e){let r=e?e.nu:new Gi,s=e?e.Xa:this.Xa,i=e?e.mutatedKeys:this.mutatedKeys,a=s,l=!1,u=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,h=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(t.inorderTraversal((f,p)=>{let g=s.get(f),A=ao(this.query,p)?p:null,b=!!g&&this.mutatedKeys.has(g.key),N=!!A&&(A.hasLocalMutations||this.mutatedKeys.has(A.key)&&A.hasCommittedMutations),x=!1;g&&A?g.data.isEqual(A.data)?b!==N&&(r.track({type:3,doc:A}),x=!0):this.ru(g,A)||(r.track({type:2,doc:A}),x=!0,(u&&this.Za(A,u)>0||h&&this.Za(A,h)<0)&&(l=!0)):!g&&A?(r.track({type:0,doc:A}),x=!0):g&&!A&&(r.track({type:1,doc:g}),x=!0,(u||h)&&(l=!0)),x&&(A?(a=a.add(A),i=N?i.add(f):i.delete(f)):(a=a.delete(f),i=i.delete(f)))}),this.query.limit!==null)for(;a.size>this.query.limit;){let f=this.query.limitType==="F"?a.last():a.first();a=a.delete(f.key),i=i.delete(f.key),r.track({type:1,doc:f})}return{Xa:a,nu:r,Cs:l,mutatedKeys:i}}ru(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,r,s){let i=this.Xa;this.Xa=t.Xa,this.mutatedKeys=t.mutatedKeys;let a=t.nu.wa();a.sort((f,p)=>function(A,b){let N=x=>{switch(x){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return F(20277,{Vt:x})}};return N(A)-N(b)}(f.type,p.type)||this.Za(f.doc,p.doc)),this.iu(r),s=s!=null&&s;let l=e&&!s?this.su():[],u=this.Ya.size===0&&this.current&&!s?1:0,h=u!==this.Ja;return this.Ja=u,a.length!==0||h?{snapshot:new qn(this.query,t.Xa,i,a,t.mutatedKeys,u===0,h,!1,!!r&&r.resumeToken.approximateByteSize()>0),ou:l}:{ou:l}}Fa(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({Xa:this.Xa,nu:new Gi,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{ou:[]}}_u(t){return!this.Ha.has(t)&&!!this.Xa.has(t)&&!this.Xa.get(t).hasLocalMutations}iu(t){t&&(t.addedDocuments.forEach(e=>this.Ha=this.Ha.add(e)),t.modifiedDocuments.forEach(e=>{}),t.removedDocuments.forEach(e=>this.Ha=this.Ha.delete(e)),this.current=t.current)}su(){if(!this.current)return[];let t=this.Ya;this.Ya=Q(),this.Xa.forEach(r=>{this._u(r.key)&&(this.Ya=this.Ya.add(r.key))});let e=[];return t.forEach(r=>{this.Ya.has(r)||e.push(new Ki(r))}),this.Ya.forEach(r=>{t.has(r)||e.push(new ji(r))}),e}au(t){this.Ha=t.$s,this.Ya=Q();let e=this.tu(t.documents);return this.applyChanges(e,!0)}uu(){return qn.fromInitialDocuments(this.query,this.Xa,this.mutatedKeys,this.Ja===0,this.hasCachedResults)}},Nc="SyncEngine",Jl=class{constructor(t,e,r){this.query=t,this.targetId=e,this.view=r}},Zl=class{constructor(t){this.key=t,this.cu=!1}},tc=class{constructor(t,e,r,s,i,a){this.localStore=t,this.remoteStore=e,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=a,this.lu={},this.hu=new ve(l=>um(l),oo),this.Pu=new Map,this.Tu=new Set,this.Iu=new lt(M.comparator),this.Eu=new Map,this.du=new jr,this.Au={},this.Ru=new Map,this.Vu=zr.lr(),this.onlineState="Unknown",this.mu=void 0}get isPrimaryClient(){return this.mu===!0}};async function xv(n,t,e=!0){let r=Km(n),s,i=r.hu.get(t);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.uu()):s=await qm(r,t,e,!0),s}async function Nv(n,t){let e=Km(n);await qm(e,t,!0,!1)}async function qm(n,t,e,r){let s=await mv(n.localStore,ne(t)),i=s.targetId,a=n.sharedClientState.addLocalQueryTarget(i,e),l;return r&&(l=await Dv(n,t,i,a==="current",s.resumeToken)),n.isPrimaryClient&&e&&km(n.remoteStore,s),l}async function Dv(n,t,e,r,s){n.fu=(p,g,A)=>async function(N,x,U,q){let W=x.view.tu(U);W.Cs&&(W=await vf(N.localStore,x.query,!1).then(({documents:I})=>x.view.tu(I,W)));let st=q&&q.targetChanges.get(x.targetId),Bt=q&&q.targetMismatches.get(x.targetId)!=null,nt=x.view.applyChanges(W,N.isPrimaryClient,st,Bt);return Sf(N,x.targetId,nt.ou),nt.snapshot}(n,p,g,A);let i=await vf(n.localStore,t,!0),a=new Xl(t,i.$s),l=a.tu(i.documents),u=$r.createSynthesizedTargetChangeForCurrentChange(e,r&&n.onlineState!=="Offline",s),h=a.applyChanges(l,n.isPrimaryClient,u);Sf(n,e,h.ou);let f=new Jl(t,e,a);return n.hu.set(t,f),n.Pu.has(e)?n.Pu.get(e).push(t):n.Pu.set(e,[t]),h.snapshot}async function kv(n,t,e){let r=L(n),s=r.hu.get(t),i=r.Pu.get(s.targetId);if(i.length>1)return r.Pu.set(s.targetId,i.filter(a=>!oo(a,t))),void r.hu.delete(t);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await Vl(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),e&&Cc(r.remoteStore,s.targetId),ec(r,s.targetId)}).catch(zn)):(ec(r,s.targetId),await Vl(r.localStore,s.targetId,!0))}async function Vv(n,t){let e=L(n),r=e.hu.get(t),s=e.Pu.get(r.targetId);e.isPrimaryClient&&s.length===1&&(e.sharedClientState.removeLocalQueryTarget(r.targetId),Cc(e.remoteStore,r.targetId))}async function Ov(n,t,e){let r=$v(n);try{let s=await function(a,l){let u=L(a),h=vt.now(),f=l.reduce((A,b)=>A.add(b.key),Q()),p,g;return u.persistence.runTransaction("Locally write mutations","readwrite",A=>{let b=we(),N=Q();return u.Bs.getEntries(A,f).next(x=>{b=x,b.forEach((U,q)=>{q.isValidDocument()||(N=N.add(U))})}).next(()=>u.localDocuments.getOverlayedDocuments(A,b)).next(x=>{p=x;let U=[];for(let q of l){let W=Uy(q,p.get(q.key).overlayedDocument);W!=null&&U.push(new ae(q.key,W,sm(W.value.mapValue),Pe.exists(!0)))}return u.mutationQueue.addMutationBatch(A,h,U,l)}).next(x=>{g=x;let U=x.applyToLocalDocumentSet(p,N);return u.documentOverlayCache.saveOverlays(A,x.batchId,U)})}).then(()=>({batchId:g.batchId,changes:fm(p)}))}(r.localStore,t);r.sharedClientState.addPendingMutation(s.batchId),function(a,l,u){let h=a.Au[a.currentUser.toKey()];h||(h=new lt(G)),h=h.insert(l,u),a.Au[a.currentUser.toKey()]=h}(r,s.batchId,e),await Zr(r,s.changes),await uo(r.remoteStore)}catch(s){let i=Pc(s,"Failed to persist write");e.reject(i)}}async function $m(n,t){let e=L(n);try{let r=await hv(e.localStore,t);t.targetChanges.forEach((s,i)=>{let a=e.Eu.get(i);a&&(Z(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?a.cu=!0:s.modifiedDocuments.size>0?Z(a.cu,14607):s.removedDocuments.size>0&&(Z(a.cu,42227),a.cu=!1))}),await Zr(e,r,t)}catch(r){await zn(r)}}function Cf(n,t,e){let r=L(n);if(r.isPrimaryClient&&e===0||!r.isPrimaryClient&&e===1){let s=[];r.hu.forEach((i,a)=>{let l=a.view.Fa(t);l.snapshot&&s.push(l.snapshot)}),function(a,l){let u=L(a);u.onlineState=l;let h=!1;u.queries.forEach((f,p)=>{for(let g of p.Sa)g.Fa(l)&&(h=!0)}),h&&xc(u)}(r.eventManager,t),s.length&&r.lu.Y_(s),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function Fv(n,t,e){let r=L(n);r.sharedClientState.updateQueryState(t,"rejected",e);let s=r.Eu.get(t),i=s&&s.key;if(i){let a=new lt(M.comparator);a=a.insert(i,Wt.newNoDocument(i,B.min()));let l=Q().add(i),u=new Pi(B.min(),new Map,new lt(G),a,l);await $m(r,u),r.Iu=r.Iu.remove(i),r.Eu.delete(t),Dc(r)}else await Vl(r.localStore,t,!1).then(()=>ec(r,t,e)).catch(zn)}async function Mv(n,t){let e=L(n),r=t.batch.batchId;try{let s=await uv(e.localStore,t);zm(e,r,null),Gm(e,r),e.sharedClientState.updateMutationState(r,"acknowledged"),await Zr(e,s)}catch(s){await zn(s)}}async function Lv(n,t,e){let r=L(n);try{let s=await function(a,l){let u=L(a);return u.persistence.runTransaction("Reject batch","readwrite-primary",h=>{let f;return u.mutationQueue.lookupMutationBatch(h,l).next(p=>(Z(p!==null,37113),f=p.keys(),u.mutationQueue.removeMutationBatch(h,p))).next(()=>u.mutationQueue.performConsistencyCheck(h)).next(()=>u.documentOverlayCache.removeOverlaysForBatchId(h,f,l)).next(()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(h,f)).next(()=>u.localDocuments.getDocuments(h,f))})}(r.localStore,t);zm(r,t,e),Gm(r,t),r.sharedClientState.updateMutationState(t,"rejected",e),await Zr(r,s)}catch(s){await zn(s)}}function Gm(n,t){(n.Ru.get(t)||[]).forEach(e=>{e.resolve()}),n.Ru.delete(t)}function zm(n,t,e){let r=L(n),s=r.Au[r.currentUser.toKey()];if(s){let i=s.get(t);i&&(e?i.reject(e):i.resolve(),s=s.remove(t)),r.Au[r.currentUser.toKey()]=s}}function ec(n,t,e=null){n.sharedClientState.removeLocalQueryTarget(t);for(let r of n.Pu.get(t))n.hu.delete(r),e&&n.lu.gu(r,e);n.Pu.delete(t),n.isPrimaryClient&&n.du.Hr(t).forEach(r=>{n.du.containsKey(r)||jm(n,r)})}function jm(n,t){n.Tu.delete(t.path.canonicalString());let e=n.Iu.get(t);e!==null&&(Cc(n.remoteStore,e),n.Iu=n.Iu.remove(t),n.Eu.delete(e),Dc(n))}function Sf(n,t,e){for(let r of e)r instanceof ji?(n.du.addReference(r.key,t),Bv(n,r)):r instanceof Ki?(V(Nc,"Document no longer in limbo: "+r.key),n.du.removeReference(r.key,t),n.du.containsKey(r.key)||jm(n,r.key)):F(19791,{pu:r})}function Bv(n,t){let e=t.key,r=e.path.canonicalString();n.Iu.get(e)||n.Tu.has(r)||(V(Nc,"New document in limbo: "+e),n.Tu.add(r),Dc(n))}function Dc(n){for(;n.Tu.size>0&&n.Iu.size<n.maxConcurrentLimboResolutions;){let t=n.Tu.values().next().value;n.Tu.delete(t);let e=new M(dt.fromString(t)),r=n.Vu.next();n.Eu.set(r,new Zl(e)),n.Iu=n.Iu.insert(e,r),km(n.remoteStore,new Gr(ne(io(e.path)),r,"TargetPurposeLimboResolution",mc.le))}}async function Zr(n,t,e){let r=L(n),s=[],i=[],a=[];r.hu.isEmpty()||(r.hu.forEach((l,u)=>{a.push(r.fu(u,t,e).then(h=>{var f;if((h||e)&&r.isPrimaryClient){let p=h?!h.fromCache:(f=e?.targetChanges.get(u.targetId))===null||f===void 0?void 0:f.current;r.sharedClientState.updateQueryState(u.targetId,p?"current":"not-current")}if(h){s.push(h);let p=xl.Rs(u.targetId,h);i.push(p)}}))}),await Promise.all(a),r.lu.Y_(s),await async function(u,h){let f=L(u);try{await f.persistence.runTransaction("notifyLocalViewChanges","readwrite",p=>R.forEach(h,g=>R.forEach(g.ds,A=>f.persistence.referenceDelegate.addReference(p,g.targetId,A)).next(()=>R.forEach(g.As,A=>f.persistence.referenceDelegate.removeReference(p,g.targetId,A)))))}catch(p){if(!jn(p))throw p;V(Ac,"Failed to update sequence numbers: "+p)}for(let p of h){let g=p.targetId;if(!p.fromCache){let A=f.xs.get(g),b=A.snapshotVersion,N=A.withLastLimboFreeSnapshotVersion(b);f.xs=f.xs.insert(g,N)}}}(r.localStore,i))}async function Uv(n,t){let e=L(n);if(!e.currentUser.isEqual(t)){V(Nc,"User change. New user:",t.toKey());let r=await Nm(e.localStore,t);e.currentUser=t,function(i,a){i.Ru.forEach(l=>{l.forEach(u=>{u.reject(new O(P.CANCELLED,a))})}),i.Ru.clear()}(e,"'waitForPendingWrites' promise is rejected due to a user change."),e.sharedClientState.handleUserChange(t,r.removedBatchIds,r.addedBatchIds),await Zr(e,r.ks)}}function qv(n,t){let e=L(n),r=e.Eu.get(t);if(r&&r.cu)return Q().add(r.key);{let s=Q(),i=e.Pu.get(t);if(!i)return s;for(let a of i){let l=e.hu.get(a);s=s.unionWith(l.view.eu)}return s}}function Km(n){let t=L(n);return t.remoteStore.remoteSyncer.applyRemoteEvent=$m.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=qv.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Fv.bind(null,t),t.lu.Y_=Rv.bind(null,t.eventManager),t.lu.gu=Pv.bind(null,t.eventManager),t}function $v(n){let t=L(n);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Mv.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Lv.bind(null,t),t}var Wm=(()=>{class n{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=lo(e.databaseInfo.databaseId),this.sharedClientState=this.bu(e),this.persistence=this.Su(e),await this.persistence.start(),this.localStore=this.Du(e),this.gcScheduler=this.vu(e,this.localStore),this.indexBackfillerScheduler=this.Cu(e,this.localStore)}vu(e,r){return null}Cu(e,r){return null}Du(e){return cv(this.persistence,new Dl,e.initialUser,this.serializer)}Su(e){return new Oi(Pl.fi,this.serializer)}bu(e){return new Ol}async terminate(){var e,r;(e=this.gcScheduler)===null||e===void 0||e.stop(),(r=this.indexBackfillerScheduler)===null||r===void 0||r.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}return n.provider={build:()=>new n},n})(),nc=class extends Wm{constructor(t){super(),this.cacheSizeBytes=t}vu(t,e){Z(this.persistence.referenceDelegate instanceof Fi,46915);let r=this.persistence.referenceDelegate.garbageCollector;return new gl(r,t.asyncQueue,e)}Su(t){let e=this.cacheSizeBytes!==void 0?qt.withCacheSize(this.cacheSizeBytes):qt.DEFAULT;return new Oi(r=>Fi.fi(r,e),this.serializer)}};var Gv=(()=>{class n{async initialize(e,r){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=s=>Cf(this.syncEngine,s,1),this.remoteStore.remoteSyncer.handleCredentialChange=Uv.bind(null,this.syncEngine),await bv(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new Hl}()}createDatastore(e){let r=lo(e.databaseInfo.databaseId),s=function(a){return new Ul(a)}(e.databaseInfo);return function(a,l,u,h){return new zl(a,l,u,h)}(e.authCredentials,e.appCheckCredentials,s,r)}createRemoteStore(e){return function(s,i,a,l,u){return new Kl(s,i,a,l,u)}(this.localStore,this.datastore,e.asyncQueue,r=>Cf(this.syncEngine,r,0),function(){return Li.C()?new Li:new Fl}())}createSyncEngine(e,r){return function(i,a,l,u,h,f,p){let g=new tc(i,a,l,u,h,f);return p&&(g.mu=!0),g}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,r)}async terminate(){var e,r;await async function(i){let a=L(i);V(Ze,"RemoteStore shutting down."),a.da.add(5),await Jr(a),a.Ra.shutdown(),a.Va.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(r=this.eventManager)===null||r===void 0||r.terminate()}}return n.provider={build:()=>new n},n})();var Wi=class{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.Mu(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.Mu(this.observer.error,t):ge("Uncaught Error in snapshot listener:",t.toString()))}xu(){this.muted=!0}Mu(t,e){setTimeout(()=>{this.muted||t(e)},0)}};var Ve="FirestoreClient",rc=class{constructor(t,e,r,s,i){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=r,this.databaseInfo=s,this.user=gt.UNAUTHENTICATED,this.clientId=wi.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async a=>{V(Ve,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a}),this.appCheckCredentials.start(r,a=>(V(Ve,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();let t=new te;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){let r=Pc(e,"Failed to shutdown persistence");t.reject(r)}}),t.promise}};async function Pa(n,t){n.asyncQueue.verifyOperationInProgress(),V(Ve,"Initializing OfflineComponentProvider");let e=n.configuration;await t.initialize(e);let r=e.initialUser;n.setCredentialChangeListener(async s=>{r.isEqual(s)||(await Nm(t.localStore,s),r=s)}),t.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=t}async function bf(n,t){n.asyncQueue.verifyOperationInProgress();let e=await zv(n);V(Ve,"Initializing OnlineComponentProvider"),await t.initialize(e,n.configuration),n.setCredentialChangeListener(r=>If(t.remoteStore,r)),n.setAppCheckTokenChangeListener((r,s)=>If(t.remoteStore,s)),n._onlineComponents=t}async function zv(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){V(Ve,"Using user provided OfflineComponentProvider");try{await Pa(n,n._uninitializedComponentsProvider._offline)}catch(t){let e=t;if(!function(s){return s.name==="FirebaseError"?s.code===P.FAILED_PRECONDITION||s.code===P.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(e))throw e;Pn("Error using user provided cache. Falling back to memory cache: "+e),await Pa(n,new Wm)}}else V(Ve,"Using default OfflineComponentProvider"),await Pa(n,new nc(void 0));return n._offlineComponents}async function Qm(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(V(Ve,"Using user provided OnlineComponentProvider"),await bf(n,n._uninitializedComponentsProvider._online)):(V(Ve,"Using default OnlineComponentProvider"),await bf(n,new Gv))),n._onlineComponents}function jv(n){return Qm(n).then(t=>t.syncEngine)}async function sc(n){let t=await Qm(n),e=t.eventManager;return e.onListen=xv.bind(null,t.syncEngine),e.onUnlisten=kv.bind(null,t.syncEngine),e.onFirstRemoteStoreListen=Nv.bind(null,t.syncEngine),e.onLastRemoteStoreUnlisten=Vv.bind(null,t.syncEngine),e}function Kv(n,t,e={}){let r=new te;return n.asyncQueue.enqueueAndForget(async()=>function(i,a,l,u,h){let f=new Wi({next:g=>{f.xu(),a.enqueueAndForget(()=>Um(i,p));let A=g.docs.has(l);!A&&g.fromCache?h.reject(new O(P.UNAVAILABLE,"Failed to get document because the client is offline.")):A&&g.fromCache&&u&&u.source==="server"?h.reject(new O(P.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):h.resolve(g)},error:g=>h.reject(g)}),p=new zi(io(l.path),f,{includeMetadataChanges:!0,Qa:!0});return Bm(i,p)}(await sc(n),n.asyncQueue,t,e,r)),r.promise}function Hm(n){let t={};return n.timeoutSeconds!==void 0&&(t.timeoutSeconds=n.timeoutSeconds),t}var Rf=new Map;function Wv(n,t,e){if(!e)throw new O(P.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${t}.`)}function Qv(n,t,e,r){if(t===!0&&r===!0)throw new O(P.INVALID_ARGUMENT,`${n} and ${e} cannot be used together.`)}function Pf(n){if(!M.isDocumentKey(n))throw new O(P.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function kc(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let t=function(r){return r.constructor?r.constructor.name:null}(n);return t?`a custom ${t} object`:"an object"}}return typeof n=="function"?"a function":F(12329,{type:typeof n})}function se(n,t){if("_delegate"in n&&(n=n._delegate),!(n instanceof t)){if(t.name===n.constructor.name)throw new O(P.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let e=kc(n);throw new O(P.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${e}`)}}return n}var Ym="firestore.googleapis.com",xf=!0,Qi=class{constructor(t){var e,r;if(t.host===void 0){if(t.ssl!==void 0)throw new O(P.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Ym,this.ssl=xf}else this.host=t.host,this.ssl=(e=t.ssl)!==null&&e!==void 0?e:xf;if(this.isUsingEmulator=t.emulatorOptions!==void 0,this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=xm;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<ov)throw new O(P.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}Qv("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Hm((r=t.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new O(P.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new O(P.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new O(P.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}},Kr=class{constructor(t,e,r,s){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Qi({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new O(P.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(t){if(this._settingsFrozen)throw new O(P.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Qi(t),this._emulatorOptions=t.emulatorOptions||{},t.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new xa;switch(r.type){case"firstParty":return new Va(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new O(P.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){let r=Rf.get(e);r&&(V("ComponentProvider","Removing Datastore"),Rf.delete(e),r.terminate())}(this),Promise.resolve()}};function Xm(n,t,e,r={}){var s;n=se(n,Kr);let i=vn(t),a=n._getSettings(),l=Object.assign(Object.assign({},a),{emulatorOptions:n._getEmulatorOptions()}),u=`${t}:${e}`;i&&(zs(`https://${u}`),Ks("Firestore",!0)),a.host!==Ym&&a.host!==u&&Pn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let h=Object.assign(Object.assign({},a),{host:u,ssl:i,emulatorOptions:r});if(!wn(h,l)&&(n._setSettings(h),r.mockUserToken)){let f,p;if(typeof r.mockUserToken=="string")f=r.mockUserToken,p=gt.MOCK_USER;else{f=js(r.mockUserToken,(s=n._app)===null||s===void 0?void 0:s.options.projectId);let g=r.mockUserToken.sub||r.mockUserToken.user_id;if(!g)throw new O(P.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");p=new gt(g)}n._authCredentials=new Na(new yi(f,p))}}var Hi=class n{constructor(t,e,r){this.converter=e,this._query=r,this.type="query",this.firestore=t}withConverter(t){return new n(this.firestore,t,this._query)}},Dt=class n{constructor(t,e,r){this.converter=e,this._key=r,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Wr(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new n(this.firestore,t,this._key)}},Wr=class n extends Hi{constructor(t,e,r){super(t,e,io(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let t=this._path.popLast();return t.isEmpty()?null:new Dt(this.firestore,null,new M(t))}withConverter(t){return new n(this.firestore,t,this._path)}};function Jm(n,t,...e){if(n=Ct(n),arguments.length===1&&(t=wi.newId()),Wv("doc","path",t),n instanceof Kr){let r=dt.fromString(t,...e);return Pf(r),new Dt(n,null,new M(r))}{if(!(n instanceof Dt||n instanceof Wr))throw new O(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(dt.fromString(t,...e));return Pf(r),new Dt(n.firestore,n instanceof Wr?n.converter:null,new M(r))}}var Nf="AsyncQueue",Yi=class{constructor(t=Promise.resolve()){this.Ju=[],this.Yu=!1,this.Zu=[],this.Xu=null,this.ec=!1,this.tc=!1,this.nc=[],this.x_=new Bi(this,"async_queue_retry"),this.rc=()=>{let r=Ra();r&&V(Nf,"Visibility state changed to "+r.visibilityState),this.x_.b_()},this.sc=t;let e=Ra();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.rc)}get isShuttingDown(){return this.Yu}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.oc(),this._c(t)}enterRestrictedMode(t){if(!this.Yu){this.Yu=!0,this.tc=t||!1;let e=Ra();e&&typeof e.removeEventListener=="function"&&e.removeEventListener("visibilitychange",this.rc)}}enqueue(t){if(this.oc(),this.Yu)return new Promise(()=>{});let e=new te;return this._c(()=>this.Yu&&this.tc?Promise.resolve():(t().then(e.resolve,e.reject),e.promise)).then(()=>e.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.Ju.push(t),this.ac()))}async ac(){if(this.Ju.length!==0){try{await this.Ju[0](),this.Ju.shift(),this.x_.reset()}catch(t){if(!jn(t))throw t;V(Nf,"Operation failed with retryable error: "+t)}this.Ju.length>0&&this.x_.y_(()=>this.ac())}}_c(t){let e=this.sc.then(()=>(this.ec=!0,t().catch(r=>{throw this.Xu=r,this.ec=!1,ge("INTERNAL UNHANDLED ERROR: ",Df(r)),r}).then(r=>(this.ec=!1,r))));return this.sc=e,e}enqueueAfterDelay(t,e,r){this.oc(),this.nc.indexOf(t)>-1&&(e=0);let s=Wl.createAndSchedule(this,t,e,r,i=>this.uc(i));return this.Zu.push(s),s}oc(){this.Xu&&F(47125,{cc:Df(this.Xu)})}verifyOperationInProgress(){}async lc(){let t;do t=this.sc,await t;while(t!==this.sc)}hc(t){for(let e of this.Zu)if(e.timerId===t)return!0;return!1}Pc(t){return this.lc().then(()=>{this.Zu.sort((e,r)=>e.targetTimeMs-r.targetTimeMs);for(let e of this.Zu)if(e.skipDelay(),t!=="all"&&e.timerId===t)break;return this.lc()})}Tc(t){this.nc.push(t)}uc(t){let e=this.Zu.indexOf(t);this.Zu.splice(e,1)}};function Df(n){let t=n.message||"";return n.stack&&(t=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),t}function kf(n){return function(e,r){if(typeof e!="object"||e===null)return!1;let s=e;for(let i of r)if(i in s&&typeof s[i]=="function")return!0;return!1}(n,["next","error","complete"])}var Oe=class extends Kr{constructor(t,e,r,s){super(t,e,r,s),this.type="firestore",this._queue=new Yi,this._persistenceKey=s?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){let t=this._firestoreClient.terminate();this._queue=new Yi(t),this._firestoreClient=void 0,await t}}};function Zm(n,t){let e=typeof n=="object"?n:ei(),r=typeof n=="string"?n:t||Ai,s=Js(e,"firestore").getImmediate({identifier:r});if(!s._initialized){let i=Gs("firestore");i&&Xm(s,...i)}return s}function Vc(n){if(n._terminated)throw new O(P.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||Hv(n),n._firestoreClient}function Hv(n){var t,e,r;let s=n._freezeSettings(),i=function(l,u,h,f){return new Ba(l,u,h,f.host,f.ssl,f.experimentalForceLongPolling,f.experimentalAutoDetectLongPolling,Hm(f.experimentalLongPollingOptions),f.useFetchStreams,f.isUsingEmulator)}(n._databaseId,((t=n._app)===null||t===void 0?void 0:t.options.appId)||"",n._persistenceKey,s);n._componentsProvider||!((e=s.localCache)===null||e===void 0)&&e._offlineComponentProvider&&(!((r=s.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),n._firestoreClient=new rc(n._authCredentials,n._appCheckCredentials,n._queue,i,n._componentsProvider&&function(l){let u=l?._online.build();return{_offline:l?._offline.build(u),_online:u}}(n._componentsProvider))}var Qr=class n{constructor(t){this._byteString=t}static fromBase64String(t){try{return new n(bt.fromBase64String(t))}catch(e){throw new O(P.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(t){return new n(bt.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}};var $n=class{constructor(...t){for(let e=0;e<t.length;++e)if(t[e].length===0)throw new O(P.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Lt(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}};var tn=class{constructor(t){this._methodName=t}};var Hr=class{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new O(P.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new O(P.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return G(this._lat,t._lat)||G(this._long,t._long)}};var Yr=class{constructor(t){this._values=(t||[]).map(e=>e)}toArray(){return this._values.map(t=>t)}isEqual(t){return function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0}(this._values,t._values)}};var Yv=/^__.*__$/,ic=class{constructor(t,e,r){this.data=t,this.fieldMask=e,this.fieldTransforms=r}toMutation(t,e){return this.fieldMask!==null?new ae(t,this.data,this.fieldMask,e,this.fieldTransforms):new Je(t,this.data,e,this.fieldTransforms)}},Xi=class{constructor(t,e,r){this.data=t,this.fieldMask=e,this.fieldTransforms=r}toMutation(t,e){return new ae(t,this.data,this.fieldMask,e,this.fieldTransforms)}};function tp(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw F(40011,{Ic:n})}}var Ji=class n{constructor(t,e,r,s,i,a){this.settings=t,this.databaseId=e,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.Ec(),this.fieldTransforms=i||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Ic(){return this.settings.Ic}dc(t){return new n(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Ac(t){var e;let r=(e=this.path)===null||e===void 0?void 0:e.child(t),s=this.dc({path:r,Rc:!1});return s.Vc(t),s}mc(t){var e;let r=(e=this.path)===null||e===void 0?void 0:e.child(t),s=this.dc({path:r,Rc:!1});return s.Ec(),s}fc(t){return this.dc({path:void 0,Rc:!0})}gc(t){return Zi(t,this.settings.methodName,this.settings.yc||!1,this.path,this.settings.wc)}contains(t){return this.fieldMask.find(e=>t.isPrefixOf(e))!==void 0||this.fieldTransforms.find(e=>t.isPrefixOf(e.field))!==void 0}Ec(){if(this.path)for(let t=0;t<this.path.length;t++)this.Vc(this.path.get(t))}Vc(t){if(t.length===0)throw this.gc("Document fields must not be empty");if(tp(this.Ic)&&Yv.test(t))throw this.gc('Document fields cannot begin and end with "__"')}},oc=class{constructor(t,e,r){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=r||lo(t)}bc(t,e,r,s=!1){return new Ji({Ic:t,methodName:e,wc:r,path:Lt.emptyPath(),Rc:!1,yc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function ep(n){let t=n._freezeSettings(),e=lo(n._databaseId);return new oc(n._databaseId,!!t.ignoreUndefinedProperties,e)}function Xv(n,t,e,r,s,i={}){let a=n.bc(i.merge||i.mergeFields?2:0,t,e,s);Oc("Data must be an object, but it was:",a,r);let l=rp(r,a),u,h;if(i.merge)u=new $t(a.fieldMask),h=a.fieldTransforms;else if(i.mergeFields){let f=[];for(let p of i.mergeFields){let g=cc(t,p,e);if(!a.contains(g))throw new O(P.INVALID_ARGUMENT,`Field '${g}' is specified in your field mask but missing from your input data.`);ip(f,g)||f.push(g)}u=new $t(f),h=a.fieldTransforms.filter(p=>u.covers(p.field))}else u=null,h=a.fieldTransforms;return new ic(new Mt(l),u,h)}var Xr=class n extends tn{_toFieldTransform(t){if(t.Ic!==2)throw t.Ic===1?t.gc(`${this._methodName}() can only appear at the top level of your update data`):t.gc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof n}};function np(n,t,e){return new Ji({Ic:3,wc:t.settings.wc,methodName:n._methodName,Rc:e},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}var ac=class n extends tn{constructor(t,e){super(t),this.Sc=e}_toFieldTransform(t){let e=np(this,t,!0),r=this.Sc.map(i=>Wn(i,e)),s=new Ne(r);return new bi(t.path,s)}isEqual(t){return t instanceof n&&wn(this.Sc,t.Sc)}},lc=class n extends tn{constructor(t,e){super(t),this.Sc=e}_toFieldTransform(t){let e=np(this,t,!0),r=this.Sc.map(i=>Wn(i,e)),s=new De(r);return new bi(t.path,s)}isEqual(t){return t instanceof n&&wn(this.Sc,t.Sc)}};function Jv(n,t,e,r){let s=n.bc(1,t,e);Oc("Data must be an object, but it was:",s,r);let i=[],a=Mt.empty();Fe(r,(u,h)=>{let f=Fc(t,u,e);h=Ct(h);let p=s.mc(f);if(h instanceof Xr)i.push(f);else{let g=Wn(h,p);g!=null&&(i.push(f),a.set(f,g))}});let l=new $t(i);return new Xi(a,l,s.fieldTransforms)}function Zv(n,t,e,r,s,i){let a=n.bc(1,t,e),l=[cc(t,r,e)],u=[s];if(i.length%2!=0)throw new O(P.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let g=0;g<i.length;g+=2)l.push(cc(t,i[g])),u.push(i[g+1]);let h=[],f=Mt.empty();for(let g=l.length-1;g>=0;--g)if(!ip(h,l[g])){let A=l[g],b=u[g];b=Ct(b);let N=a.mc(A);if(b instanceof Xr)h.push(A);else{let x=Wn(b,N);x!=null&&(h.push(A),f.set(A,x))}}let p=new $t(h);return new Xi(f,p,a.fieldTransforms)}function Wn(n,t){if(sp(n=Ct(n)))return Oc("Unsupported field value:",t,n),rp(n,t);if(n instanceof tn)return function(r,s){if(!tp(s.Ic))throw s.gc(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.gc(`${r._methodName}() is not currently supported inside arrays`);let i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(n,t),null;if(n===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),n instanceof Array){if(t.settings.Rc&&t.Ic!==4)throw t.gc("Nested arrays are not supported");return function(r,s){let i=[],a=0;for(let l of r){let u=Wn(l,s.fc(a));u==null&&(u={nullValue:"NULL_VALUE"}),i.push(u),a++}return{arrayValue:{values:i}}}(n,t)}return function(r,s){if((r=Ct(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return Oy(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){let i=vt.fromDate(r);return{timestampValue:ki(s.serializer,i)}}if(r instanceof vt){let i=new vt(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:ki(s.serializer,i)}}if(r instanceof Hr)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Qr)return{bytesValue:Tm(s.serializer,r._byteString)};if(r instanceof Dt){let i=s.databaseId,a=r.firestore._databaseId;if(!a.isEqual(i))throw s.gc(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:Tc(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof Yr)return function(a,l){return{mapValue:{fields:{[_c]:{stringValue:yc},[Nn]:{arrayValue:{values:a.toArray().map(h=>{if(typeof h!="number")throw l.gc("VectorValues must only contain numeric values.");return Ic(l.serializer,h)})}}}}}}(r,s);throw s.gc(`Unsupported field value: ${kc(r)}`)}(n,t)}function rp(n,t){let e={};return Yf(n)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Fe(n,(r,s)=>{let i=Wn(s,t.Ac(r));i!=null&&(e[r]=i)}),{mapValue:{fields:e}}}function sp(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof vt||n instanceof Hr||n instanceof Qr||n instanceof Dt||n instanceof tn||n instanceof Yr)}function Oc(n,t,e){if(!sp(e)||!function(s){return typeof s=="object"&&s!==null&&(Object.getPrototypeOf(s)===Object.prototype||Object.getPrototypeOf(s)===null)}(e)){let r=kc(e);throw r==="an object"?t.gc(n+" a custom object"):t.gc(n+" "+r)}}function cc(n,t,e){if((t=Ct(t))instanceof $n)return t._internalPath;if(typeof t=="string")return Fc(n,t);throw Zi("Field path arguments must be of type string or ",n,!1,void 0,e)}var tw=new RegExp("[~\\*/\\[\\]]");function Fc(n,t,e){if(t.search(tw)>=0)throw Zi(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,e);try{return new $n(...t.split("."))._internalPath}catch{throw Zi(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,e)}}function Zi(n,t,e,r,s){let i=r&&!r.isEmpty(),a=s!==void 0,l=`Function ${t}() called with invalid data`;e&&(l+=" (via `toFirestore()`)"),l+=". ";let u="";return(i||a)&&(u+=" (found",i&&(u+=` in field ${r}`),a&&(u+=` in document ${s}`),u+=")"),new O(P.INVALID_ARGUMENT,l+n+u)}function ip(n,t){return n.some(e=>e.isEqual(t))}var to=class{constructor(t,e,r,s,i){this._firestore=t,this._userDataWriter=e,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Dt(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let t=new uc(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){let e=this._document.data.field(op("DocumentSnapshot.get",t));if(e!==null)return this._userDataWriter.convertValue(e)}}},uc=class extends to{data(){return super.data()}};function op(n,t){return typeof t=="string"?Fc(n,t):t instanceof $n?t._internalPath:t._delegate._internalPath}function ew(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new O(P.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var hc=class{convertValue(t,e="none"){switch(xe(t)){case 0:return null;case 1:return t.booleanValue;case 2:return it(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(ye(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 11:return this.convertObject(t.mapValue,e);case 10:return this.convertVectorValue(t.mapValue);default:throw F(62114,{value:t})}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){let r={};return Fe(t,(s,i)=>{r[s]=this.convertValue(i,e)}),r}convertVectorValue(t){var e,r,s;let i=(s=(r=(e=t.fields)===null||e===void 0?void 0:e[Nn].arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.map(a=>it(a.doubleValue));return new Yr(i)}convertGeoPoint(t){return new Hr(it(t.latitude),it(t.longitude))}convertArray(t,e){return(t.values||[]).map(r=>this.convertValue(r,e))}convertServerTimestamp(t,e){switch(e){case"previous":let r=so(t);return r==null?null:this.convertValue(r,e);case"estimate":return this.convertTimestamp(Ur(t));default:return null}}convertTimestamp(t){let e=_e(t);return new vt(e.seconds,e.nanos)}convertDocumentKey(t,e){let r=dt.fromString(t);Z(Pm(r),9688,{name:t});let s=new Ci(r.get(1),r.get(3)),i=new M(r.popFirst(5));return s.isEqual(e)||ge(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),i}};function nw(n,t,e){let r;return r=n?e&&(e.merge||e.mergeFields)?n.toFirestore(t,e):n.toFirestore(t):t,r}var He=class{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}},eo=class extends to{constructor(t,e,r,s,i,a){super(t,e,r,s,a),this._firestore=t,this._firestoreImpl=t,this.metadata=i}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){let e=new Rn(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){let r=this._document.data.field(op("DocumentSnapshot.get",t));if(r!==null)return this._userDataWriter.convertValue(r,e.serverTimestamps)}}},Rn=class extends eo{data(t={}){return super.data(t)}},dc=class{constructor(t,e,r,s){this._firestore=t,this._userDataWriter=e,this._snapshot=s,this.metadata=new He(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){let t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,e){this._snapshot.docs.forEach(r=>{t.call(e,new Rn(this._firestore,this._userDataWriter,r.key,r,new He(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(t={}){let e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new O(P.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let a=0;return s._snapshot.docChanges.map(l=>{let u=new Rn(s._firestore,s._userDataWriter,l.doc.key,l.doc,new He(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter);return l.doc,{type:"added",doc:u,oldIndex:-1,newIndex:a++}})}{let a=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(l=>i||l.type!==3).map(l=>{let u=new Rn(s._firestore,s._userDataWriter,l.doc.key,l.doc,new He(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter),h=-1,f=-1;return l.type!==0&&(h=a.indexOf(l.doc.key),a=a.delete(l.doc.key)),l.type!==1&&(a=a.add(l.doc),f=a.indexOf(l.doc.key)),{type:rw(l.type),doc:u,oldIndex:h,newIndex:f}})}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}};function rw(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return F(61501,{type:n})}}function ap(n){n=se(n,Dt);let t=se(n.firestore,Oe);return Kv(Vc(t),n._key).then(e=>hp(t,n,e))}var no=class extends hc{constructor(t){super(),this.firestore=t}convertBytes(t){return new Qr(t)}convertReference(t){let e=this.convertDocumentKey(t,this.firestore._databaseId);return new Dt(this.firestore,null,e)}};function lp(n,t,e){n=se(n,Dt);let r=se(n.firestore,Oe),s=nw(n.converter,t,e);return up(r,[Xv(ep(r),"setDoc",n._key,s,n.converter!==null,e).toMutation(n._key,Pe.none())])}function cp(n,t,e,...r){n=se(n,Dt);let s=se(n.firestore,Oe),i=ep(s),a;return a=typeof(t=Ct(t))=="string"||t instanceof $n?Zv(i,"updateDoc",n._key,t,e,r):Jv(i,"updateDoc",n._key,t),up(s,[a.toMutation(n._key,Pe.exists(!0))])}function Mc(n,...t){var e,r,s;n=Ct(n);let i={includeMetadataChanges:!1,source:"default"},a=0;typeof t[a]!="object"||kf(t[a])||(i=t[a],a++);let l={includeMetadataChanges:i.includeMetadataChanges,source:i.source};if(kf(t[a])){let p=t[a];t[a]=(e=p.next)===null||e===void 0?void 0:e.bind(p),t[a+1]=(r=p.error)===null||r===void 0?void 0:r.bind(p),t[a+2]=(s=p.complete)===null||s===void 0?void 0:s.bind(p)}let u,h,f;if(n instanceof Dt)h=se(n.firestore,Oe),f=io(n._key.path),u={next:p=>{t[a]&&t[a](hp(h,n,p))},error:t[a+1],complete:t[a+2]};else{let p=se(n,Hi);h=se(p.firestore,Oe),f=p._query;let g=new no(h);u={next:A=>{t[a]&&t[a](new dc(h,g,p,A))},error:t[a+1],complete:t[a+2]},ew(n._query)}return function(g,A,b,N){let x=new Wi(N),U=new zi(A,x,b);return g.asyncQueue.enqueueAndForget(async()=>Bm(await sc(g),U)),()=>{x.xu(),g.asyncQueue.enqueueAndForget(async()=>Um(await sc(g),U))}}(Vc(h),f,l,u)}function up(n,t){return function(r,s){let i=new te;return r.asyncQueue.enqueueAndForget(async()=>Ov(await jv(r),s,i)),i.promise}(Vc(n),t)}function hp(n,t,e){let r=e.docs.get(t._key),s=new no(n);return new eo(n,s,t._key,r,new He(e.hasPendingWrites,e.fromCache),t.converter)}function dp(){return new Xr("deleteField")}function fp(...n){return new ac("arrayUnion",n)}function mp(...n){return new lc("arrayRemove",n)}(function(t,e=!0){(function(s){Gn=s})(ti),Xs(new Hs("firestore",(r,{instanceIdentifier:s,options:i})=>{let a=r.getProvider("app").getImmediate(),l=new Oe(new Da(r.getProvider("auth-internal")),new Oa(a,r.getProvider("app-check-internal")),function(h,f){if(!Object.prototype.hasOwnProperty.apply(h.options,["projectId"]))throw new O(P.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Ci(h.options.projectId,f)}(a,s),a);return i=Object.assign({useFetchStreams:e},i),l._setSettings(i),l},"PUBLIC").setMultipleInstances(!0)),Zt(zd,jd,t),Zt(zd,jd,"esm2017")})();var ho=function(){return ho=Object.assign||function(t){for(var e,r=1,s=arguments.length;r<s;r++){e=arguments[r];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},ho.apply(this,arguments)};var ow={includeMetadataChanges:!1};function pp(n,t){return t===void 0&&(t=ow),new Td(function(e){var r=Mc(n,t,{next:e.next.bind(e),error:e.error.bind(e),complete:e.complete.bind(e)});return{unsubscribe:r}})}function gp(n){return pp(n,{includeMetadataChanges:!0})}function _p(n,t){return t===void 0&&(t={}),gp(n).pipe(Ad(function(e){return yp(e,t)}))}function yp(n,t){var e;t===void 0&&(t={});var r=n.data(t);return!n.exists()||typeof r!="object"||r===null||!t.idField?r:ho(ho({},r),(e={},e[t.idField]=n.id,e))}var nn=class{constructor(t){return t}},vp="firestore",Lc=class{constructor(){return si(vp)}};var Bc=new Bs("angularfire2.firestore-instances");function aw(n,t){let e=ri(vp,n,t);return e&&new nn(e)}function lw(n){return(t,e)=>{let r=t.runOutsideAngular(()=>n(e));return new nn(r)}}var cw={provide:Lc,deps:[[new Xt,Bc]]},uw={provide:nn,useFactory:aw,deps:[[new Xt,Bc],oi]};function UA(n,...t){return Zt("angularfire",ni.full,"fst"),Us([uw,cw,{provide:Bc,useFactory:lw(n),multi:!0,deps:[$s,qs,ii,ai,[new Xt,ci],[new Xt,li],...t]}])}var wp=Nt(_p,!0);var Ep=Nt(dp,!0,2);var Qt=Nt(Jm,!0,2);var fo=Nt(ap,!0);var qA=Nt(Zm,!0);var Ip=Nt(lp,!0,2);var le=Nt(cp,!0,2);var Tp="@firebase/database",Ap="1.0.19";var Wu="";function hw(n){Wu=n}var Wc=class{constructor(t){this.domStorage_=t,this.prefix_="firebase:"}set(t,e){e==null?this.domStorage_.removeItem(this.prefixedName_(t)):this.domStorage_.setItem(this.prefixedName_(t),mt(e))}get(t){let e=this.domStorage_.getItem(this.prefixedName_(t));return e==null?null:Ws(e)}remove(t){this.domStorage_.removeItem(this.prefixedName_(t))}prefixedName_(t){return this.prefix_+t}toString(){return this.domStorage_.toString()}};var Qc=class{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(t,e){e==null?delete this.cache_[t]:this.cache_[t]=e}get(t){return Kt(this.cache_,t)?this.cache_[t]:null}remove(t){delete this.cache_[t]}};var sg=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){let t=window[n];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new Wc(t)}}catch{}return new Qc},sn=sg("localStorage"),Hc=sg("sessionStorage");var Xn=new Ys("@firebase/database"),dw=function(){let n=1;return function(){return n++}}(),ig=function(n){let t=Bd(n),e=new Ld;e.update(t);let r=e.digest();return Rd.encodeByteArray(r)},_s=function(...n){let t="";for(let e=0;e<n.length;e++){let r=n[e];Array.isArray(r)||r&&typeof r=="object"&&typeof r.length=="number"?t+=_s.apply(null,r):typeof r=="object"?t+=mt(r):t+=r,t+=" "}return t},an=null,Cp=!0,fw=function(n,t){D(!t||n===!0||n===!1,"Can't turn on custom loggers persistently."),n===!0?(Xn.logLevel=Ut.VERBOSE,an=Xn.log.bind(Xn),t&&Hc.set("logging_enabled",!0)):typeof n=="function"?an=n:(an=null,Hc.remove("logging_enabled"))},wt=function(...n){if(Cp===!0&&(Cp=!1,an===null&&Hc.get("logging_enabled")===!0&&fw(!0)),an){let t=_s.apply(null,n);an(t)}},ys=function(n){return function(...t){wt(n,...t)}},Yc=function(...n){let t="FIREBASE INTERNAL ERROR: "+_s(...n);Xn.error(t)},Ee=function(...n){let t=`FIREBASE FATAL ERROR: ${_s(...n)}`;throw Xn.error(t),new Error(t)},Vt=function(...n){let t="FIREBASE WARNING: "+_s(...n);Xn.warn(t)},mw=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&Vt("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},Mo=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},pw=function(n){if(Jt()||document.readyState==="complete")n();else{let t=!1,e=function(){if(!document.body){setTimeout(e,Math.floor(10));return}t||(t=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",e,!1),window.addEventListener("load",e,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&e()}),window.attachEvent("onload",e))}},tr="[MIN_NAME]",ln="[MAX_NAME]",un=function(n,t){if(n===t)return 0;if(n===tr||t===ln)return-1;if(t===tr||n===ln)return 1;{let e=Sp(n),r=Sp(t);return e!==null?r!==null?e-r===0?n.length-t.length:e-r:-1:r!==null?1:n<t?-1:1}},gw=function(n,t){return n===t?0:n<t?-1:1},ts=function(n,t){if(t&&n in t)return t[n];throw new Error("Missing required key ("+n+") in object: "+mt(t))},Qu=function(n){if(typeof n!="object"||n===null)return mt(n);let t=[];for(let r in n)t.push(r);t.sort();let e="{";for(let r=0;r<t.length;r++)r!==0&&(e+=","),e+=mt(t[r]),e+=":",e+=Qu(n[t[r]]);return e+="}",e},og=function(n,t){let e=n.length;if(e<=t)return[n];let r=[];for(let s=0;s<e;s+=t)s+t>e?r.push(n.substring(s,e)):r.push(n.substring(s,s+t));return r};function Rt(n,t){for(let e in n)n.hasOwnProperty(e)&&t(e,n[e])}var ag=function(n){D(!Mo(n),"Invalid JSON number");let t=11,e=52,r=(1<<t-1)-1,s,i,a,l,u;n===0?(i=0,a=0,s=1/n===-1/0?1:0):(s=n<0,n=Math.abs(n),n>=Math.pow(2,1-r)?(l=Math.min(Math.floor(Math.log(n)/Math.LN2),r),i=l+r,a=Math.round(n*Math.pow(2,e-l)-Math.pow(2,e))):(i=0,a=Math.round(n/Math.pow(2,1-r-e))));let h=[];for(u=e;u;u-=1)h.push(a%2?1:0),a=Math.floor(a/2);for(u=t;u;u-=1)h.push(i%2?1:0),i=Math.floor(i/2);h.push(s?1:0),h.reverse();let f=h.join(""),p="";for(u=0;u<64;u+=8){let g=parseInt(f.substr(u,8),2).toString(16);g.length===1&&(g="0"+g),p=p+g}return p.toLowerCase()},_w=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},yw=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function vw(n,t){let e="Unknown Error";n==="too_big"?e="The data requested exceeds the maximum size that can be accessed with a single request.":n==="permission_denied"?e="Client doesn't have permission to access the desired data.":n==="unavailable"&&(e="The service is unavailable");let r=new Error(n+" at "+t._path.toString()+": "+e);return r.code=n.toUpperCase(),r}var ww=new RegExp("^-?(0*)\\d{1,10}$"),Ew=-2147483648,Iw=2147483647,Sp=function(n){if(ww.test(n)){let t=Number(n);if(t>=Ew&&t<=Iw)return t}return null},lr=function(n){try{n()}catch(t){setTimeout(()=>{let e=t.stack||"";throw Vt("Exception was thrown by user callback.",e),t},Math.floor(0))}},Tw=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},is=function(n,t){let e=setTimeout(n,t);return typeof e=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(e):typeof e=="object"&&e.unref&&e.unref(),e};var Xc=class{constructor(t,e){this.appCheckProvider=e,this.appName=t.name,Zs(t)&&t.settings.appCheckToken&&(this.serverAppAppCheckToken=t.settings.appCheckToken),this.appCheck=e?.getImmediate({optional:!0}),this.appCheck||e?.get().then(r=>this.appCheck=r)}getToken(t){if(this.serverAppAppCheckToken){if(t)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(t):new Promise((e,r)=>{setTimeout(()=>{this.appCheck?this.getToken(t).then(e,r):e(null)},0)})}addTokenChangeListener(t){var e;(e=this.appCheckProvider)===null||e===void 0||e.get().then(r=>r.addTokenListener(t))}notifyForInvalidToken(){Vt(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}};var Jc=class{constructor(t,e,r){this.appName_=t,this.firebaseOptions_=e,this.authProvider_=r,this.auth_=null,this.auth_=r.getImmediate({optional:!0}),this.auth_||r.onInit(s=>this.auth_=s)}getToken(t){return this.auth_?this.auth_.getToken(t).catch(e=>e&&e.code==="auth/token-not-initialized"?(wt("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)):new Promise((e,r)=>{setTimeout(()=>{this.auth_?this.getToken(t).then(e,r):e(null)},0)})}addTokenChangeListener(t){this.auth_?this.auth_.addAuthTokenListener(t):this.authProvider_.get().then(e=>e.addAuthTokenListener(t))}removeTokenChangeListener(t){this.authProvider_.get().then(e=>e.removeAuthTokenListener(t))}notifyForInvalidToken(){let t='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?t+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?t+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':t+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Vt(t)}},os=(()=>{class n{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}n.OWNER="owner";return n})(),po="5",lg="v",cg="s",ug="r",hg="f",dg=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,fg="ls",mg="p",Zc="ac",pg="websocket",gg="long_polling";var go=class{constructor(t,e,r,s,i=!1,a="",l=!1,u=!1,h=null){this.secure=e,this.namespace=r,this.webSocketOnly=s,this.nodeAdmin=i,this.persistenceKey=a,this.includeNamespaceInQueryParams=l,this.isUsingEmulator=u,this.emulatorOptions=h,this._host=t.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=sn.get("host:"+t)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(t){t!==this.internalHost&&(this.internalHost=t,this.isCacheableHost()&&sn.set("host:"+this._host,this.internalHost))}toString(){let t=this.toURLString();return this.persistenceKey&&(t+="<"+this.persistenceKey+">"),t}toURLString(){let t=this.secure?"https://":"http://",e=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${t}${this.host}/${e}`}};function Aw(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function _g(n,t,e){D(typeof t=="string","typeof type must == string"),D(typeof e=="object","typeof params must == object");let r;if(t===pg)r=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(t===gg)r=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+t);Aw(n)&&(e.ns=n.namespace);let s=[];return Rt(e,(i,a)=>{s.push(i+"="+a)}),r+s.join("&")}var tu=class{constructor(){this.counters_={}}incrementCounter(t,e=1){Kt(this.counters_,t)||(this.counters_[t]=0),this.counters_[t]+=e}get(){return xd(this.counters_)}};var Uc={},qc={};function Hu(n){let t=n.toString();return Uc[t]||(Uc[t]=new tu),Uc[t]}function Cw(n,t){let e=n.toString();return qc[e]||(qc[e]=t()),qc[e]}var eu=class{constructor(t){this.onMessage_=t,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(t,e){this.closeAfterResponse=t,this.onClose=e,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(t,e){for(this.pendingResponses[t]=e;this.pendingResponses[this.currentResponseNum];){let r=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let s=0;s<r.length;++s)r[s]&&lr(()=>{this.onMessage_(r[s])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}};var bp="start",Sw="close",bw="pLPCommand",Rw="pRTLPCB",yg="id",vg="pw",wg="ser",Pw="cb",xw="seg",Nw="ts",Dw="d",kw="dframe",Eg=1870,Ig=30,Vw=Eg-Ig,Ow=25e3,Fw=3e4,nu=class n{constructor(t,e,r,s,i,a,l){this.connId=t,this.repoInfo=e,this.applicationId=r,this.appCheckToken=s,this.authToken=i,this.transportSessionId=a,this.lastSessionId=l,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=ys(t),this.stats_=Hu(e),this.urlFn=u=>(this.appCheckToken&&(u[Zc]=this.appCheckToken),_g(e,gg,u))}open(t,e){this.curSegmentNum=0,this.onDisconnect_=e,this.myPacketOrderer=new eu(t),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(Fw)),pw(()=>{if(this.isClosed_)return;this.scriptTagHolder=new ru((...i)=>{let[a,l,u,h,f]=i;if(this.incrementIncomingBytes_(i),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,a===bp)this.id=l,this.password=u;else if(a===Sw)l?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(l,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+a)},(...i)=>{let[a,l]=i;this.incrementIncomingBytes_(i),this.myPacketOrderer.handleResponse(a,l)},()=>{this.onClosed_()},this.urlFn);let r={};r[bp]="t",r[wg]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(r[Pw]=this.scriptTagHolder.uniqueCallbackIdentifier),r[lg]=po,this.transportSessionId&&(r[cg]=this.transportSessionId),this.lastSessionId&&(r[fg]=this.lastSessionId),this.applicationId&&(r[mg]=this.applicationId),this.appCheckToken&&(r[Zc]=this.appCheckToken),typeof location<"u"&&location.hostname&&dg.test(location.hostname)&&(r[ug]=hg);let s=this.urlFn(r);this.log_("Connecting via long-poll to "+s),this.scriptTagHolder.addTag(s,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){n.forceAllow_=!0}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){return Jt()?!1:n.forceAllow_?!0:!n.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!_w()&&!yw()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(t){let e=mt(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);let r=Pd(e),s=og(r,Vw);for(let i=0;i<s.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,s.length,s[i]),this.curSegmentNum++}addDisconnectPingFrame(t,e){if(Jt())return;this.myDisconnFrame=document.createElement("iframe");let r={};r[kw]="t",r[yg]=t,r[vg]=e,this.myDisconnFrame.src=this.urlFn(r),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(t){let e=mt(t).length;this.bytesReceived+=e,this.stats_.incrementCounter("bytes_received",e)}},ru=class n{constructor(t,e,r,s){if(this.onDisconnect=r,this.urlFn=s,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0,Jt())this.commandCB=t,this.onMessageCB=e;else{this.uniqueCallbackIdentifier=dw(),window[bw+this.uniqueCallbackIdentifier]=t,window[Rw+this.uniqueCallbackIdentifier]=e,this.myIFrame=n.createIFrame_();let i="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(i='<script>document.domain="'+document.domain+'";<\/script>');let a="<html><body>"+i+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(a),this.myIFrame.doc.close()}catch(l){wt("frame writing exception"),l.stack&&wt(l.stack),wt(l)}}}static createIFrame_(){let t=document.createElement("iframe");if(t.style.display="none",document.body){document.body.appendChild(t);try{t.contentWindow.document||wt("No IE domain setting required")}catch{let r=document.domain;t.src="javascript:void((function(){document.open();document.domain='"+r+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return t.contentDocument?t.doc=t.contentDocument:t.contentWindow?t.doc=t.contentWindow.document:t.document&&(t.doc=t.document),t}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let t=this.onDisconnect;t&&(this.onDisconnect=null,t())}startLongPoll(t,e){for(this.myID=t,this.myPW=e,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;let t={};t[yg]=this.myID,t[vg]=this.myPW,t[wg]=this.currentSerial;let e=this.urlFn(t),r="",s=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+Ig+r.length<=Eg;){let a=this.pendingSegs.shift();r=r+"&"+xw+s+"="+a.seg+"&"+Nw+s+"="+a.ts+"&"+Dw+s+"="+a.d,s++}return e=e+r,this.addLongPollTag_(e,this.currentSerial),!0}else return!1}enqueueSegment(t,e,r){this.pendingSegs.push({seg:t,ts:e,d:r}),this.alive&&this.newRequest_()}addLongPollTag_(t,e){this.outstandingRequests.add(e);let r=()=>{this.outstandingRequests.delete(e),this.newRequest_()},s=setTimeout(r,Math.floor(Ow)),i=()=>{clearTimeout(s),r()};this.addTag(t,i)}addTag(t,e){Jt()?this.doNodeLongPoll(t,e):setTimeout(()=>{try{if(!this.sendNewPolls)return;let r=this.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=t,r.onload=r.onreadystatechange=function(){let s=r.readyState;(!s||s==="loaded"||s==="complete")&&(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),e())},r.onerror=()=>{wt("Long-poll script failed to load: "+t),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(r)}catch{}},Math.floor(1))}};var Mw=16384,Lw=45e3,_o=null;typeof MozWebSocket<"u"?_o=MozWebSocket:typeof WebSocket<"u"&&(_o=WebSocket);var es=(()=>{class n{constructor(e,r,s,i,a,l,u){this.connId=e,this.applicationId=s,this.appCheckToken=i,this.authToken=a,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=ys(this.connId),this.stats_=Hu(r),this.connURL=n.connectionURL_(r,l,u,i,s),this.nodeAdmin=r.nodeAdmin}static connectionURL_(e,r,s,i,a){let l={};return l[lg]=po,!Jt()&&typeof location<"u"&&location.hostname&&dg.test(location.hostname)&&(l[ug]=hg),r&&(l[cg]=r),s&&(l[fg]=s),i&&(l[Zc]=i),a&&(l[mg]=a),_g(e,pg,l)}open(e,r){this.onDisconnect=r,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,sn.set("previous_websocket_failure",!0);try{let s;if(Jt()){let i=this.nodeAdmin?"AdminNode":"Node";s={headers:{"User-Agent":`Firebase/${po}/${Wu}/${process.platform}/${i}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(s.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(s.headers["X-Firebase-AppCheck"]=this.appCheckToken);let a=process.env,l=this.connURL.indexOf("wss://")===0?a.HTTPS_PROXY||a.https_proxy:a.HTTP_PROXY||a.http_proxy;l&&(s.proxy={origin:l})}this.mySock=new _o(this.connURL,[],s)}catch(s){this.log_("Error instantiating WebSocket.");let i=s.message||s.data;i&&this.log_(i),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=s=>{this.handleIncomingFrame(s)},this.mySock.onerror=s=>{this.log_("WebSocket error.  Closing connection.");let i=s.message||s.data;i&&this.log_(i),this.onClosed_()}}start(){}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){let r=/Android ([0-9]{0,}\.[0-9]{0,})/,s=navigator.userAgent.match(r);s&&s.length>1&&parseFloat(s[1])<4.4&&(e=!0)}return!e&&_o!==null&&!n.forceDisallow_}static previouslyFailed(){return sn.isInMemoryStorage||sn.get("previous_websocket_failure")===!0}markConnectionHealthy(){sn.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){let r=this.frames.join("");this.frames=null;let s=Ws(r);this.onMessage(s)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(D(this.frames===null,"We already have a frame buffer"),e.length<=6){let r=Number(e);if(!isNaN(r))return this.handleNewFrameCount_(r),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;let r=e.data;if(this.bytesReceived+=r.length,this.stats_.incrementCounter("bytes_received",r.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(r);else{let s=this.extractFrameCount_(r);s!==null&&this.appendFrame_(s)}}send(e){this.resetKeepAlive();let r=mt(e);this.bytesSent+=r.length,this.stats_.incrementCounter("bytes_sent",r.length);let s=og(r,Mw);s.length>1&&this.sendString_(String(s.length));for(let i=0;i<s.length;i++)this.sendString_(s[i])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(Lw))}sendString_(e){try{this.mySock.send(e)}catch(r){this.log_("Exception thrown from WebSocket.send():",r.message||r.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}n.responsesRequiredToBeHealthy=2,n.healthyTimeout=3e4;return n})(),Bw=(()=>{class n{static get ALL_TRANSPORTS(){return[nu,es]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){let r=es&&es.isAvailable(),s=r&&!es.previouslyFailed();if(e.webSocketOnly&&(r||Vt("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),s=!0),s)this.transports_=[es];else{let i=this.transports_=[];for(let a of n.ALL_TRANSPORTS)a&&a.isAvailable()&&i.push(a);n.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}n.globalTransportInitialized_=!1;return n})(),Uw=6e4,qw=5e3,$w=10*1024,Gw=100*1024,$c="t",Rp="d",zw="s",Pp="r",jw="e",xp="o",Np="a",Dp="n",kp="p",Kw="h",su=class{constructor(t,e,r,s,i,a,l,u,h,f){this.id=t,this.repoInfo_=e,this.applicationId_=r,this.appCheckToken_=s,this.authToken_=i,this.onMessage_=a,this.onReady_=l,this.onDisconnect_=u,this.onKill_=h,this.lastSessionId=f,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=ys("c:"+this.id+":"),this.transportManager_=new Bw(e),this.log_("Connection created"),this.start_()}start_(){let t=this.transportManager_.initialTransport();this.conn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;let e=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(e,r)},Math.floor(0));let s=t.healthyTimeout||0;s>0&&(this.healthyTimeout_=is(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>Gw?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>$w?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(s)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(t){return e=>{t===this.conn_?this.onConnectionLost_(e):t===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(t){return e=>{this.state_!==2&&(t===this.rx_?this.onPrimaryMessageReceived_(e):t===this.secondaryConn_?this.onSecondaryMessageReceived_(e):this.log_("message on old connection"))}}sendRequest(t){let e={t:"d",d:t};this.sendData_(e)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(t){if($c in t){let e=t[$c];e===Np?this.upgradeIfSecondaryHealthy_():e===Pp?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):e===xp&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(t){let e=ts("t",t),r=ts("d",t);if(e==="c")this.onSecondaryControl_(r);else if(e==="d")this.pendingDataMessages.push(r);else throw new Error("Unknown protocol layer: "+e)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:kp,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:Np,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:Dp,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(t){let e=ts("t",t),r=ts("d",t);e==="c"?this.onControl_(r):e==="d"&&this.onDataMessage_(r)}onDataMessage_(t){this.onPrimaryResponse_(),this.onMessage_(t)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(t){let e=ts($c,t);if(Rp in t){let r=t[Rp];if(e===Kw){let s=Object.assign({},r);this.repoInfo_.isUsingEmulator&&(s.h=this.repoInfo_.host),this.onHandshake_(s)}else if(e===Dp){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let s=0;s<this.pendingDataMessages.length;++s)this.onDataMessage_(this.pendingDataMessages[s]);this.pendingDataMessages=[],this.tryCleanupConnection()}else e===zw?this.onConnectionShutdown_(r):e===Pp?this.onReset_(r):e===jw?Yc("Server Error: "+r):e===xp?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Yc("Unknown control packet command: "+e)}}onHandshake_(t){let e=t.ts,r=t.v,s=t.h;this.sessionId=t.s,this.repoInfo_.host=s,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,e),po!==r&&Vt("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let t=this.transportManager_.upgradeTransport();t&&this.startUpgrade_(t)}startUpgrade_(t){this.secondaryConn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;let e=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(e,r),is(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(Uw))}onReset_(t){this.log_("Reset packet received.  New host: "+t),this.repoInfo_.host=t,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(t,e){this.log_("Realtime connection established."),this.conn_=t,this.state_=1,this.onReady_&&(this.onReady_(e,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):is(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(qw))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:kp,d:{}}}))}onSecondaryConnectionLost_(){let t=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===t||this.rx_===t)&&this.close()}onConnectionLost_(t){this.conn_=null,!t&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(sn.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(t){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(t),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(t){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(t)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}};var yo=class{put(t,e,r,s){}merge(t,e,r,s){}refreshAuthToken(t){}refreshAppCheckToken(t){}onDisconnectPut(t,e,r){}onDisconnectMerge(t,e,r){}onDisconnectCancel(t,e){}reportStats(t){}};var vo=class{constructor(t){this.allowedEvents_=t,this.listeners_={},D(Array.isArray(t)&&t.length>0,"Requires a non-empty array")}trigger(t,...e){if(Array.isArray(this.listeners_[t])){let r=[...this.listeners_[t]];for(let s=0;s<r.length;s++)r[s].callback.apply(r[s].context,e)}}on(t,e,r){this.validateEventType_(t),this.listeners_[t]=this.listeners_[t]||[],this.listeners_[t].push({callback:e,context:r});let s=this.getInitialEvent(t);s&&e.apply(r,s)}off(t,e,r){this.validateEventType_(t);let s=this.listeners_[t]||[];for(let i=0;i<s.length;i++)if(s[i].callback===e&&(!r||r===s[i].context)){s.splice(i,1);return}}validateEventType_(t){D(this.allowedEvents_.find(e=>e===t),"Unknown event: "+t)}};var wo=class n extends vo{static getInstance(){return new n}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!va()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(t){return D(t==="online","Unknown event type: "+t),[this.online_]}currentlyOnline(){return this.online_}};var Vp=32,Op=768,J=class{constructor(t,e){if(e===void 0){this.pieces_=t.split("/");let r=0;for(let s=0;s<this.pieces_.length;s++)this.pieces_[s].length>0&&(this.pieces_[r]=this.pieces_[s],r++);this.pieces_.length=r,this.pieceNum_=0}else this.pieces_=t,this.pieceNum_=e}toString(){let t="";for(let e=this.pieceNum_;e<this.pieces_.length;e++)this.pieces_[e]!==""&&(t+="/"+this.pieces_[e]);return t||"/"}};function X(){return new J("")}function z(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function Le(n){return n.pieces_.length-n.pieceNum_}function et(n){let t=n.pieceNum_;return t<n.pieces_.length&&t++,new J(n.pieces_,t)}function Yu(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function Ww(n){let t="";for(let e=n.pieceNum_;e<n.pieces_.length;e++)n.pieces_[e]!==""&&(t+="/"+encodeURIComponent(String(n.pieces_[e])));return t||"/"}function us(n,t=0){return n.pieces_.slice(n.pieceNum_+t)}function Tg(n){if(n.pieceNum_>=n.pieces_.length)return null;let t=[];for(let e=n.pieceNum_;e<n.pieces_.length-1;e++)t.push(n.pieces_[e]);return new J(t,0)}function ct(n,t){let e=[];for(let r=n.pieceNum_;r<n.pieces_.length;r++)e.push(n.pieces_[r]);if(t instanceof J)for(let r=t.pieceNum_;r<t.pieces_.length;r++)e.push(t.pieces_[r]);else{let r=t.split("/");for(let s=0;s<r.length;s++)r[s].length>0&&e.push(r[s])}return new J(e,0)}function j(n){return n.pieceNum_>=n.pieces_.length}function kt(n,t){let e=z(n),r=z(t);if(e===null)return t;if(e===r)return kt(et(n),et(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+n+")")}function Qw(n,t){let e=us(n,0),r=us(t,0);for(let s=0;s<e.length&&s<r.length;s++){let i=un(e[s],r[s]);if(i!==0)return i}return e.length===r.length?0:e.length<r.length?-1:1}function Xu(n,t){if(Le(n)!==Le(t))return!1;for(let e=n.pieceNum_,r=t.pieceNum_;e<=n.pieces_.length;e++,r++)if(n.pieces_[e]!==t.pieces_[r])return!1;return!0}function Gt(n,t){let e=n.pieceNum_,r=t.pieceNum_;if(Le(n)>Le(t))return!1;for(;e<n.pieces_.length;){if(n.pieces_[e]!==t.pieces_[r])return!1;++e,++r}return!0}var iu=class{constructor(t,e){this.errorPrefix_=e,this.parts_=us(t,0),this.byteLength_=Math.max(1,this.parts_.length);for(let r=0;r<this.parts_.length;r++)this.byteLength_+=Nr(this.parts_[r]);Ag(this)}};function Hw(n,t){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(t),n.byteLength_+=Nr(t),Ag(n)}function Yw(n){let t=n.parts_.pop();n.byteLength_-=Nr(t),n.parts_.length>0&&(n.byteLength_-=1)}function Ag(n){if(n.byteLength_>Op)throw new Error(n.errorPrefix_+"has a key path longer than "+Op+" bytes ("+n.byteLength_+").");if(n.parts_.length>Vp)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+Vp+") or object contains a cycle "+rn(n))}function rn(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}var ou=class n extends vo{static getInstance(){return new n}constructor(){super(["visible"]);let t,e;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(e="visibilitychange",t="hidden"):typeof document.mozHidden<"u"?(e="mozvisibilitychange",t="mozHidden"):typeof document.msHidden<"u"?(e="msvisibilitychange",t="msHidden"):typeof document.webkitHidden<"u"&&(e="webkitvisibilitychange",t="webkitHidden")),this.visible_=!0,e&&document.addEventListener(e,()=>{let r=!document[t];r!==this.visible_&&(this.visible_=r,this.trigger("visible",r))},!1)}getInitialEvent(t){return D(t==="visible","Unknown event type: "+t),[this.visible_]}};var ns=1e3,Xw=60*5*1e3,Fp=30*1e3,Jw=1.3,Zw=3e4,tE="server_kill",Mp=3,Ju=(()=>{class n extends yo{constructor(e,r,s,i,a,l,u,h){if(super(),this.repoInfo_=e,this.applicationId_=r,this.onDataUpdate_=s,this.onConnectStatus_=i,this.onServerInfoUpdate_=a,this.authTokenProvider_=l,this.appCheckTokenProvider_=u,this.authOverride_=h,this.id=n.nextPersistentConnectionId_++,this.log_=ys("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=ns,this.maxReconnectDelay_=Xw,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,h&&!Jt())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");ou.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&wo.getInstance().on("online",this.onOnline_,this)}sendRequest(e,r,s){let i=++this.requestNumber_,a={r:i,a:e,b:r};this.log_(mt(a)),D(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(a),s&&(this.requestCBHash_[i]=s)}get(e){this.initConnection_();let r=new fe,i={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:l=>{let u=l.d;l.s==="ok"?r.resolve(u):r.reject(u)}};this.outstandingGets_.push(i),this.outstandingGetCount_++;let a=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(a),r.promise}listen(e,r,s,i){this.initConnection_();let a=e._queryIdentifier,l=e._path.toString();this.log_("Listen called for "+l+" "+a),this.listens.has(l)||this.listens.set(l,new Map),D(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),D(!this.listens.get(l).has(a),"listen() called twice for same path/queryId.");let u={onComplete:i,hashFn:r,query:e,tag:s};this.listens.get(l).set(a,u),this.connected_&&this.sendListen_(u)}sendGet_(e){let r=this.outstandingGets_[e];this.sendRequest("g",r.request,s=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),r.onComplete&&r.onComplete(s)})}sendListen_(e){let r=e.query,s=r._path.toString(),i=r._queryIdentifier;this.log_("Listen on "+s+" for "+i);let a={p:s},l="q";e.tag&&(a.q=r._queryObject,a.t=e.tag),a.h=e.hashFn(),this.sendRequest(l,a,u=>{let h=u.d,f=u.s;n.warnOnListenWarnings_(h,r),(this.listens.get(s)&&this.listens.get(s).get(i))===e&&(this.log_("listen response",u),f!=="ok"&&this.removeListen_(s,i),e.onComplete&&e.onComplete(f,h))})}static warnOnListenWarnings_(e,r){if(e&&typeof e=="object"&&Kt(e,"w")){let s=je(e,"w");if(Array.isArray(s)&&~s.indexOf("no_index")){let i='".indexOn": "'+r._queryParams.getIndex().toString()+'"',a=r._path.toString();Vt(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${i} at ${a} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||Fd(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=Fp)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let e=this.authToken_,r=Od(e)?"auth":"gauth",s={cred:e};this.authOverride_===null?s.noauth=!0:typeof this.authOverride_=="object"&&(s.authvar=this.authOverride_),this.sendRequest(r,s,i=>{let a=i.s,l=i.d||"error";this.authToken_===e&&(a==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(a,l))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{let r=e.s,s=e.d||"error";r==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(r,s)})}unlisten(e,r){let s=e._path.toString(),i=e._queryIdentifier;this.log_("Unlisten called for "+s+" "+i),D(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(s,i)&&this.connected_&&this.sendUnlisten_(s,i,e._queryObject,r)}sendUnlisten_(e,r,s,i){this.log_("Unlisten on "+e+" for "+r);let a={p:e},l="n";i&&(a.q=s,a.t=i),this.sendRequest(l,a)}onDisconnectPut(e,r,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,r,s):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:r,onComplete:s})}onDisconnectMerge(e,r,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,r,s):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:r,onComplete:s})}onDisconnectCancel(e,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:r})}sendOnDisconnect_(e,r,s,i){let a={p:r,d:s};this.log_("onDisconnect "+e,a),this.sendRequest(e,a,l=>{i&&setTimeout(()=>{i(l.s,l.d)},Math.floor(0))})}put(e,r,s,i){this.putInternal("p",e,r,s,i)}merge(e,r,s,i){this.putInternal("m",e,r,s,i)}putInternal(e,r,s,i,a){this.initConnection_();let l={p:r,d:s};a!==void 0&&(l.h=a),this.outstandingPuts_.push({action:e,request:l,onComplete:i}),this.outstandingPutCount_++;let u=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(u):this.log_("Buffering put: "+r)}sendPut_(e){let r=this.outstandingPuts_[e].action,s=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(r,s,a=>{this.log_(r+" response",a),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),i&&i(a.s,a.d)})}reportStats(e){if(this.connected_){let r={c:e};this.log_("reportStats",r),this.sendRequest("s",r,s=>{if(s.s!=="ok"){let a=s.d;this.log_("reportStats","Error sending stats: "+a)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+mt(e));let r=e.r,s=this.requestCBHash_[r];s&&(delete this.requestCBHash_[r],s(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,r){this.log_("handleServerMessage",e,r),e==="d"?this.onDataUpdate_(r.p,r.d,!1,r.t):e==="m"?this.onDataUpdate_(r.p,r.d,!0,r.t):e==="c"?this.onListenRevoked_(r.p,r.q):e==="ac"?this.onAuthRevoked_(r.s,r.d):e==="apc"?this.onAppCheckRevoked_(r.s,r.d):e==="sd"?this.onSecurityDebugPacket_(r):Yc("Unrecognized action received from server: "+mt(e)+`
Are you using the latest client?`)}onReady_(e,r){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=r,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){D(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=ns,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=ns,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>Zw&&(this.reconnectDelay_=ns),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_),r=Math.max(0,this.reconnectDelay_-e);r=Math.random()*r,this.log_("Trying to reconnect in "+r+"ms"),this.scheduleConnect_(r),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*Jw)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let e=this.onDataMessage_.bind(this),r=this.onReady_.bind(this),s=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+n.nextConnectionId_++,a=this.lastSessionId,l=!1,u=null,h=function(){u?u.close():(l=!0,s())},f=function(g){D(u,"sendRequest call when we're not connected not allowed."),u.sendRequest(g)};this.realtime_={close:h,sendRequest:f};let p=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[g,A]=await Promise.all([this.authTokenProvider_.getToken(p),this.appCheckTokenProvider_.getToken(p)]);l?wt("getToken() completed but was canceled"):(wt("getToken() completed. Creating connection."),this.authToken_=g&&g.accessToken,this.appCheckToken_=A&&A.token,u=new su(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,r,s,b=>{Vt(b+" ("+this.repoInfo_.toString()+")"),this.interrupt(tE)},a))}catch(g){this.log_("Failed to get token: "+g),l||(this.repoInfo_.nodeAdmin&&Vt(g),h())}}}interrupt(e){wt("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){wt("Resuming connection for reason: "+e),delete this.interruptReasons_[e],Qs(this.interruptReasons_)&&(this.reconnectDelay_=ns,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){let r=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:r})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){let r=this.outstandingPuts_[e];r&&"h"in r.request&&r.queued&&(r.onComplete&&r.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,r){let s;r?s=r.map(a=>Qu(a)).join("$"):s="default";let i=this.removeListen_(e,s);i&&i.onComplete&&i.onComplete("permission_denied")}removeListen_(e,r){let s=new J(e).toString(),i;if(this.listens.has(s)){let a=this.listens.get(s);i=a.get(r),a.delete(r),a.size===0&&this.listens.delete(s)}else i=void 0;return i}onAuthRevoked_(e,r){wt("Auth token revoked: "+e+"/"+r),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=Mp&&(this.reconnectDelay_=Fp,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,r){wt("App check token revoked: "+e+"/"+r),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=Mp&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(let e of this.listens.values())for(let r of e.values())this.sendListen_(r);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){let e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){let e={},r="js";Jt()&&(this.repoInfo_.nodeAdmin?r="admin_node":r="node"),e["sdk."+r+"."+Wu.replace(/\./g,"-")]=1,va()?e["framework.cordova"]=1:Dd()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){let e=wo.getInstance().currentlyOnline();return Qs(this.interruptReasons_)&&e}}n.nextPersistentConnectionId_=0,n.nextConnectionId_=0;return n})(),K=class n{constructor(t,e){this.name=t,this.node=e}static Wrap(t,e){return new n(t,e)}};var er=class{getCompare(){return this.compare.bind(this)}indexedValueChanged(t,e){let r=new K(tr,t),s=new K(tr,e);return this.compare(r,s)!==0}minPost(){return K.MIN}};var mo,Eo=class extends er{static get __EMPTY_NODE(){return mo}static set __EMPTY_NODE(t){mo=t}compare(t,e){return un(t.name,e.name)}isDefinedOn(t){throw yn("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(t,e){return!1}minPost(){return K.MIN}maxPost(){return new K(ln,mo)}makePost(t,e){return D(typeof t=="string","KeyIndex indexValue must always be a string."),new K(t,mo)}toString(){return".key"}},Jn=new Eo;var Hn=class{constructor(t,e,r,s,i=null){this.isReverse_=s,this.resultGenerator_=i,this.nodeStack_=[];let a=1;for(;!t.isEmpty();)if(t=t,a=e?r(t.key,e):1,s&&(a*=-1),a<0)this.isReverse_?t=t.left:t=t.right;else if(a===0){this.nodeStack_.push(t);break}else this.nodeStack_.push(t),this.isReverse_?t=t.right:t=t.left}getNext(){if(this.nodeStack_.length===0)return null;let t=this.nodeStack_.pop(),e;if(this.resultGenerator_?e=this.resultGenerator_(t.key,t.value):e={key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;let t=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value}}},Ht=(()=>{class n{constructor(e,r,s,i,a){this.key=e,this.value=r,this.color=s??n.RED,this.left=i??zt.EMPTY_NODE,this.right=a??zt.EMPTY_NODE}copy(e,r,s,i,a){return new n(e??this.key,r??this.value,s??this.color,i??this.left,a??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,r,s){let i=this,a=s(e,i.key);return a<0?i=i.copy(null,null,null,i.left.insert(e,r,s),null):a===0?i=i.copy(null,r,null,null,null):i=i.copy(null,null,null,null,i.right.insert(e,r,s)),i.fixUp_()}removeMin_(){if(this.left.isEmpty())return zt.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,r){let s,i;if(s=this,r(e,s.key)<0)!s.left.isEmpty()&&!s.left.isRed_()&&!s.left.left.isRed_()&&(s=s.moveRedLeft_()),s=s.copy(null,null,null,s.left.remove(e,r),null);else{if(s.left.isRed_()&&(s=s.rotateRight_()),!s.right.isEmpty()&&!s.right.isRed_()&&!s.right.left.isRed_()&&(s=s.moveRedRight_()),r(e,s.key)===0){if(s.right.isEmpty())return zt.EMPTY_NODE;i=s.right.min_(),s=s.copy(i.key,i.value,null,null,s.right.removeMin_())}s=s.copy(null,null,null,null,s.right.remove(e,r))}return s.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){let e=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){let e=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){let e=this.left.copy(null,null,!this.left.color,null,null),r=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,r)}checkMaxDepth_(){let e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");let e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}return n.RED=!0,n.BLACK=!1,n})(),au=class{copy(t,e,r,s,i){return this}insert(t,e,r){return new Ht(t,e,null)}remove(t,e){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}},zt=class n{constructor(t,e=n.EMPTY_NODE){this.comparator_=t,this.root_=e}insert(t,e){return new n(this.comparator_,this.root_.insert(t,e,this.comparator_).copy(null,null,Ht.BLACK,null,null))}remove(t){return new n(this.comparator_,this.root_.remove(t,this.comparator_).copy(null,null,Ht.BLACK,null,null))}get(t){let e,r=this.root_;for(;!r.isEmpty();){if(e=this.comparator_(t,r.key),e===0)return r.value;e<0?r=r.left:e>0&&(r=r.right)}return null}getPredecessorKey(t){let e,r=this.root_,s=null;for(;!r.isEmpty();)if(e=this.comparator_(t,r.key),e===0){if(r.left.isEmpty())return s?s.key:null;for(r=r.left;!r.right.isEmpty();)r=r.right;return r.key}else e<0?r=r.left:e>0&&(s=r,r=r.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(t){return this.root_.inorderTraversal(t)}reverseTraversal(t){return this.root_.reverseTraversal(t)}getIterator(t){return new Hn(this.root_,null,this.comparator_,!1,t)}getIteratorFrom(t,e){return new Hn(this.root_,t,this.comparator_,!1,e)}getReverseIteratorFrom(t,e){return new Hn(this.root_,t,this.comparator_,!0,e)}getReverseIterator(t){return new Hn(this.root_,null,this.comparator_,!0,t)}};zt.EMPTY_NODE=new au;function eE(n,t){return un(n.name,t.name)}function Zu(n,t){return un(n,t)}var lu;function nE(n){lu=n}var Cg=function(n){return typeof n=="number"?"number:"+ag(n):"string:"+n},Sg=function(n){if(n.isLeafNode()){let t=n.val();D(typeof t=="string"||typeof t=="number"||typeof t=="object"&&Kt(t,".sv"),"Priority must be a string or number.")}else D(n===lu||n.isEmpty(),"priority of unexpected type.");D(n===lu||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};var Lp,nr=(()=>{class n{static set __childrenNodeConstructor(e){Lp=e}static get __childrenNodeConstructor(){return Lp}constructor(e,r=n.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=r,this.lazyHash_=null,D(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),Sg(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new n(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return j(e)?this:z(e)===".priority"?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,r){return null}updateImmediateChild(e,r){return e===".priority"?this.updatePriority(r):r.isEmpty()&&e!==".priority"?this:n.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,r).updatePriority(this.priorityNode_)}updateChild(e,r){let s=z(e);return s===null?r:r.isEmpty()&&s!==".priority"?this:(D(s!==".priority"||Le(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(s,n.__childrenNodeConstructor.EMPTY_NODE.updateChild(et(e),r)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,r){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+Cg(this.priorityNode_.val())+":");let r=typeof this.value_;e+=r+":",r==="number"?e+=ag(this.value_):e+=this.value_,this.lazyHash_=ig(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===n.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof n.__childrenNodeConstructor?-1:(D(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){let r=typeof e.value_,s=typeof this.value_,i=n.VALUE_TYPE_ORDER.indexOf(r),a=n.VALUE_TYPE_ORDER.indexOf(s);return D(i>=0,"Unknown leaf type: "+r),D(a>=0,"Unknown leaf type: "+s),i===a?s==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:a-i}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){let r=e;return this.value_===r.value_&&this.priorityNode_.equals(r.priorityNode_)}else return!1}}n.VALUE_TYPE_ORDER=["object","boolean","number","string"];return n})(),bg,Rg;function rE(n){bg=n}function sE(n){Rg=n}var cu=class extends er{compare(t,e){let r=t.node.getPriority(),s=e.node.getPriority(),i=r.compareTo(s);return i===0?un(t.name,e.name):i}isDefinedOn(t){return!t.getPriority().isEmpty()}indexedValueChanged(t,e){return!t.getPriority().equals(e.getPriority())}minPost(){return K.MIN}maxPost(){return new K(ln,new nr("[PRIORITY-POST]",Rg))}makePost(t,e){let r=bg(t);return new K(e,new nr("[PRIORITY-POST]",r))}toString(){return".priority"}},ot=new cu;var iE=Math.log(2),uu=class{constructor(t){let e=i=>parseInt(Math.log(i)/iE,10),r=i=>parseInt(Array(i+1).join("1"),2);this.count=e(t+1),this.current_=this.count-1;let s=r(this.count);this.bits_=t+1&s}nextBitIsOne(){let t=!(this.bits_&1<<this.current_);return this.current_--,t}},Io=function(n,t,e,r){n.sort(t);let s=function(u,h){let f=h-u,p,g;if(f===0)return null;if(f===1)return p=n[u],g=e?e(p):p,new Ht(g,p.node,Ht.BLACK,null,null);{let A=parseInt(f/2,10)+u,b=s(u,A),N=s(A+1,h);return p=n[A],g=e?e(p):p,new Ht(g,p.node,Ht.BLACK,b,N)}},i=function(u){let h=null,f=null,p=n.length,g=function(b,N){let x=p-b,U=p;p-=b;let q=s(x+1,U),W=n[x],st=e?e(W):W;A(new Ht(st,W.node,N,null,q))},A=function(b){h?(h.left=b,h=b):(f=b,h=b)};for(let b=0;b<u.count;++b){let N=u.nextBitIsOne(),x=Math.pow(2,u.count-(b+1));N?g(x,Ht.BLACK):(g(x,Ht.BLACK),g(x,Ht.RED))}return f},a=new uu(n.length),l=i(a);return new zt(r||t,l)};var Gc,Qn={},rr=class n{static get Default(){return D(Qn&&ot,"ChildrenNode.ts has not been loaded"),Gc=Gc||new n({".priority":Qn},{".priority":ot}),Gc}constructor(t,e){this.indexes_=t,this.indexSet_=e}get(t){let e=je(this.indexes_,t);if(!e)throw new Error("No index defined for "+t);return e instanceof zt?e:null}hasIndex(t){return Kt(this.indexSet_,t.toString())}addIndex(t,e){D(t!==Jn,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let r=[],s=!1,i=e.getIterator(K.Wrap),a=i.getNext();for(;a;)s=s||t.isDefinedOn(a.node),r.push(a),a=i.getNext();let l;s?l=Io(r,t.getCompare()):l=Qn;let u=t.toString(),h=Object.assign({},this.indexSet_);h[u]=t;let f=Object.assign({},this.indexes_);return f[u]=l,new n(f,h)}addToIndexes(t,e){let r=xr(this.indexes_,(s,i)=>{let a=je(this.indexSet_,i);if(D(a,"Missing index implementation for "+i),s===Qn)if(a.isDefinedOn(t.node)){let l=[],u=e.getIterator(K.Wrap),h=u.getNext();for(;h;)h.name!==t.name&&l.push(h),h=u.getNext();return l.push(t),Io(l,a.getCompare())}else return Qn;else{let l=e.get(t.name),u=s;return l&&(u=u.remove(new K(t.name,l))),u.insert(t,t.node)}});return new n(r,this.indexSet_)}removeFromIndexes(t,e){let r=xr(this.indexes_,s=>{if(s===Qn)return s;{let i=e.get(t.name);return i?s.remove(new K(t.name,i)):s}});return new n(r,this.indexSet_)}};var rs,$=(()=>{class n{static get EMPTY_NODE(){return rs||(rs=new n(new zt(Zu),null,rr.Default))}constructor(e,r,s){this.children_=e,this.priorityNode_=r,this.indexMap_=s,this.lazyHash_=null,this.priorityNode_&&Sg(this.priorityNode_),this.children_.isEmpty()&&D(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||rs}updatePriority(e){return this.children_.isEmpty()?this:new n(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{let r=this.children_.get(e);return r===null?rs:r}}getChild(e){let r=z(e);return r===null?this:this.getImmediateChild(r).getChild(et(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,r){if(D(r,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(r);{let s=new K(e,r),i,a;r.isEmpty()?(i=this.children_.remove(e),a=this.indexMap_.removeFromIndexes(s,this.children_)):(i=this.children_.insert(e,r),a=this.indexMap_.addToIndexes(s,this.children_));let l=i.isEmpty()?rs:this.priorityNode_;return new n(i,l,a)}}updateChild(e,r){let s=z(e);if(s===null)return r;{D(z(e)!==".priority"||Le(e)===1,".priority must be the last token in a path");let i=this.getImmediateChild(s).updateChild(et(e),r);return this.updateImmediateChild(s,i)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;let r={},s=0,i=0,a=!0;if(this.forEachChild(ot,(l,u)=>{r[l]=u.val(e),s++,a&&n.INTEGER_REGEXP_.test(l)?i=Math.max(i,Number(l)):a=!1}),!e&&a&&i<2*s){let l=[];for(let u in r)l[u]=r[u];return l}else return e&&!this.getPriority().isEmpty()&&(r[".priority"]=this.getPriority().val()),r}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+Cg(this.getPriority().val())+":"),this.forEachChild(ot,(r,s)=>{let i=s.hash();i!==""&&(e+=":"+r+":"+i)}),this.lazyHash_=e===""?"":ig(e)}return this.lazyHash_}getPredecessorChildName(e,r,s){let i=this.resolveIndex_(s);if(i){let a=i.getPredecessorKey(new K(e,r));return a?a.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){let r=this.resolveIndex_(e);if(r){let s=r.minKey();return s&&s.name}else return this.children_.minKey()}getFirstChild(e){let r=this.getFirstChildName(e);return r?new K(r,this.children_.get(r)):null}getLastChildName(e){let r=this.resolveIndex_(e);if(r){let s=r.maxKey();return s&&s.name}else return this.children_.maxKey()}getLastChild(e){let r=this.getLastChildName(e);return r?new K(r,this.children_.get(r)):null}forEachChild(e,r){let s=this.resolveIndex_(e);return s?s.inorderTraversal(i=>r(i.name,i.node)):this.children_.inorderTraversal(r)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,r){let s=this.resolveIndex_(r);if(s)return s.getIteratorFrom(e,i=>i);{let i=this.children_.getIteratorFrom(e.name,K.Wrap),a=i.peek();for(;a!=null&&r.compare(a,e)<0;)i.getNext(),a=i.peek();return i}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,r){let s=this.resolveIndex_(r);if(s)return s.getReverseIteratorFrom(e,i=>i);{let i=this.children_.getReverseIteratorFrom(e.name,K.Wrap),a=i.peek();for(;a!=null&&r.compare(a,e)>0;)i.getNext(),a=i.peek();return i}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===vs?-1:0}withIndex(e){if(e===Jn||this.indexMap_.hasIndex(e))return this;{let r=this.indexMap_.addIndex(e,this.children_);return new n(this.children_,this.priorityNode_,r)}}isIndexed(e){return e===Jn||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{let r=e;if(this.getPriority().equals(r.getPriority()))if(this.children_.count()===r.children_.count()){let s=this.getIterator(ot),i=r.getIterator(ot),a=s.getNext(),l=i.getNext();for(;a&&l;){if(a.name!==l.name||!a.node.equals(l.node))return!1;a=s.getNext(),l=i.getNext()}return a===null&&l===null}else return!1;else return!1}}resolveIndex_(e){return e===Jn?null:this.indexMap_.get(e.toString())}}return n.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,n})(),hu=class extends ${constructor(){super(new zt(Zu),$.EMPTY_NODE,rr.Default)}compareTo(t){return t===this?0:1}equals(t){return t===this}getPriority(){return this}getImmediateChild(t){return $.EMPTY_NODE}isEmpty(){return!1}},vs=new hu;Object.defineProperties(K,{MIN:{value:new K(tr,$.EMPTY_NODE)},MAX:{value:new K(ln,vs)}});Eo.__EMPTY_NODE=$.EMPTY_NODE;nr.__childrenNodeConstructor=$;nE(vs);sE(vs);var oE=!0;function ft(n,t=null){if(n===null)return $.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(t=n[".priority"]),D(t===null||typeof t=="string"||typeof t=="number"||typeof t=="object"&&".sv"in t,"Invalid priority type found: "+typeof t),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){let e=n;return new nr(e,ft(t))}if(!(n instanceof Array)&&oE){let e=[],r=!1;if(Rt(n,(a,l)=>{if(a.substring(0,1)!=="."){let u=ft(l);u.isEmpty()||(r=r||!u.getPriority().isEmpty(),e.push(new K(a,u)))}}),e.length===0)return $.EMPTY_NODE;let i=Io(e,eE,a=>a.name,Zu);if(r){let a=Io(e,ot.getCompare());return new $(i,ft(t),new rr({".priority":a},{".priority":ot}))}else return new $(i,ft(t),rr.Default)}else{let e=$.EMPTY_NODE;return Rt(n,(r,s)=>{if(Kt(n,r)&&r.substring(0,1)!=="."){let i=ft(s);(i.isLeafNode()||!i.isEmpty())&&(e=e.updateImmediateChild(r,i))}}),e.updatePriority(ft(t))}}rE(ft);var du=class extends er{constructor(t){super(),this.indexPath_=t,D(!j(t)&&z(t)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(t){return t.getChild(this.indexPath_)}isDefinedOn(t){return!t.getChild(this.indexPath_).isEmpty()}compare(t,e){let r=this.extractChild(t.node),s=this.extractChild(e.node),i=r.compareTo(s);return i===0?un(t.name,e.name):i}makePost(t,e){let r=ft(t),s=$.EMPTY_NODE.updateChild(this.indexPath_,r);return new K(e,s)}maxPost(){let t=$.EMPTY_NODE.updateChild(this.indexPath_,vs);return new K(ln,t)}toString(){return us(this.indexPath_,0).join("/")}};var fu=class extends er{compare(t,e){let r=t.node.compareTo(e.node);return r===0?un(t.name,e.name):r}isDefinedOn(t){return!0}indexedValueChanged(t,e){return!t.equals(e)}minPost(){return K.MIN}maxPost(){return K.MAX}makePost(t,e){let r=ft(t);return new K(e,r)}toString(){return".value"}},aE=new fu;function Pg(n){return{type:"value",snapshotNode:n}}function sr(n,t){return{type:"child_added",snapshotNode:t,childName:n}}function hs(n,t){return{type:"child_removed",snapshotNode:t,childName:n}}function ds(n,t,e){return{type:"child_changed",snapshotNode:t,childName:n,oldSnap:e}}function lE(n,t){return{type:"child_moved",snapshotNode:t,childName:n}}var fs=class{constructor(t){this.index_=t}updateChild(t,e,r,s,i,a){D(t.isIndexed(this.index_),"A node must be indexed if only a child is updated");let l=t.getImmediateChild(e);return l.getChild(s).equals(r.getChild(s))&&l.isEmpty()===r.isEmpty()||(a!=null&&(r.isEmpty()?t.hasChild(e)?a.trackChildChange(hs(e,l)):D(t.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):l.isEmpty()?a.trackChildChange(sr(e,r)):a.trackChildChange(ds(e,r,l))),t.isLeafNode()&&r.isEmpty())?t:t.updateImmediateChild(e,r).withIndex(this.index_)}updateFullNode(t,e,r){return r!=null&&(t.isLeafNode()||t.forEachChild(ot,(s,i)=>{e.hasChild(s)||r.trackChildChange(hs(s,i))}),e.isLeafNode()||e.forEachChild(ot,(s,i)=>{if(t.hasChild(s)){let a=t.getImmediateChild(s);a.equals(i)||r.trackChildChange(ds(s,i,a))}else r.trackChildChange(sr(s,i))})),e.withIndex(this.index_)}updatePriority(t,e){return t.isEmpty()?$.EMPTY_NODE:t.updatePriority(e)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}};var To=class n{constructor(t){this.indexedFilter_=new fs(t.getIndex()),this.index_=t.getIndex(),this.startPost_=n.getStartPost_(t),this.endPost_=n.getEndPost_(t),this.startIsInclusive_=!t.startAfterSet_,this.endIsInclusive_=!t.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(t){let e=this.startIsInclusive_?this.index_.compare(this.getStartPost(),t)<=0:this.index_.compare(this.getStartPost(),t)<0,r=this.endIsInclusive_?this.index_.compare(t,this.getEndPost())<=0:this.index_.compare(t,this.getEndPost())<0;return e&&r}updateChild(t,e,r,s,i,a){return this.matches(new K(e,r))||(r=$.EMPTY_NODE),this.indexedFilter_.updateChild(t,e,r,s,i,a)}updateFullNode(t,e,r){e.isLeafNode()&&(e=$.EMPTY_NODE);let s=e.withIndex(this.index_);s=s.updatePriority($.EMPTY_NODE);let i=this;return e.forEachChild(ot,(a,l)=>{i.matches(new K(a,l))||(s=s.updateImmediateChild(a,$.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(t,s,r)}updatePriority(t,e){return t}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(t){if(t.hasStart()){let e=t.getIndexStartName();return t.getIndex().makePost(t.getIndexStartValue(),e)}else return t.getIndex().minPost()}static getEndPost_(t){if(t.hasEnd()){let e=t.getIndexEndName();return t.getIndex().makePost(t.getIndexEndValue(),e)}else return t.getIndex().maxPost()}};var mu=class{constructor(t){this.withinDirectionalStart=e=>this.reverse_?this.withinEndPost(e):this.withinStartPost(e),this.withinDirectionalEnd=e=>this.reverse_?this.withinStartPost(e):this.withinEndPost(e),this.withinStartPost=e=>{let r=this.index_.compare(this.rangedFilter_.getStartPost(),e);return this.startIsInclusive_?r<=0:r<0},this.withinEndPost=e=>{let r=this.index_.compare(e,this.rangedFilter_.getEndPost());return this.endIsInclusive_?r<=0:r<0},this.rangedFilter_=new To(t),this.index_=t.getIndex(),this.limit_=t.getLimit(),this.reverse_=!t.isViewFromLeft(),this.startIsInclusive_=!t.startAfterSet_,this.endIsInclusive_=!t.endBeforeSet_}updateChild(t,e,r,s,i,a){return this.rangedFilter_.matches(new K(e,r))||(r=$.EMPTY_NODE),t.getImmediateChild(e).equals(r)?t:t.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(t,e,r,s,i,a):this.fullLimitUpdateChild_(t,e,r,i,a)}updateFullNode(t,e,r){let s;if(e.isLeafNode()||e.isEmpty())s=$.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<e.numChildren()&&e.isIndexed(this.index_)){s=$.EMPTY_NODE.withIndex(this.index_);let i;this.reverse_?i=e.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):i=e.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let a=0;for(;i.hasNext()&&a<this.limit_;){let l=i.getNext();if(this.withinDirectionalStart(l))if(this.withinDirectionalEnd(l))s=s.updateImmediateChild(l.name,l.node),a++;else break;else continue}}else{s=e.withIndex(this.index_),s=s.updatePriority($.EMPTY_NODE);let i;this.reverse_?i=s.getReverseIterator(this.index_):i=s.getIterator(this.index_);let a=0;for(;i.hasNext();){let l=i.getNext();a<this.limit_&&this.withinDirectionalStart(l)&&this.withinDirectionalEnd(l)?a++:s=s.updateImmediateChild(l.name,$.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(t,s,r)}updatePriority(t,e){return t}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(t,e,r,s,i){let a;if(this.reverse_){let p=this.index_.getCompare();a=(g,A)=>p(A,g)}else a=this.index_.getCompare();let l=t;D(l.numChildren()===this.limit_,"");let u=new K(e,r),h=this.reverse_?l.getFirstChild(this.index_):l.getLastChild(this.index_),f=this.rangedFilter_.matches(u);if(l.hasChild(e)){let p=l.getImmediateChild(e),g=s.getChildAfterChild(this.index_,h,this.reverse_);for(;g!=null&&(g.name===e||l.hasChild(g.name));)g=s.getChildAfterChild(this.index_,g,this.reverse_);let A=g==null?1:a(g,u);if(f&&!r.isEmpty()&&A>=0)return i?.trackChildChange(ds(e,r,p)),l.updateImmediateChild(e,r);{i?.trackChildChange(hs(e,p));let N=l.updateImmediateChild(e,$.EMPTY_NODE);return g!=null&&this.rangedFilter_.matches(g)?(i?.trackChildChange(sr(g.name,g.node)),N.updateImmediateChild(g.name,g.node)):N}}else return r.isEmpty()?t:f&&a(h,u)>=0?(i!=null&&(i.trackChildChange(hs(h.name,h.node)),i.trackChildChange(sr(e,r))),l.updateImmediateChild(e,r).updateImmediateChild(h.name,$.EMPTY_NODE)):t}};var pu=class n{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=ot}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return D(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return D(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:tr}hasEnd(){return this.endSet_}getIndexEndValue(){return D(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return D(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:ln}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return D(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===ot}copy(){let t=new n;return t.limitSet_=this.limitSet_,t.limit_=this.limit_,t.startSet_=this.startSet_,t.startAfterSet_=this.startAfterSet_,t.indexStartValue_=this.indexStartValue_,t.startNameSet_=this.startNameSet_,t.indexStartName_=this.indexStartName_,t.endSet_=this.endSet_,t.endBeforeSet_=this.endBeforeSet_,t.indexEndValue_=this.indexEndValue_,t.endNameSet_=this.endNameSet_,t.indexEndName_=this.indexEndName_,t.index_=this.index_,t.viewFrom_=this.viewFrom_,t}};function cE(n){return n.loadsAllData()?new fs(n.getIndex()):n.hasLimit()?new mu(n):new To(n)}function Bp(n){let t={};if(n.isDefault())return t;let e;if(n.index_===ot?e="$priority":n.index_===aE?e="$value":n.index_===Jn?e="$key":(D(n.index_ instanceof du,"Unrecognized index type!"),e=n.index_.toString()),t.orderBy=mt(e),n.startSet_){let r=n.startAfterSet_?"startAfter":"startAt";t[r]=mt(n.indexStartValue_),n.startNameSet_&&(t[r]+=","+mt(n.indexStartName_))}if(n.endSet_){let r=n.endBeforeSet_?"endBefore":"endAt";t[r]=mt(n.indexEndValue_),n.endNameSet_&&(t[r]+=","+mt(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?t.limitToFirst=n.limit_:t.limitToLast=n.limit_),t}function Up(n){let t={};if(n.startSet_&&(t.sp=n.indexStartValue_,n.startNameSet_&&(t.sn=n.indexStartName_),t.sin=!n.startAfterSet_),n.endSet_&&(t.ep=n.indexEndValue_,n.endNameSet_&&(t.en=n.indexEndName_),t.ein=!n.endBeforeSet_),n.limitSet_){t.l=n.limit_;let e=n.viewFrom_;e===""&&(n.isViewFromLeft()?e="l":e="r"),t.vf=e}return n.index_!==ot&&(t.i=n.index_.toString()),t}var gu=class n extends yo{reportStats(t){throw new Error("Method not implemented.")}static getListenId_(t,e){return e!==void 0?"tag$"+e:(D(t._queryParams.isDefault(),"should have a tag if it's not a default query."),t._path.toString())}constructor(t,e,r,s){super(),this.repoInfo_=t,this.onDataUpdate_=e,this.authTokenProvider_=r,this.appCheckTokenProvider_=s,this.log_=ys("p:rest:"),this.listens_={}}listen(t,e,r,s){let i=t._path.toString();this.log_("Listen called for "+i+" "+t._queryIdentifier);let a=n.getListenId_(t,r),l={};this.listens_[a]=l;let u=Bp(t._queryParams);this.restRequest_(i+".json",u,(h,f)=>{let p=f;if(h===404&&(p=null,h=null),h===null&&this.onDataUpdate_(i,p,!1,r),je(this.listens_,a)===l){let g;h?h===401?g="permission_denied":g="rest_error:"+h:g="ok",s(g,null)}})}unlisten(t,e){let r=n.getListenId_(t,e);delete this.listens_[r]}get(t){let e=Bp(t._queryParams),r=t._path.toString(),s=new fe;return this.restRequest_(r+".json",e,(i,a)=>{let l=a;i===404&&(l=null,i=null),i===null?(this.onDataUpdate_(r,l,!1,null),s.resolve(l)):s.reject(new Error(l))}),s.promise}refreshAuthToken(t){}restRequest_(t,e={},r){return e.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([s,i])=>{s&&s.accessToken&&(e.auth=s.accessToken),i&&i.token&&(e.ac=i.token);let a=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+t+"?ns="+this.repoInfo_.namespace+Md(e);this.log_("Sending REST request for "+a);let l=new XMLHttpRequest;l.onreadystatechange=()=>{if(r&&l.readyState===4){this.log_("REST Response for "+a+" received. status:",l.status,"response:",l.responseText);let u=null;if(l.status>=200&&l.status<300){try{u=Ws(l.responseText)}catch{Vt("Failed to parse JSON response for "+a+": "+l.responseText)}r(null,u)}else l.status!==401&&l.status!==404&&Vt("Got unsuccessful REST response for "+a+" Status: "+l.status),r(l.status);r=null}},l.open("GET",a,!0),l.send()})}};var _u=class{constructor(){this.rootNode_=$.EMPTY_NODE}getNode(t){return this.rootNode_.getChild(t)}updateSnapshot(t,e){this.rootNode_=this.rootNode_.updateChild(t,e)}};function Ao(){return{value:null,children:new Map}}function cr(n,t,e){if(j(t))n.value=e,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(t,e);else{let r=z(t);n.children.has(r)||n.children.set(r,Ao());let s=n.children.get(r);t=et(t),cr(s,t,e)}}function yu(n,t){if(j(t))return n.value=null,n.children.clear(),!0;if(n.value!==null){if(n.value.isLeafNode())return!1;{let e=n.value;return n.value=null,e.forEachChild(ot,(r,s)=>{cr(n,new J(r),s)}),yu(n,t)}}else if(n.children.size>0){let e=z(t);return t=et(t),n.children.has(e)&&yu(n.children.get(e),t)&&n.children.delete(e),n.children.size===0}else return!0}function vu(n,t,e){n.value!==null?e(t,n.value):uE(n,(r,s)=>{let i=new J(t.toString()+"/"+r);vu(s,i,e)})}function uE(n,t){n.children.forEach((e,r)=>{t(r,e)})}var wu=class{constructor(t){this.collection_=t,this.last_=null}get(){let t=this.collection_.get(),e=Object.assign({},t);return this.last_&&Rt(this.last_,(r,s)=>{e[r]=e[r]-s}),this.last_=t,e}};var qp=10*1e3,hE=30*1e3,dE=5*60*1e3,Eu=class{constructor(t,e){this.server_=e,this.statsToReport_={},this.statsListener_=new wu(t);let r=qp+(hE-qp)*Math.random();is(this.reportStats_.bind(this),Math.floor(r))}reportStats_(){let t=this.statsListener_.get(),e={},r=!1;Rt(t,(s,i)=>{i>0&&Kt(this.statsToReport_,s)&&(e[s]=i,r=!0)}),r&&this.server_.reportStats(e),is(this.reportStats_.bind(this),Math.floor(Math.random()*2*dE))}};var ce=function(n){return n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE",n}(ce||{});function xg(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function th(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function eh(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}var Iu=class n{constructor(t,e,r){this.path=t,this.affectedTree=e,this.revert=r,this.type=ce.ACK_USER_WRITE,this.source=xg()}operationForChild(t){if(j(this.path)){if(this.affectedTree.value!=null)return D(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let e=this.affectedTree.subtree(new J(t));return new n(X(),e,this.revert)}}else return D(z(this.path)===t,"operationForChild called for unrelated child."),new n(et(this.path),this.affectedTree,this.revert)}};var Co=class n{constructor(t,e){this.source=t,this.path=e,this.type=ce.LISTEN_COMPLETE}operationForChild(t){return j(this.path)?new n(this.source,X()):new n(this.source,et(this.path))}};var ir=class n{constructor(t,e,r){this.source=t,this.path=e,this.snap=r,this.type=ce.OVERWRITE}operationForChild(t){return j(this.path)?new n(this.source,X(),this.snap.getImmediateChild(t)):new n(this.source,et(this.path),this.snap)}};var So=class n{constructor(t,e,r){this.source=t,this.path=e,this.children=r,this.type=ce.MERGE}operationForChild(t){if(j(this.path)){let e=this.children.subtree(new J(t));return e.isEmpty()?null:e.value?new ir(this.source,X(),e.value):new n(this.source,X(),e)}else return D(z(this.path)===t,"Can't get a merge for a child not on the path of the operation"),new n(this.source,et(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}};var Ie=class{constructor(t,e,r){this.node_=t,this.fullyInitialized_=e,this.filtered_=r}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(t){if(j(t))return this.isFullyInitialized()&&!this.filtered_;let e=z(t);return this.isCompleteForChild(e)}isCompleteForChild(t){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(t)}getNode(){return this.node_}};var Tu=class{constructor(t){this.query_=t,this.index_=this.query_._queryParams.getIndex()}};function fE(n,t,e,r){let s=[],i=[];return t.forEach(a=>{a.type==="child_changed"&&n.index_.indexedValueChanged(a.oldSnap,a.snapshotNode)&&i.push(lE(a.childName,a.snapshotNode))}),ss(n,s,"child_removed",t,r,e),ss(n,s,"child_added",t,r,e),ss(n,s,"child_moved",i,r,e),ss(n,s,"child_changed",t,r,e),ss(n,s,"value",t,r,e),s}function ss(n,t,e,r,s,i){let a=r.filter(l=>l.type===e);a.sort((l,u)=>pE(n,l,u)),a.forEach(l=>{let u=mE(n,l,i);s.forEach(h=>{h.respondsTo(l.type)&&t.push(h.createEvent(u,n.query_))})})}function mE(n,t,e){return t.type==="value"||t.type==="child_removed"||(t.prevName=e.getPredecessorChildName(t.childName,t.snapshotNode,n.index_)),t}function pE(n,t,e){if(t.childName==null||e.childName==null)throw yn("Should only compare child_ events.");let r=new K(t.childName,t.snapshotNode),s=new K(e.childName,e.snapshotNode);return n.index_.compare(r,s)}function Lo(n,t){return{eventCache:n,serverCache:t}}function as(n,t,e,r){return Lo(new Ie(t,e,r),n.serverCache)}function Ng(n,t,e,r){return Lo(n.eventCache,new Ie(t,e,r))}function Au(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function cn(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}var zc,gE=()=>(zc||(zc=new zt(gw)),zc),Ot=class n{static fromObject(t){let e=new n(null);return Rt(t,(r,s)=>{e=e.set(new J(r),s)}),e}constructor(t,e=gE()){this.value=t,this.children=e}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(t,e){if(this.value!=null&&e(this.value))return{path:X(),value:this.value};if(j(t))return null;{let r=z(t),s=this.children.get(r);if(s!==null){let i=s.findRootMostMatchingPathAndValue(et(t),e);return i!=null?{path:ct(new J(r),i.path),value:i.value}:null}else return null}}findRootMostValueAndPath(t){return this.findRootMostMatchingPathAndValue(t,()=>!0)}subtree(t){if(j(t))return this;{let e=z(t),r=this.children.get(e);return r!==null?r.subtree(et(t)):new n(null)}}set(t,e){if(j(t))return new n(e,this.children);{let r=z(t),i=(this.children.get(r)||new n(null)).set(et(t),e),a=this.children.insert(r,i);return new n(this.value,a)}}remove(t){if(j(t))return this.children.isEmpty()?new n(null):new n(null,this.children);{let e=z(t),r=this.children.get(e);if(r){let s=r.remove(et(t)),i;return s.isEmpty()?i=this.children.remove(e):i=this.children.insert(e,s),this.value===null&&i.isEmpty()?new n(null):new n(this.value,i)}else return this}}get(t){if(j(t))return this.value;{let e=z(t),r=this.children.get(e);return r?r.get(et(t)):null}}setTree(t,e){if(j(t))return e;{let r=z(t),i=(this.children.get(r)||new n(null)).setTree(et(t),e),a;return i.isEmpty()?a=this.children.remove(r):a=this.children.insert(r,i),new n(this.value,a)}}fold(t){return this.fold_(X(),t)}fold_(t,e){let r={};return this.children.inorderTraversal((s,i)=>{r[s]=i.fold_(ct(t,s),e)}),e(t,this.value,r)}findOnPath(t,e){return this.findOnPath_(t,X(),e)}findOnPath_(t,e,r){let s=this.value?r(e,this.value):!1;if(s)return s;if(j(t))return null;{let i=z(t),a=this.children.get(i);return a?a.findOnPath_(et(t),ct(e,i),r):null}}foreachOnPath(t,e){return this.foreachOnPath_(t,X(),e)}foreachOnPath_(t,e,r){if(j(t))return this;{this.value&&r(e,this.value);let s=z(t),i=this.children.get(s);return i?i.foreachOnPath_(et(t),ct(e,s),r):new n(null)}}foreach(t){this.foreach_(X(),t)}foreach_(t,e){this.children.inorderTraversal((r,s)=>{s.foreach_(ct(t,r),e)}),this.value&&e(t,this.value)}foreachChild(t){this.children.inorderTraversal((e,r)=>{r.value&&t(e,r.value)})}};var Yt=class n{constructor(t){this.writeTree_=t}static empty(){return new n(new Ot(null))}};function ls(n,t,e){if(j(t))return new Yt(new Ot(e));{let r=n.writeTree_.findRootMostValueAndPath(t);if(r!=null){let s=r.path,i=r.value,a=kt(s,t);return i=i.updateChild(a,e),new Yt(n.writeTree_.set(s,i))}else{let s=new Ot(e),i=n.writeTree_.setTree(t,s);return new Yt(i)}}}function $p(n,t,e){let r=n;return Rt(e,(s,i)=>{r=ls(r,ct(t,s),i)}),r}function Gp(n,t){if(j(t))return Yt.empty();{let e=n.writeTree_.setTree(t,new Ot(null));return new Yt(e)}}function Cu(n,t){return hn(n,t)!=null}function hn(n,t){let e=n.writeTree_.findRootMostValueAndPath(t);return e!=null?n.writeTree_.get(e.path).getChild(kt(e.path,t)):null}function zp(n){let t=[],e=n.writeTree_.value;return e!=null?e.isLeafNode()||e.forEachChild(ot,(r,s)=>{t.push(new K(r,s))}):n.writeTree_.children.inorderTraversal((r,s)=>{s.value!=null&&t.push(new K(r,s.value))}),t}function Me(n,t){if(j(t))return n;{let e=hn(n,t);return e!=null?new Yt(new Ot(e)):new Yt(n.writeTree_.subtree(t))}}function Su(n){return n.writeTree_.isEmpty()}function or(n,t){return Dg(X(),n.writeTree_,t)}function Dg(n,t,e){if(t.value!=null)return e.updateChild(n,t.value);{let r=null;return t.children.inorderTraversal((s,i)=>{s===".priority"?(D(i.value!==null,"Priority writes must always be leaf nodes"),r=i.value):e=Dg(ct(n,s),i,e)}),!e.getChild(n).isEmpty()&&r!==null&&(e=e.updateChild(ct(n,".priority"),r)),e}}function nh(n,t){return Fg(t,n)}function _E(n,t,e,r,s){D(r>n.lastWriteId,"Stacking an older write on top of newer ones"),s===void 0&&(s=!0),n.allWrites.push({path:t,snap:e,writeId:r,visible:s}),s&&(n.visibleWrites=ls(n.visibleWrites,t,e)),n.lastWriteId=r}function yE(n,t){for(let e=0;e<n.allWrites.length;e++){let r=n.allWrites[e];if(r.writeId===t)return r}return null}function vE(n,t){let e=n.allWrites.findIndex(l=>l.writeId===t);D(e>=0,"removeWrite called with nonexistent writeId.");let r=n.allWrites[e];n.allWrites.splice(e,1);let s=r.visible,i=!1,a=n.allWrites.length-1;for(;s&&a>=0;){let l=n.allWrites[a];l.visible&&(a>=e&&wE(l,r.path)?s=!1:Gt(r.path,l.path)&&(i=!0)),a--}if(s){if(i)return EE(n),!0;if(r.snap)n.visibleWrites=Gp(n.visibleWrites,r.path);else{let l=r.children;Rt(l,u=>{n.visibleWrites=Gp(n.visibleWrites,ct(r.path,u))})}return!0}else return!1}function wE(n,t){if(n.snap)return Gt(n.path,t);for(let e in n.children)if(n.children.hasOwnProperty(e)&&Gt(ct(n.path,e),t))return!0;return!1}function EE(n){n.visibleWrites=kg(n.allWrites,IE,X()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function IE(n){return n.visible}function kg(n,t,e){let r=Yt.empty();for(let s=0;s<n.length;++s){let i=n[s];if(t(i)){let a=i.path,l;if(i.snap)Gt(e,a)?(l=kt(e,a),r=ls(r,l,i.snap)):Gt(a,e)&&(l=kt(a,e),r=ls(r,X(),i.snap.getChild(l)));else if(i.children){if(Gt(e,a))l=kt(e,a),r=$p(r,l,i.children);else if(Gt(a,e))if(l=kt(a,e),j(l))r=$p(r,X(),i.children);else{let u=je(i.children,z(l));if(u){let h=u.getChild(et(l));r=ls(r,X(),h)}}}else throw yn("WriteRecord should have .snap or .children")}}return r}function Vg(n,t,e,r,s){if(!r&&!s){let i=hn(n.visibleWrites,t);if(i!=null)return i;{let a=Me(n.visibleWrites,t);if(Su(a))return e;if(e==null&&!Cu(a,X()))return null;{let l=e||$.EMPTY_NODE;return or(a,l)}}}else{let i=Me(n.visibleWrites,t);if(!s&&Su(i))return e;if(!s&&e==null&&!Cu(i,X()))return null;{let a=function(h){return(h.visible||s)&&(!r||!~r.indexOf(h.writeId))&&(Gt(h.path,t)||Gt(t,h.path))},l=kg(n.allWrites,a,t),u=e||$.EMPTY_NODE;return or(l,u)}}}function TE(n,t,e){let r=$.EMPTY_NODE,s=hn(n.visibleWrites,t);if(s)return s.isLeafNode()||s.forEachChild(ot,(i,a)=>{r=r.updateImmediateChild(i,a)}),r;if(e){let i=Me(n.visibleWrites,t);return e.forEachChild(ot,(a,l)=>{let u=or(Me(i,new J(a)),l);r=r.updateImmediateChild(a,u)}),zp(i).forEach(a=>{r=r.updateImmediateChild(a.name,a.node)}),r}else{let i=Me(n.visibleWrites,t);return zp(i).forEach(a=>{r=r.updateImmediateChild(a.name,a.node)}),r}}function AE(n,t,e,r,s){D(r||s,"Either existingEventSnap or existingServerSnap must exist");let i=ct(t,e);if(Cu(n.visibleWrites,i))return null;{let a=Me(n.visibleWrites,i);return Su(a)?s.getChild(e):or(a,s.getChild(e))}}function CE(n,t,e,r){let s=ct(t,e),i=hn(n.visibleWrites,s);if(i!=null)return i;if(r.isCompleteForChild(e)){let a=Me(n.visibleWrites,s);return or(a,r.getNode().getImmediateChild(e))}else return null}function SE(n,t){return hn(n.visibleWrites,t)}function bE(n,t,e,r,s,i,a){let l,u=Me(n.visibleWrites,t),h=hn(u,X());if(h!=null)l=h;else if(e!=null)l=or(u,e);else return[];if(l=l.withIndex(a),!l.isEmpty()&&!l.isLeafNode()){let f=[],p=a.getCompare(),g=i?l.getReverseIteratorFrom(r,a):l.getIteratorFrom(r,a),A=g.getNext();for(;A&&f.length<s;)p(A,r)!==0&&f.push(A),A=g.getNext();return f}else return[]}function RE(){return{visibleWrites:Yt.empty(),allWrites:[],lastWriteId:-1}}function bo(n,t,e,r){return Vg(n.writeTree,n.treePath,t,e,r)}function rh(n,t){return TE(n.writeTree,n.treePath,t)}function jp(n,t,e,r){return AE(n.writeTree,n.treePath,t,e,r)}function Ro(n,t){return SE(n.writeTree,ct(n.treePath,t))}function PE(n,t,e,r,s,i){return bE(n.writeTree,n.treePath,t,e,r,s,i)}function sh(n,t,e){return CE(n.writeTree,n.treePath,t,e)}function Og(n,t){return Fg(ct(n.treePath,t),n.writeTree)}function Fg(n,t){return{treePath:n,writeTree:t}}var bu=class{constructor(){this.changeMap=new Map}trackChildChange(t){let e=t.type,r=t.childName;D(e==="child_added"||e==="child_changed"||e==="child_removed","Only child changes supported for tracking"),D(r!==".priority","Only non-priority child changes can be tracked.");let s=this.changeMap.get(r);if(s){let i=s.type;if(e==="child_added"&&i==="child_removed")this.changeMap.set(r,ds(r,t.snapshotNode,s.snapshotNode));else if(e==="child_removed"&&i==="child_added")this.changeMap.delete(r);else if(e==="child_removed"&&i==="child_changed")this.changeMap.set(r,hs(r,s.oldSnap));else if(e==="child_changed"&&i==="child_added")this.changeMap.set(r,sr(r,t.snapshotNode));else if(e==="child_changed"&&i==="child_changed")this.changeMap.set(r,ds(r,t.snapshotNode,s.oldSnap));else throw yn("Illegal combination of changes: "+t+" occurred after "+s)}else this.changeMap.set(r,t)}getChanges(){return Array.from(this.changeMap.values())}};var Ru=class{getCompleteChild(t){return null}getChildAfterChild(t,e,r){return null}},Mg=new Ru,ms=class{constructor(t,e,r=null){this.writes_=t,this.viewCache_=e,this.optCompleteServerCache_=r}getCompleteChild(t){let e=this.viewCache_.eventCache;if(e.isCompleteForChild(t))return e.getNode().getImmediateChild(t);{let r=this.optCompleteServerCache_!=null?new Ie(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return sh(this.writes_,t,r)}}getChildAfterChild(t,e,r){let s=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:cn(this.viewCache_),i=PE(this.writes_,s,e,1,r,t);return i.length===0?null:i[0]}};function xE(n){return{filter:n}}function NE(n,t){D(t.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),D(t.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function DE(n,t,e,r,s){let i=new bu,a,l;if(e.type===ce.OVERWRITE){let h=e;h.source.fromUser?a=Pu(n,t,h.path,h.snap,r,s,i):(D(h.source.fromServer,"Unknown source."),l=h.source.tagged||t.serverCache.isFiltered()&&!j(h.path),a=Po(n,t,h.path,h.snap,r,s,l,i))}else if(e.type===ce.MERGE){let h=e;h.source.fromUser?a=VE(n,t,h.path,h.children,r,s,i):(D(h.source.fromServer,"Unknown source."),l=h.source.tagged||t.serverCache.isFiltered(),a=xu(n,t,h.path,h.children,r,s,l,i))}else if(e.type===ce.ACK_USER_WRITE){let h=e;h.revert?a=ME(n,t,h.path,r,s,i):a=OE(n,t,h.path,h.affectedTree,r,s,i)}else if(e.type===ce.LISTEN_COMPLETE)a=FE(n,t,e.path,r,i);else throw yn("Unknown operation type: "+e.type);let u=i.getChanges();return kE(t,a,u),{viewCache:a,changes:u}}function kE(n,t,e){let r=t.eventCache;if(r.isFullyInitialized()){let s=r.getNode().isLeafNode()||r.getNode().isEmpty(),i=Au(n);(e.length>0||!n.eventCache.isFullyInitialized()||s&&!r.getNode().equals(i)||!r.getNode().getPriority().equals(i.getPriority()))&&e.push(Pg(Au(t)))}}function Lg(n,t,e,r,s,i){let a=t.eventCache;if(Ro(r,e)!=null)return t;{let l,u;if(j(e))if(D(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){let h=cn(t),f=h instanceof $?h:$.EMPTY_NODE,p=rh(r,f);l=n.filter.updateFullNode(t.eventCache.getNode(),p,i)}else{let h=bo(r,cn(t));l=n.filter.updateFullNode(t.eventCache.getNode(),h,i)}else{let h=z(e);if(h===".priority"){D(Le(e)===1,"Can't have a priority with additional path components");let f=a.getNode();u=t.serverCache.getNode();let p=jp(r,e,f,u);p!=null?l=n.filter.updatePriority(f,p):l=a.getNode()}else{let f=et(e),p;if(a.isCompleteForChild(h)){u=t.serverCache.getNode();let g=jp(r,e,a.getNode(),u);g!=null?p=a.getNode().getImmediateChild(h).updateChild(f,g):p=a.getNode().getImmediateChild(h)}else p=sh(r,h,t.serverCache);p!=null?l=n.filter.updateChild(a.getNode(),h,p,f,s,i):l=a.getNode()}}return as(t,l,a.isFullyInitialized()||j(e),n.filter.filtersNodes())}}function Po(n,t,e,r,s,i,a,l){let u=t.serverCache,h,f=a?n.filter:n.filter.getIndexedFilter();if(j(e))h=f.updateFullNode(u.getNode(),r,null);else if(f.filtersNodes()&&!u.isFiltered()){let A=u.getNode().updateChild(e,r);h=f.updateFullNode(u.getNode(),A,null)}else{let A=z(e);if(!u.isCompleteForPath(e)&&Le(e)>1)return t;let b=et(e),x=u.getNode().getImmediateChild(A).updateChild(b,r);A===".priority"?h=f.updatePriority(u.getNode(),x):h=f.updateChild(u.getNode(),A,x,b,Mg,null)}let p=Ng(t,h,u.isFullyInitialized()||j(e),f.filtersNodes()),g=new ms(s,p,i);return Lg(n,p,e,s,g,l)}function Pu(n,t,e,r,s,i,a){let l=t.eventCache,u,h,f=new ms(s,t,i);if(j(e))h=n.filter.updateFullNode(t.eventCache.getNode(),r,a),u=as(t,h,!0,n.filter.filtersNodes());else{let p=z(e);if(p===".priority")h=n.filter.updatePriority(t.eventCache.getNode(),r),u=as(t,h,l.isFullyInitialized(),l.isFiltered());else{let g=et(e),A=l.getNode().getImmediateChild(p),b;if(j(g))b=r;else{let N=f.getCompleteChild(p);N!=null?Yu(g)===".priority"&&N.getChild(Tg(g)).isEmpty()?b=N:b=N.updateChild(g,r):b=$.EMPTY_NODE}if(A.equals(b))u=t;else{let N=n.filter.updateChild(l.getNode(),p,b,g,f,a);u=as(t,N,l.isFullyInitialized(),n.filter.filtersNodes())}}}return u}function Kp(n,t){return n.eventCache.isCompleteForChild(t)}function VE(n,t,e,r,s,i,a){let l=t;return r.foreach((u,h)=>{let f=ct(e,u);Kp(t,z(f))&&(l=Pu(n,l,f,h,s,i,a))}),r.foreach((u,h)=>{let f=ct(e,u);Kp(t,z(f))||(l=Pu(n,l,f,h,s,i,a))}),l}function Wp(n,t,e){return e.foreach((r,s)=>{t=t.updateChild(r,s)}),t}function xu(n,t,e,r,s,i,a,l){if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let u=t,h;j(e)?h=r:h=new Ot(null).setTree(e,r);let f=t.serverCache.getNode();return h.children.inorderTraversal((p,g)=>{if(f.hasChild(p)){let A=t.serverCache.getNode().getImmediateChild(p),b=Wp(n,A,g);u=Po(n,u,new J(p),b,s,i,a,l)}}),h.children.inorderTraversal((p,g)=>{let A=!t.serverCache.isCompleteForChild(p)&&g.value===null;if(!f.hasChild(p)&&!A){let b=t.serverCache.getNode().getImmediateChild(p),N=Wp(n,b,g);u=Po(n,u,new J(p),N,s,i,a,l)}}),u}function OE(n,t,e,r,s,i,a){if(Ro(s,e)!=null)return t;let l=t.serverCache.isFiltered(),u=t.serverCache;if(r.value!=null){if(j(e)&&u.isFullyInitialized()||u.isCompleteForPath(e))return Po(n,t,e,u.getNode().getChild(e),s,i,l,a);if(j(e)){let h=new Ot(null);return u.getNode().forEachChild(Jn,(f,p)=>{h=h.set(new J(f),p)}),xu(n,t,e,h,s,i,l,a)}else return t}else{let h=new Ot(null);return r.foreach((f,p)=>{let g=ct(e,f);u.isCompleteForPath(g)&&(h=h.set(f,u.getNode().getChild(g)))}),xu(n,t,e,h,s,i,l,a)}}function FE(n,t,e,r,s){let i=t.serverCache,a=Ng(t,i.getNode(),i.isFullyInitialized()||j(e),i.isFiltered());return Lg(n,a,e,r,Mg,s)}function ME(n,t,e,r,s,i){let a;if(Ro(r,e)!=null)return t;{let l=new ms(r,t,s),u=t.eventCache.getNode(),h;if(j(e)||z(e)===".priority"){let f;if(t.serverCache.isFullyInitialized())f=bo(r,cn(t));else{let p=t.serverCache.getNode();D(p instanceof $,"serverChildren would be complete if leaf node"),f=rh(r,p)}f=f,h=n.filter.updateFullNode(u,f,i)}else{let f=z(e),p=sh(r,f,t.serverCache);p==null&&t.serverCache.isCompleteForChild(f)&&(p=u.getImmediateChild(f)),p!=null?h=n.filter.updateChild(u,f,p,et(e),l,i):t.eventCache.getNode().hasChild(f)?h=n.filter.updateChild(u,f,$.EMPTY_NODE,et(e),l,i):h=u,h.isEmpty()&&t.serverCache.isFullyInitialized()&&(a=bo(r,cn(t)),a.isLeafNode()&&(h=n.filter.updateFullNode(h,a,i)))}return a=t.serverCache.isFullyInitialized()||Ro(r,X())!=null,as(t,h,a,n.filter.filtersNodes())}}var Nu=class{constructor(t,e){this.query_=t,this.eventRegistrations_=[];let r=this.query_._queryParams,s=new fs(r.getIndex()),i=cE(r);this.processor_=xE(i);let a=e.serverCache,l=e.eventCache,u=s.updateFullNode($.EMPTY_NODE,a.getNode(),null),h=i.updateFullNode($.EMPTY_NODE,l.getNode(),null),f=new Ie(u,a.isFullyInitialized(),s.filtersNodes()),p=new Ie(h,l.isFullyInitialized(),i.filtersNodes());this.viewCache_=Lo(p,f),this.eventGenerator_=new Tu(this.query_)}get query(){return this.query_}};function LE(n){return n.viewCache_.serverCache.getNode()}function BE(n,t){let e=cn(n.viewCache_);return e&&(n.query._queryParams.loadsAllData()||!j(t)&&!e.getImmediateChild(z(t)).isEmpty())?e.getChild(t):null}function Qp(n){return n.eventRegistrations_.length===0}function UE(n,t){n.eventRegistrations_.push(t)}function Hp(n,t,e){let r=[];if(e){D(t==null,"A cancel should cancel all event registrations.");let s=n.query._path;n.eventRegistrations_.forEach(i=>{let a=i.createCancelEvent(e,s);a&&r.push(a)})}if(t){let s=[];for(let i=0;i<n.eventRegistrations_.length;++i){let a=n.eventRegistrations_[i];if(!a.matches(t))s.push(a);else if(t.hasAnyCallback()){s=s.concat(n.eventRegistrations_.slice(i+1));break}}n.eventRegistrations_=s}else n.eventRegistrations_=[];return r}function Yp(n,t,e,r){t.type===ce.MERGE&&t.source.queryId!==null&&(D(cn(n.viewCache_),"We should always have a full cache before handling merges"),D(Au(n.viewCache_),"Missing event cache, even though we have a server cache"));let s=n.viewCache_,i=DE(n.processor_,s,t,e,r);return NE(n.processor_,i.viewCache),D(i.viewCache.serverCache.isFullyInitialized()||!s.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=i.viewCache,Bg(n,i.changes,i.viewCache.eventCache.getNode(),null)}function qE(n,t){let e=n.viewCache_.eventCache,r=[];return e.getNode().isLeafNode()||e.getNode().forEachChild(ot,(i,a)=>{r.push(sr(i,a))}),e.isFullyInitialized()&&r.push(Pg(e.getNode())),Bg(n,r,e.getNode(),t)}function Bg(n,t,e,r){let s=r?[r]:n.eventRegistrations_;return fE(n.eventGenerator_,t,e,s)}var xo,Du=class{constructor(){this.views=new Map}};function $E(n){D(!xo,"__referenceConstructor has already been defined"),xo=n}function GE(){return D(xo,"Reference.ts has not been loaded"),xo}function zE(n){return n.views.size===0}function ih(n,t,e,r){let s=t.source.queryId;if(s!==null){let i=n.views.get(s);return D(i!=null,"SyncTree gave us an op for an invalid query."),Yp(i,t,e,r)}else{let i=[];for(let a of n.views.values())i=i.concat(Yp(a,t,e,r));return i}}function jE(n,t,e,r,s){let i=t._queryIdentifier,a=n.views.get(i);if(!a){let l=bo(e,s?r:null),u=!1;l?u=!0:r instanceof $?(l=rh(e,r),u=!1):(l=$.EMPTY_NODE,u=!1);let h=Lo(new Ie(l,u,!1),new Ie(r,s,!1));return new Nu(t,h)}return a}function KE(n,t,e,r,s,i){let a=jE(n,t,r,s,i);return n.views.has(t._queryIdentifier)||n.views.set(t._queryIdentifier,a),UE(a,e),qE(a,e)}function WE(n,t,e,r){let s=t._queryIdentifier,i=[],a=[],l=Be(n);if(s==="default")for(let[u,h]of n.views.entries())a=a.concat(Hp(h,e,r)),Qp(h)&&(n.views.delete(u),h.query._queryParams.loadsAllData()||i.push(h.query));else{let u=n.views.get(s);u&&(a=a.concat(Hp(u,e,r)),Qp(u)&&(n.views.delete(s),u.query._queryParams.loadsAllData()||i.push(u.query)))}return l&&!Be(n)&&i.push(new(GE())(t._repo,t._path)),{removed:i,events:a}}function Ug(n){let t=[];for(let e of n.views.values())e.query._queryParams.loadsAllData()||t.push(e);return t}function Zn(n,t){let e=null;for(let r of n.views.values())e=e||BE(r,t);return e}function qg(n,t){if(t._queryParams.loadsAllData())return Bo(n);{let r=t._queryIdentifier;return n.views.get(r)}}function $g(n,t){return qg(n,t)!=null}function Be(n){return Bo(n)!=null}function Bo(n){for(let t of n.views.values())if(t.query._queryParams.loadsAllData())return t;return null}var No;function QE(n){D(!No,"__referenceConstructor has already been defined"),No=n}function HE(){return D(No,"Reference.ts has not been loaded"),No}var YE=1,Do=class{constructor(t){this.listenProvider_=t,this.syncPointTree_=new Ot(null),this.pendingWriteTree_=RE(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}};function Gg(n,t,e,r,s){return _E(n.pendingWriteTree_,t,e,r,s),s?ws(n,new ir(xg(),t,e)):[]}function on(n,t,e=!1){let r=yE(n.pendingWriteTree_,t);if(vE(n.pendingWriteTree_,t)){let i=new Ot(null);return r.snap!=null?i=i.set(X(),!0):Rt(r.children,a=>{i=i.set(new J(a),!0)}),ws(n,new Iu(r.path,i,e))}else return[]}function Uo(n,t,e){return ws(n,new ir(th(),t,e))}function XE(n,t,e){let r=Ot.fromObject(e);return ws(n,new So(th(),t,r))}function JE(n,t){return ws(n,new Co(th(),t))}function ZE(n,t,e){let r=ah(n,e);if(r){let s=lh(r),i=s.path,a=s.queryId,l=kt(i,t),u=new Co(eh(a),l);return ch(n,i,u)}else return[]}function ku(n,t,e,r,s=!1){let i=t._path,a=n.syncPointTree_.get(i),l=[];if(a&&(t._queryIdentifier==="default"||$g(a,t))){let u=WE(a,t,e,r);zE(a)&&(n.syncPointTree_=n.syncPointTree_.remove(i));let h=u.removed;if(l=u.events,!s){let f=h.findIndex(g=>g._queryParams.loadsAllData())!==-1,p=n.syncPointTree_.findOnPath(i,(g,A)=>Be(A));if(f&&!p){let g=n.syncPointTree_.subtree(i);if(!g.isEmpty()){let A=nI(g);for(let b=0;b<A.length;++b){let N=A[b],x=N.query,U=Kg(n,N);n.listenProvider_.startListening(cs(x),ko(n,x),U.hashFn,U.onComplete)}}}!p&&h.length>0&&!r&&(f?n.listenProvider_.stopListening(cs(t),null):h.forEach(g=>{let A=n.queryToTagMap.get(qo(g));n.listenProvider_.stopListening(cs(g),A)}))}rI(n,h)}return l}function tI(n,t,e,r){let s=ah(n,r);if(s!=null){let i=lh(s),a=i.path,l=i.queryId,u=kt(a,t),h=new ir(eh(l),u,e);return ch(n,a,h)}else return[]}function eI(n,t,e,r){let s=ah(n,r);if(s){let i=lh(s),a=i.path,l=i.queryId,u=kt(a,t),h=Ot.fromObject(e),f=new So(eh(l),u,h);return ch(n,a,f)}else return[]}function Xp(n,t,e,r=!1){let s=t._path,i=null,a=!1;n.syncPointTree_.foreachOnPath(s,(g,A)=>{let b=kt(g,s);i=i||Zn(A,b),a=a||Be(A)});let l=n.syncPointTree_.get(s);l?(a=a||Be(l),i=i||Zn(l,X())):(l=new Du,n.syncPointTree_=n.syncPointTree_.set(s,l));let u;i!=null?u=!0:(u=!1,i=$.EMPTY_NODE,n.syncPointTree_.subtree(s).foreachChild((A,b)=>{let N=Zn(b,X());N&&(i=i.updateImmediateChild(A,N))}));let h=$g(l,t);if(!h&&!t._queryParams.loadsAllData()){let g=qo(t);D(!n.queryToTagMap.has(g),"View does not exist, but we have a tag");let A=sI();n.queryToTagMap.set(g,A),n.tagToQueryMap.set(A,g)}let f=nh(n.pendingWriteTree_,s),p=KE(l,t,e,f,i,u);if(!h&&!a&&!r){let g=qg(l,t);p=p.concat(iI(n,t,g))}return p}function oh(n,t,e){let s=n.pendingWriteTree_,i=n.syncPointTree_.findOnPath(t,(a,l)=>{let u=kt(a,t),h=Zn(l,u);if(h)return h});return Vg(s,t,i,e,!0)}function ws(n,t){return zg(t,n.syncPointTree_,null,nh(n.pendingWriteTree_,X()))}function zg(n,t,e,r){if(j(n.path))return jg(n,t,e,r);{let s=t.get(X());e==null&&s!=null&&(e=Zn(s,X()));let i=[],a=z(n.path),l=n.operationForChild(a),u=t.children.get(a);if(u&&l){let h=e?e.getImmediateChild(a):null,f=Og(r,a);i=i.concat(zg(l,u,h,f))}return s&&(i=i.concat(ih(s,n,r,e))),i}}function jg(n,t,e,r){let s=t.get(X());e==null&&s!=null&&(e=Zn(s,X()));let i=[];return t.children.inorderTraversal((a,l)=>{let u=e?e.getImmediateChild(a):null,h=Og(r,a),f=n.operationForChild(a);f&&(i=i.concat(jg(f,l,u,h)))}),s&&(i=i.concat(ih(s,n,r,e))),i}function Kg(n,t){let e=t.query,r=ko(n,e);return{hashFn:()=>(LE(t)||$.EMPTY_NODE).hash(),onComplete:s=>{if(s==="ok")return r?ZE(n,e._path,r):JE(n,e._path);{let i=vw(s,e);return ku(n,e,null,i)}}}}function ko(n,t){let e=qo(t);return n.queryToTagMap.get(e)}function qo(n){return n._path.toString()+"$"+n._queryIdentifier}function ah(n,t){return n.tagToQueryMap.get(t)}function lh(n){let t=n.indexOf("$");return D(t!==-1&&t<n.length-1,"Bad queryKey."),{queryId:n.substr(t+1),path:new J(n.substr(0,t))}}function ch(n,t,e){let r=n.syncPointTree_.get(t);D(r,"Missing sync point for query tag that we're tracking");let s=nh(n.pendingWriteTree_,t);return ih(r,e,s,null)}function nI(n){return n.fold((t,e,r)=>{if(e&&Be(e))return[Bo(e)];{let s=[];return e&&(s=Ug(e)),Rt(r,(i,a)=>{s=s.concat(a)}),s}})}function cs(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(HE())(n._repo,n._path):n}function rI(n,t){for(let e=0;e<t.length;++e){let r=t[e];if(!r._queryParams.loadsAllData()){let s=qo(r),i=n.queryToTagMap.get(s);n.queryToTagMap.delete(s),n.tagToQueryMap.delete(i)}}}function sI(){return YE++}function iI(n,t,e){let r=t._path,s=ko(n,t),i=Kg(n,e),a=n.listenProvider_.startListening(cs(t),s,i.hashFn,i.onComplete),l=n.syncPointTree_.subtree(r);if(s)D(!Be(l.value),"If we're adding a query, it shouldn't be shadowed");else{let u=l.fold((h,f,p)=>{if(!j(h)&&f&&Be(f))return[Bo(f).query];{let g=[];return f&&(g=g.concat(Ug(f).map(A=>A.query))),Rt(p,(A,b)=>{g=g.concat(b)}),g}});for(let h=0;h<u.length;++h){let f=u[h];n.listenProvider_.stopListening(cs(f),ko(n,f))}}return a}var Vu=class n{constructor(t){this.node_=t}getImmediateChild(t){let e=this.node_.getImmediateChild(t);return new n(e)}node(){return this.node_}},Ou=class n{constructor(t,e){this.syncTree_=t,this.path_=e}getImmediateChild(t){let e=ct(this.path_,t);return new n(this.syncTree_,e)}node(){return oh(this.syncTree_,this.path_)}},oI=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},Jp=function(n,t,e){if(!n||typeof n!="object")return n;if(D(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return aI(n[".sv"],t,e);if(typeof n[".sv"]=="object")return lI(n[".sv"],t);D(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},aI=function(n,t,e){switch(n){case"timestamp":return e.timestamp;default:D(!1,"Unexpected server value: "+n)}},lI=function(n,t,e){n.hasOwnProperty("increment")||D(!1,"Unexpected server value: "+JSON.stringify(n,null,2));let r=n.increment;typeof r!="number"&&D(!1,"Unexpected increment value: "+r);let s=t.node();if(D(s!==null&&typeof s<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!s.isLeafNode())return r;let a=s.getValue();return typeof a!="number"?r:a+r},cI=function(n,t,e,r){return uh(t,new Ou(e,n),r)},Wg=function(n,t,e){return uh(n,new Vu(t),e)};function uh(n,t,e){let r=n.getPriority().val(),s=Jp(r,t.getImmediateChild(".priority"),e),i;if(n.isLeafNode()){let a=n,l=Jp(a.getValue(),t,e);return l!==a.getValue()||s!==a.getPriority().val()?new nr(l,ft(s)):n}else{let a=n;return i=a,s!==a.getPriority().val()&&(i=i.updatePriority(new nr(s))),a.forEachChild(ot,(l,u)=>{let h=uh(u,t.getImmediateChild(l),e);h!==u&&(i=i.updateImmediateChild(l,h))}),i}}var ps=class{constructor(t="",e=null,r={children:{},childCount:0}){this.name=t,this.parent=e,this.node=r}};function hh(n,t){let e=t instanceof J?t:new J(t),r=n,s=z(e);for(;s!==null;){let i=je(r.node.children,s)||{children:{},childCount:0};r=new ps(s,r,i),e=et(e),s=z(e)}return r}function ur(n){return n.node.value}function Qg(n,t){n.node.value=t,Fu(n)}function Hg(n){return n.node.childCount>0}function uI(n){return ur(n)===void 0&&!Hg(n)}function $o(n,t){Rt(n.node.children,(e,r)=>{t(new ps(e,n,r))})}function Yg(n,t,e,r){e&&!r&&t(n),$o(n,s=>{Yg(s,t,!0,r)}),e&&r&&t(n)}function hI(n,t,e){let r=e?n:n.parent;for(;r!==null;){if(t(r))return!0;r=r.parent}return!1}function Es(n){return new J(n.parent===null?n.name:Es(n.parent)+"/"+n.name)}function Fu(n){n.parent!==null&&dI(n.parent,n.name,n)}function dI(n,t,e){let r=uI(e),s=Kt(n.node.children,t);r&&s?(delete n.node.children[t],n.node.childCount--,Fu(n)):!r&&!s&&(n.node.children[t]=e.node,n.node.childCount++,Fu(n))}var fI=/[\[\].#$\/\u0000-\u001F\u007F]/,mI=/[\[\].#$\u0000-\u001F\u007F]/,jc=10*1024*1024,dh=function(n){return typeof n=="string"&&n.length!==0&&!fI.test(n)},Xg=function(n){return typeof n=="string"&&n.length!==0&&!mI.test(n)},pI=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),Xg(n)},Jg=function(n){return n===null||typeof n=="string"||typeof n=="number"&&!Mo(n)||n&&typeof n=="object"&&Kt(n,".sv")},Mu=function(n,t,e,r){r&&t===void 0||Go(Ke(n,"value"),t,e)},Go=function(n,t,e){let r=e instanceof J?new iu(e,n):e;if(t===void 0)throw new Error(n+"contains undefined "+rn(r));if(typeof t=="function")throw new Error(n+"contains a function "+rn(r)+" with contents = "+t.toString());if(Mo(t))throw new Error(n+"contains "+t.toString()+" "+rn(r));if(typeof t=="string"&&t.length>jc/3&&Nr(t)>jc)throw new Error(n+"contains a string greater than "+jc+" utf8 bytes "+rn(r)+" ('"+t.substring(0,50)+"...')");if(t&&typeof t=="object"){let s=!1,i=!1;if(Rt(t,(a,l)=>{if(a===".value")s=!0;else if(a!==".priority"&&a!==".sv"&&(i=!0,!dh(a)))throw new Error(n+" contains an invalid key ("+a+") "+rn(r)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);Hw(r,a),Go(n,l,r),Yw(r)}),s&&i)throw new Error(n+' contains ".value" child '+rn(r)+" in addition to actual children.")}},gI=function(n,t){let e,r;for(e=0;e<t.length;e++){r=t[e];let i=us(r);for(let a=0;a<i.length;a++)if(!(i[a]===".priority"&&a===i.length-1)){if(!dh(i[a]))throw new Error(n+"contains an invalid key ("+i[a]+") in path "+r.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}t.sort(Qw);let s=null;for(e=0;e<t.length;e++){if(r=t[e],s!==null&&Gt(s,r))throw new Error(n+"contains a path "+s.toString()+" that is ancestor of another path "+r.toString());s=r}},_I=function(n,t,e,r){if(r&&t===void 0)return;let s=Ke(n,"values");if(!(t&&typeof t=="object")||Array.isArray(t))throw new Error(s+" must be an object containing the children to replace.");let i=[];Rt(t,(a,l)=>{let u=new J(a);if(Go(s,l,ct(e,u)),Yu(u)===".priority"&&!Jg(l))throw new Error(s+"contains an invalid value for '"+u.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");i.push(u)}),gI(s,i)},yI=function(n,t,e){if(!(e&&t===void 0)){if(Mo(t))throw new Error(Ke(n,"priority")+"is "+t.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!Jg(t))throw new Error(Ke(n,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}};var Zg=function(n,t,e,r){if(!(r&&e===void 0)&&!Xg(e))throw new Error(Ke(n,t)+'was an invalid path = "'+e+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},vI=function(n,t,e,r){e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),Zg(n,t,e,r)},Yn=function(n,t){if(z(t)===".info")throw new Error(n+" failed = Can't modify data under /.info/")},wI=function(n,t){let e=t.path.toString();if(typeof t.repoInfo.host!="string"||t.repoInfo.host.length===0||!dh(t.repoInfo.namespace)&&t.repoInfo.host.split(":")[0]!=="localhost"||e.length!==0&&!pI(e))throw new Error(Ke(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};var Lu=class{constructor(){this.eventLists_=[],this.recursionDepth_=0}};function fh(n,t){let e=null;for(let r=0;r<t.length;r++){let s=t[r],i=s.getPath();e!==null&&!Xu(i,e.path)&&(n.eventLists_.push(e),e=null),e===null&&(e={events:[],path:i}),e.events.push(s)}e&&n.eventLists_.push(e)}function t_(n,t,e){fh(n,e),e_(n,r=>Xu(r,t))}function Te(n,t,e){fh(n,e),e_(n,r=>Gt(r,t)||Gt(t,r))}function e_(n,t){n.recursionDepth_++;let e=!0;for(let r=0;r<n.eventLists_.length;r++){let s=n.eventLists_[r];if(s){let i=s.path;t(i)?(EI(n.eventLists_[r]),n.eventLists_[r]=null):e=!1}}e&&(n.eventLists_=[]),n.recursionDepth_--}function EI(n){for(let t=0;t<n.events.length;t++){let e=n.events[t];if(e!==null){n.events[t]=null;let r=e.getEventRunner();an&&wt("event: "+e.toString()),lr(r)}}}var II="repo_interrupt",TI=25,Bu=class{constructor(t,e,r,s){this.repoInfo_=t,this.forceRestClient_=e,this.authTokenProvider_=r,this.appCheckProvider_=s,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Lu,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Ao(),this.transactionQueueTree_=new ps,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}};function AI(n,t,e){if(n.stats_=Hu(n.repoInfo_),n.forceRestClient_||Tw())n.server_=new gu(n.repoInfo_,(r,s,i,a)=>{Zp(n,r,s,i,a)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>tg(n,!0),0);else{if(typeof e<"u"&&e!==null){if(typeof e!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{mt(e)}catch(r){throw new Error("Invalid authOverride provided: "+r)}}n.persistentConnection_=new Ju(n.repoInfo_,t,(r,s,i,a)=>{Zp(n,r,s,i,a)},r=>{tg(n,r)},r=>{SI(n,r)},n.authTokenProvider_,n.appCheckProvider_,e),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(r=>{n.server_.refreshAuthToken(r)}),n.appCheckProvider_.addTokenChangeListener(r=>{n.server_.refreshAppCheckToken(r.token)}),n.statsReporter_=Cw(n.repoInfo_,()=>new Eu(n.stats_,n.server_)),n.infoData_=new _u,n.infoSyncTree_=new Do({startListening:(r,s,i,a)=>{let l=[],u=n.infoData_.getNode(r._path);return u.isEmpty()||(l=Uo(n.infoSyncTree_,r._path,u),setTimeout(()=>{a("ok")},0)),l},stopListening:()=>{}}),ph(n,"connected",!1),n.serverSyncTree_=new Do({startListening:(r,s,i,a)=>(n.server_.listen(r,i,s,(l,u)=>{let h=a(l,u);Te(n.eventQueue_,r._path,h)}),[]),stopListening:(r,s)=>{n.server_.unlisten(r,s)}})}function CI(n){let e=n.infoData_.getNode(new J(".info/serverTimeOffset")).val()||0;return new Date().getTime()+e}function mh(n){return oI({timestamp:CI(n)})}function Zp(n,t,e,r,s){n.dataUpdateCount++;let i=new J(t);e=n.interceptServerDataCallback_?n.interceptServerDataCallback_(t,e):e;let a=[];if(s)if(r){let u=xr(e,h=>ft(h));a=eI(n.serverSyncTree_,i,u,s)}else{let u=ft(e);a=tI(n.serverSyncTree_,i,u,s)}else if(r){let u=xr(e,h=>ft(h));a=XE(n.serverSyncTree_,i,u)}else{let u=ft(e);a=Uo(n.serverSyncTree_,i,u)}let l=i;a.length>0&&(l=zo(n,i)),Te(n.eventQueue_,l,a)}function tg(n,t){ph(n,"connected",t),t===!1&&RI(n)}function SI(n,t){Rt(t,(e,r)=>{ph(n,e,r)})}function ph(n,t,e){let r=new J("/.info/"+t),s=ft(e);n.infoData_.updateSnapshot(r,s);let i=Uo(n.infoSyncTree_,r,s);Te(n.eventQueue_,r,i)}function n_(n){return n.nextWriteId_++}function bI(n,t,e,r,s){gh(n,"set",{path:t.toString(),value:e,priority:r});let i=mh(n),a=ft(e,r),l=oh(n.serverSyncTree_,t),u=Wg(a,l,i),h=n_(n),f=Gg(n.serverSyncTree_,t,u,h,!0);fh(n.eventQueue_,f),n.server_.put(t.toString(),a.val(!0),(g,A)=>{let b=g==="ok";b||Vt("set at "+t+" failed: "+g);let N=on(n.serverSyncTree_,h,!b);Te(n.eventQueue_,t,N),ar(n,s,g,A)});let p=a_(n,t);zo(n,p),Te(n.eventQueue_,p,[])}function RI(n){gh(n,"onDisconnectEvents");let t=mh(n),e=Ao();vu(n.onDisconnect_,X(),(s,i)=>{let a=cI(s,i,n.serverSyncTree_,t);cr(e,s,a)});let r=[];vu(e,X(),(s,i)=>{r=r.concat(Uo(n.serverSyncTree_,s,i));let a=a_(n,s);zo(n,a)}),n.onDisconnect_=Ao(),Te(n.eventQueue_,X(),r)}function PI(n,t,e){n.server_.onDisconnectCancel(t.toString(),(r,s)=>{r==="ok"&&yu(n.onDisconnect_,t),ar(n,e,r,s)})}function eg(n,t,e,r){let s=ft(e);n.server_.onDisconnectPut(t.toString(),s.val(!0),(i,a)=>{i==="ok"&&cr(n.onDisconnect_,t,s),ar(n,r,i,a)})}function xI(n,t,e,r,s){let i=ft(e,r);n.server_.onDisconnectPut(t.toString(),i.val(!0),(a,l)=>{a==="ok"&&cr(n.onDisconnect_,t,i),ar(n,s,a,l)})}function NI(n,t,e,r){if(Qs(e)){wt("onDisconnect().update() called with empty data.  Don't do anything."),ar(n,r,"ok",void 0);return}n.server_.onDisconnectMerge(t.toString(),e,(s,i)=>{s==="ok"&&Rt(e,(a,l)=>{let u=ft(l);cr(n.onDisconnect_,ct(t,a),u)}),ar(n,r,s,i)})}function DI(n,t,e){let r;z(t._path)===".info"?r=Xp(n.infoSyncTree_,t,e):r=Xp(n.serverSyncTree_,t,e),t_(n.eventQueue_,t._path,r)}function ng(n,t,e){let r;z(t._path)===".info"?r=ku(n.infoSyncTree_,t,e):r=ku(n.serverSyncTree_,t,e),t_(n.eventQueue_,t._path,r)}function kI(n){n.persistentConnection_&&n.persistentConnection_.interrupt(II)}function gh(n,...t){let e="";n.persistentConnection_&&(e=n.persistentConnection_.id+":"),wt(e,...t)}function ar(n,t,e,r){t&&lr(()=>{if(e==="ok")t(null);else{let s=(e||"error").toUpperCase(),i=s;r&&(i+=": "+r);let a=new Error(i);a.code=s,t(a)}})}function r_(n,t,e){return oh(n.serverSyncTree_,t,e)||$.EMPTY_NODE}function _h(n,t=n.transactionQueueTree_){if(t||jo(n,t),ur(t)){let e=i_(n,t);D(e.length>0,"Sending zero length transaction queue"),e.every(s=>s.status===0)&&VI(n,Es(t),e)}else Hg(t)&&$o(t,e=>{_h(n,e)})}function VI(n,t,e){let r=e.map(h=>h.currentWriteId),s=r_(n,t,r),i=s,a=s.hash();for(let h=0;h<e.length;h++){let f=e[h];D(f.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),f.status=1,f.retryCount++;let p=kt(t,f.path);i=i.updateChild(p,f.currentOutputSnapshotRaw)}let l=i.val(!0),u=t;n.server_.put(u.toString(),l,h=>{gh(n,"transaction put response",{path:u.toString(),status:h});let f=[];if(h==="ok"){let p=[];for(let g=0;g<e.length;g++)e[g].status=2,f=f.concat(on(n.serverSyncTree_,e[g].currentWriteId)),e[g].onComplete&&p.push(()=>e[g].onComplete(null,!0,e[g].currentOutputSnapshotResolved)),e[g].unwatcher();jo(n,hh(n.transactionQueueTree_,t)),_h(n,n.transactionQueueTree_),Te(n.eventQueue_,t,f);for(let g=0;g<p.length;g++)lr(p[g])}else{if(h==="datastale")for(let p=0;p<e.length;p++)e[p].status===3?e[p].status=4:e[p].status=0;else{Vt("transaction at "+u.toString()+" failed: "+h);for(let p=0;p<e.length;p++)e[p].status=4,e[p].abortReason=h}zo(n,t)}},a)}function zo(n,t){let e=s_(n,t),r=Es(e),s=i_(n,e);return OI(n,s,r),r}function OI(n,t,e){if(t.length===0)return;let r=[],s=[],a=t.filter(l=>l.status===0).map(l=>l.currentWriteId);for(let l=0;l<t.length;l++){let u=t[l],h=kt(e,u.path),f=!1,p;if(D(h!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),u.status===4)f=!0,p=u.abortReason,s=s.concat(on(n.serverSyncTree_,u.currentWriteId,!0));else if(u.status===0)if(u.retryCount>=TI)f=!0,p="maxretry",s=s.concat(on(n.serverSyncTree_,u.currentWriteId,!0));else{let g=r_(n,u.path,a);u.currentInputSnapshot=g;let A=t[l].update(g.val());if(A!==void 0){Go("transaction failed: Data returned ",A,u.path);let b=ft(A);typeof A=="object"&&A!=null&&Kt(A,".priority")||(b=b.updatePriority(g.getPriority()));let x=u.currentWriteId,U=mh(n),q=Wg(b,g,U);u.currentOutputSnapshotRaw=b,u.currentOutputSnapshotResolved=q,u.currentWriteId=n_(n),a.splice(a.indexOf(x),1),s=s.concat(Gg(n.serverSyncTree_,u.path,q,u.currentWriteId,u.applyLocally)),s=s.concat(on(n.serverSyncTree_,x,!0))}else f=!0,p="nodata",s=s.concat(on(n.serverSyncTree_,u.currentWriteId,!0))}Te(n.eventQueue_,e,s),s=[],f&&(t[l].status=2,function(g){setTimeout(g,Math.floor(0))}(t[l].unwatcher),t[l].onComplete&&(p==="nodata"?r.push(()=>t[l].onComplete(null,!1,t[l].currentInputSnapshot)):r.push(()=>t[l].onComplete(new Error(p),!1,null))))}jo(n,n.transactionQueueTree_);for(let l=0;l<r.length;l++)lr(r[l]);_h(n,n.transactionQueueTree_)}function s_(n,t){let e,r=n.transactionQueueTree_;for(e=z(t);e!==null&&ur(r)===void 0;)r=hh(r,e),t=et(t),e=z(t);return r}function i_(n,t){let e=[];return o_(n,t,e),e.sort((r,s)=>r.order-s.order),e}function o_(n,t,e){let r=ur(t);if(r)for(let s=0;s<r.length;s++)e.push(r[s]);$o(t,s=>{o_(n,s,e)})}function jo(n,t){let e=ur(t);if(e){let r=0;for(let s=0;s<e.length;s++)e[s].status!==2&&(e[r]=e[s],r++);e.length=r,Qg(t,e.length>0?e:void 0)}$o(t,r=>{jo(n,r)})}function a_(n,t){let e=Es(s_(n,t)),r=hh(n.transactionQueueTree_,t);return hI(r,s=>{Kc(n,s)}),Kc(n,r),Yg(r,s=>{Kc(n,s)}),e}function Kc(n,t){let e=ur(t);if(e){let r=[],s=[],i=-1;for(let a=0;a<e.length;a++)e[a].status===3||(e[a].status===1?(D(i===a-1,"All SENT items should be at beginning of queue."),i=a,e[a].status=3,e[a].abortReason="set"):(D(e[a].status===0,"Unexpected transaction status in abort"),e[a].unwatcher(),s=s.concat(on(n.serverSyncTree_,e[a].currentWriteId,!0)),e[a].onComplete&&r.push(e[a].onComplete.bind(null,new Error("set"),!1,null))));i===-1?Qg(t,void 0):e.length=i+1,Te(n.eventQueue_,Es(t),s);for(let a=0;a<r.length;a++)lr(r[a])}}function FI(n){let t="",e=n.split("/");for(let r=0;r<e.length;r++)if(e[r].length>0){let s=e[r];try{s=decodeURIComponent(s.replace(/\+/g," "))}catch{}t+="/"+s}return t}function MI(n){let t={};n.charAt(0)==="?"&&(n=n.substring(1));for(let e of n.split("&")){if(e.length===0)continue;let r=e.split("=");r.length===2?t[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):Vt(`Invalid query segment '${e}' in query '${n}'`)}return t}var rg=function(n,t){let e=LI(n),r=e.namespace;e.domain==="firebase.com"&&Ee(e.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!r||r==="undefined")&&e.domain!=="localhost"&&Ee("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),e.secure||mw();let s=e.scheme==="ws"||e.scheme==="wss";return{repoInfo:new go(e.host,e.secure,r,s,t,"",r!==e.subdomain),path:new J(e.pathString)}},LI=function(n){let t="",e="",r="",s="",i="",a=!0,l="https",u=443;if(typeof n=="string"){let h=n.indexOf("//");h>=0&&(l=n.substring(0,h-1),n=n.substring(h+2));let f=n.indexOf("/");f===-1&&(f=n.length);let p=n.indexOf("?");p===-1&&(p=n.length),t=n.substring(0,Math.min(f,p)),f<p&&(s=FI(n.substring(f,p)));let g=MI(n.substring(Math.min(n.length,p)));h=t.indexOf(":"),h>=0?(a=l==="https"||l==="wss",u=parseInt(t.substring(h+1),10)):h=t.length;let A=t.slice(0,h);if(A.toLowerCase()==="localhost")e="localhost";else if(A.split(".").length<=2)e=A;else{let b=t.indexOf(".");r=t.substring(0,b).toLowerCase(),e=t.substring(b+1),i=r}"ns"in g&&(i=g.ns)}return{host:t,port:u,domain:e,subdomain:r,secure:a,scheme:l,pathString:s,namespace:i}};var Vo=class{constructor(t,e,r,s){this.eventType=t,this.eventRegistration=e,this.snapshot=r,this.prevName=s}getPath(){let t=this.snapshot.ref;return this.eventType==="value"?t._path:t.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+mt(this.snapshot.exportVal())}},Oo=class{constructor(t,e,r){this.eventRegistration=t,this.error=e,this.path=r}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}};var Uu=class{constructor(t,e){this.snapshotCallback=t,this.cancelCallback=e}onValue(t,e){this.snapshotCallback.call(null,t,e)}onCancel(t){return D(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,t)}get hasCancelCallback(){return!!this.cancelCallback}matches(t){return this.snapshotCallback===t.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===t.snapshotCallback.userCallback&&this.snapshotCallback.context===t.snapshotCallback.context}};var qu=class{constructor(t,e){this._repo=t,this._path=e}cancel(){let t=new fe;return PI(this._repo,this._path,t.wrapCallback(()=>{})),t.promise}remove(){Yn("OnDisconnect.remove",this._path);let t=new fe;return eg(this._repo,this._path,null,t.wrapCallback(()=>{})),t.promise}set(t){Yn("OnDisconnect.set",this._path),Mu("OnDisconnect.set",t,this._path,!1);let e=new fe;return eg(this._repo,this._path,t,e.wrapCallback(()=>{})),e.promise}setWithPriority(t,e){Yn("OnDisconnect.setWithPriority",this._path),Mu("OnDisconnect.setWithPriority",t,this._path,!1),yI("OnDisconnect.setWithPriority",e,!1);let r=new fe;return xI(this._repo,this._path,t,e,r.wrapCallback(()=>{})),r.promise}update(t){Yn("OnDisconnect.update",this._path),_I("OnDisconnect.update",t,this._path,!1);let e=new fe;return NI(this._repo,this._path,t,e.wrapCallback(()=>{})),e.promise}};var $u=class n{constructor(t,e,r,s){this._repo=t,this._path=e,this._queryParams=r,this._orderByCalled=s}get key(){return j(this._path)?null:Yu(this._path)}get ref(){return new Ae(this._repo,this._path)}get _queryIdentifier(){let t=Up(this._queryParams),e=Qu(t);return e==="{}"?"default":e}get _queryObject(){return Up(this._queryParams)}isEqual(t){if(t=Ct(t),!(t instanceof n))return!1;let e=this._repo===t._repo,r=Xu(this._path,t._path),s=this._queryIdentifier===t._queryIdentifier;return e&&r&&s}toJSON(){return this.toString()}toString(){return this._repo.toString()+Ww(this._path)}};var Ae=class n extends $u{constructor(t,e){super(t,e,new pu,!1)}get parent(){let t=Tg(this._path);return t===null?null:new n(this._repo,t)}get root(){let t=this;for(;t.parent!==null;)t=t.parent;return t}},Fo=class n{constructor(t,e,r){this._node=t,this.ref=e,this._index=r}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(t){let e=new J(t),r=gs(this.ref,t);return new n(this._node.getChild(e),r,ot)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(t){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(r,s)=>t(new n(s,gs(this.ref,r),ot)))}hasChild(t){let e=new J(t);return!this._node.getChild(e).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}};function l_(n,t){return n=Ct(n),n._checkNotDeleted("ref"),t!==void 0?gs(n._root,t):n._root}function gs(n,t){return n=Ct(n),z(n._path)===null?vI("child","path",t,!1):Zg("child","path",t,!1),new Ae(n._repo,ct(n._path,t))}function c_(n){return n=Ct(n),new qu(n._repo,n._path)}function u_(n){return Yn("remove",n._path),yh(n,null)}function yh(n,t){n=Ct(n),Yn("set",n._path),Mu("set",t,n._path,!1);let e=new fe;return bI(n._repo,n._path,t,null,e.wrapCallback(()=>{})),e.promise}var Gu=class n{constructor(t){this.callbackContext=t}respondsTo(t){return t==="value"}createEvent(t,e){let r=e._queryParams.getIndex();return new Vo("value",this,new Fo(t.snapshotNode,new Ae(e._repo,e._path),r))}getEventRunner(t){return t.getEventType()==="cancel"?()=>this.callbackContext.onCancel(t.error):()=>this.callbackContext.onValue(t.snapshot,null)}createCancelEvent(t,e){return this.callbackContext.hasCancelCallback?new Oo(this,t,e):null}matches(t){return t instanceof n?!t.callbackContext||!this.callbackContext?!0:t.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}},zu=class n{constructor(t,e){this.eventType=t,this.callbackContext=e}respondsTo(t){let e=t==="children_added"?"child_added":t;return e=e==="children_removed"?"child_removed":e,this.eventType===e}createCancelEvent(t,e){return this.callbackContext.hasCancelCallback?new Oo(this,t,e):null}createEvent(t,e){D(t.childName!=null,"Child events should have a childName.");let r=gs(new Ae(e._repo,e._path),t.childName),s=e._queryParams.getIndex();return new Vo(t.type,this,new Fo(t.snapshotNode,r,s),t.prevName)}getEventRunner(t){return t.getEventType()==="cancel"?()=>this.callbackContext.onCancel(t.error):()=>this.callbackContext.onValue(t.snapshot,t.prevName)}matches(t){return t instanceof n?this.eventType===t.eventType&&(!this.callbackContext||!t.callbackContext||this.callbackContext.matches(t.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}};function BI(n,t,e,r,s){let i;if(typeof r=="object"&&(i=void 0,s=r),typeof r=="function"&&(i=r),s&&s.onlyOnce){let u=e,h=(f,p)=>{ng(n._repo,n,l),u(f,p)};h.userCallback=e.userCallback,h.context=e.context,e=h}let a=new Uu(e,i||void 0),l=t==="value"?new Gu(a):new zu(t,a);return DI(n._repo,n,l),()=>ng(n._repo,n,l)}function h_(n,t,e,r){return BI(n,"value",t,e,r)}$E(Ae);QE(Ae);var UI="FIREBASE_DATABASE_EMULATOR_HOST",ju={},qI=!1;function $I(n,t,e,r){let s=t.lastIndexOf(":"),i=t.substring(0,s),a=vn(i);n.repoInfo_=new go(t,a,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0,e),r&&(n.authTokenProvider_=r)}function GI(n,t,e,r,s){let i=r||n.options.databaseURL;i===void 0&&(n.options.projectId||Ee("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),wt("Using default host for project ",n.options.projectId),i=`${n.options.projectId}-default-rtdb.firebaseio.com`);let a=rg(i,s),l=a.repoInfo,u,h;typeof process<"u"&&process.env&&(h=process.env[UI]),h?(u=!0,i=`http://${h}?ns=${l.namespace}`,a=rg(i,s),l=a.repoInfo):u=!a.repoInfo.secure;let f=s&&u?new os(os.OWNER):new Jc(n.name,n.options,t);wI("Invalid Firebase Database URL",a),j(a.path)||Ee("Database URL must point to the root of a Firebase Database (not including a child path).");let p=jI(l,n,f,new Xc(n,e));return new Ku(p,n)}function zI(n,t){let e=ju[t];(!e||e[n.key]!==n)&&Ee(`Database ${t}(${n.repoInfo_}) has already been deleted.`),kI(n),delete e[n.key]}function jI(n,t,e,r){let s=ju[t.name];s||(s={},ju[t.name]=s);let i=s[n.toURLString()];return i&&Ee("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),i=new Bu(n,qI,e,r),s[n.toURLString()]=i,i}var Ku=class{constructor(t,e){this._repoInternal=t,this.app=e,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(AI(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Ae(this._repo,X())),this._rootInternal}_delete(){return this._rootInternal!==null&&(zI(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(t){this._rootInternal===null&&Ee("Cannot call "+t+" on a deleted database.")}};function d_(n=ei(),t){let e=Js(n,"database").getImmediate({identifier:t});if(!e._instanceStarted){let r=Gs("database");r&&f_(e,...r)}return e}function f_(n,t,e,r={}){n=Ct(n),n._checkNotDeleted("useEmulator");let s=`${t}:${e}`,i=n._repoInternal;if(n._instanceStarted){if(s===n._repoInternal.repoInfo_.host&&wn(r,i.repoInfo_.emulatorOptions))return;Ee("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let a;if(i.repoInfo_.nodeAdmin)r.mockUserToken&&Ee('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),a=new os(os.OWNER);else if(r.mockUserToken){let l=typeof r.mockUserToken=="string"?r.mockUserToken:js(r.mockUserToken,n.app.options.projectId);a=new os(l)}vn(t)&&(zs(t),Ks("Database",!0)),$I(i,s,r,a)}function KI(n){hw(ti),Xs(new Hs("database",(t,{instanceIdentifier:e})=>{let r=t.getProvider("app").getImmediate(),s=t.getProvider("auth-internal"),i=t.getProvider("app-check-internal");return GI(r,s,i,e)},"PUBLIC").setMultipleInstances(!0)),Zt(Tp,Ap,n),Zt(Tp,Ap,"esm2017")}Ju.prototype.simpleListen=function(n,t){this.sendRequest("q",{p:n},t)};Ju.prototype.echo=function(n,t){this.sendRequest("echo",{d:n},t)};KI();var dn=class{constructor(t){return t}},m_="database",vh=class{constructor(){return si(m_)}};var wh=new Bs("angularfire2.database-instances");function WI(n,t){let e=ri(m_,n,t);return e&&new dn(e)}function QI(n){return(t,e)=>{let r=t.runOutsideAngular(()=>n(e));return new dn(r)}}var HI={provide:vh,deps:[[new Xt,wh]]},YI={provide:dn,useFactory:WI,deps:[[new Xt,wh],oi]};function M0(n,...t){return Zt("angularfire",ni.full,"rtdb"),Us([YI,HI,{provide:wh,useFactory:QI(n),multi:!0,deps:[$s,qs,ii,ai,[new Xt,ci],[new Xt,li],...t]}])}var L0=Nt(d_,!0);var p_=Nt(c_,!0),g_=Nt(h_,!0);var Ko=Nt(l_,!0,2);var __=Nt(u_,!0,2);var y_=Nt(yh,!0,2);var Eh={toFirestore(n){return ya(ya({remainingBalls:n.remainingBalls,drawnNumbers:n.drawnNumbers,currentBall:n.currentBall,isAnimating:n.isAnimating},n.players!=null&&{players:n.players}),n.creatorId!=null&&{creatorId:n.creatorId})},fromFirestore(n){let t=n.data();return{remainingBalls:t.remainingBalls,drawnNumbers:t.drawnNumbers,currentBall:t.currentBall,isAnimating:t.isAnimating,players:t.players||{},creatorId:t.creatorId}}},v_=class n{numbersBingo=90;animationDuration=1e3;intervalStep=50;animationIntervalId=null;roomId=null;roomSub=null;remainingBalls=ze([]);drawnNumbers=ze([]);currentBall=ze(null);isAnimating=ze(!1);players=ze({});creatorId=ze(void 0);firestore=_n(nn);db=_n(dn);alertService=_n(qd);authService=_n(Ud);router=_n(bd);constructor(){Sd(()=>{this.isAnimating()&&this.animationBalls()})}async createRoom(t){this.roomId=t;let e=Qt(this.firestore,"rooms",t),r=this.authService.getCurrentUser();if(!r){this.alertService.show("Debes estar autenticado para crear una sala","error",4e3),this.router.navigate(["/home"]);return}if(await this.existRoom(e)){await le(e,{[`players.${r.uid}`]:r.displayName||r.email||"An\xF3nimo"}),this.listenRoom(),await this.setUserPresence(t,r.uid),this.listenPresenceChanges(t);return}let s={remainingBalls:Array.from({length:this.numbersBingo},(i,a)=>a+1),drawnNumbers:[],currentBall:null,isAnimating:!1,creatorId:r.uid};await Ip(e,s),await le(e,{[`players.${r.uid}`]:r.displayName||r.email||"An\xF3nimo"}),this.listenRoom(),await this.setUserPresence(t,r.uid),this.listenPresenceChanges(t)}async joinRoom(t){this.roomId=t;let e=Qt(this.firestore,"rooms",t).withConverter(Eh);if(!(await fo(e)).exists())return this.router.navigate(["/lobby"]),this.alertService.show(`La sala con id ${this.roomId} no existe`,"error",4e3),!1;this.listenRoom();let r=this.authService.getCurrentUser();return r&&(await le(e,{[`players.${r.uid}`]:r.displayName||r.email||"An\xF3nimo"}),await this.setUserPresence(t,r.uid),this.listenPresenceChanges(t)),!0}listenRoom(){if(!this.roomId)return;this.roomSub&&this.roomSub.unsubscribe();let t=Qt(this.firestore,"rooms",this.roomId).withConverter(Eh);this.roomSub=wp(t).subscribe(e=>{e&&(this.remainingBalls.set(e.remainingBalls),this.drawnNumbers.set(e.drawnNumbers),this.currentBall.set(e.currentBall),this.isAnimating.set(e.isAnimating),e.players&&(this.players.set(e.players),this.creatorId.set(e.creatorId)))})}async nextBall(){if(this.isAnimating())return;let t=this.remainingBalls();if(!this.roomId||t.length===0)return;let e=Math.floor(Math.random()*t.length),r=t[e];await le(Qt(this.firestore,"rooms",this.roomId),{isAnimating:!0}),setTimeout(async()=>{await le(Qt(this.firestore,"rooms",this.roomId),{currentBall:r,remainingBalls:mp(r),drawnNumbers:fp(r),isAnimating:!1})},this.animationDuration)}async resetBalls(){if(!this.roomId)return;let t={remainingBalls:Array.from({length:this.numbersBingo},(r,s)=>s+1),drawnNumbers:[],currentBall:null,isAnimating:!1},e=Qt(this.firestore,"rooms",this.roomId);await le(e,{remainingBalls:t.remainingBalls,drawnNumbers:t.drawnNumbers,currentBall:t.currentBall,isAnimating:t.isAnimating})}animationBalls(){let t=Date.now();this.animationIntervalId=setInterval(()=>{if(Date.now()-t>=this.animationDuration)clearInterval(this.animationIntervalId);else{let r=Math.floor(Math.random()*this.remainingBalls().length);this.currentBall.set(this.remainingBalls()[r])}},this.intervalStep)}async existRoom(t){return(await fo(t)).exists()}async addPlayerToRoom(t){if(!this.roomId)return;let e=t.displayName||t.email||"An\xF3nimo",r=Qt(this.firestore,"rooms",this.roomId);await le(r,{[`players.${t.uid}`]:e})}async removePlayerFromRoom(t){if(!this.roomId)return;let e=Qt(this.firestore,"rooms",this.roomId);await le(e,{[`players.${t}`]:Ep()})}async getRoom(t){let e=Qt(this.firestore,"rooms",t).withConverter(Eh);return(await fo(e)).data()}async setUserPresence(t,e){let r=Ko(this.db,`presence/${t}/${e}`);await y_(r,!0),p_(r).remove()}listenPresenceChanges(t){let e=Ko(this.db,`presence/${t}`);g_(e,async r=>{let s=r.val()?Object.keys(r.val()):[],i=this.players(),a={};for(let l of s)a[l]=i[l]||"An\xF3nimo";await le(Qt(this.firestore,"rooms",t),{players:a})})}async clearUserPresence(t,e){let r=Ko(this.db,`presence/${t}/${e}`);await __(r)}unsubscribe(){this.roomSub?.unsubscribe()}static \u0275fac=function(e){return new(e||n)};static \u0275prov=Cd({token:n,factory:n.\u0275fac,providedIn:"root"})};export{UA as a,qA as b,M0 as c,L0 as d,v_ as e};
