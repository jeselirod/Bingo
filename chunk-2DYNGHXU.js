import{B as c,C as g,D as h,F as B,G as a,H as b,J as f,K as o}from"./chunk-UGOB67NP.js";import{Ha as u,J as e,u as l,y as m}from"./chunk-W2D726ZP.js";var v={toFirestore(t){return{remainingBalls:t.remainingBalls,drawnNumbers:t.drawnNumbers,currentBall:t.currentBall,isAnimating:t.isAnimating}},fromFirestore(t){let n=t.data();return{remainingBalls:n.remainingBalls,drawnNumbers:n.drawnNumbers,currentBall:n.currentBall,isAnimating:n.isAnimating}}},d=class t{numbersBingo=90;animationDuration=1e3;intervalStep=50;animationIntervalId=null;roomId=null;roomSub=null;remainingBalls=e([]);drawnNumbers=e([]);currentBall=e(null);isAnimating=e(!1);firestore=m(h);constructor(){u(()=>{this.isAnimating()&&this.animationBalls()})}async createRoom(n){this.roomId=n;let i=a(this.firestore,"rooms",n);if((await b(i)).exists()){console.log(`La sala ${n} ya existe.`),this.listenRoom();return}let s={remainingBalls:Array.from({length:this.numbersBingo},(w,p)=>p+1),drawnNumbers:[],currentBall:null,isAnimating:!1};await f(a(this.firestore,"rooms",n),s),this.listenRoom()}joinRoom(n){this.roomId=n,this.listenRoom()}listenRoom(){if(!this.roomId)return;this.roomSub&&this.roomSub.unsubscribe();let n=a(this.firestore,"rooms",this.roomId).withConverter(v);this.roomSub=B(n).subscribe(i=>{i&&(this.remainingBalls.set(i.remainingBalls),this.drawnNumbers.set(i.drawnNumbers),this.currentBall.set(i.currentBall),this.isAnimating.set(i.isAnimating))})}async nextBall(){if(this.isAnimating())return;let n=this.remainingBalls();if(!this.roomId||n.length===0)return;let i=Math.floor(Math.random()*n.length),r=n[i];await o(a(this.firestore,"rooms",this.roomId),{isAnimating:!0}),setTimeout(async()=>{await o(a(this.firestore,"rooms",this.roomId),{currentBall:r,remainingBalls:g(r),drawnNumbers:c(r),isAnimating:!1})},this.animationDuration)}async resetBalls(){if(!this.roomId)return;let n={remainingBalls:Array.from({length:this.numbersBingo},(r,s)=>s+1),drawnNumbers:[],currentBall:null,isAnimating:!1},i=a(this.firestore,"rooms",this.roomId);await o(i,{remainingBalls:n.remainingBalls,drawnNumbers:n.drawnNumbers,currentBall:n.currentBall,isAnimating:n.isAnimating})}animationBalls(){let n=Date.now();this.animationIntervalId=setInterval(()=>{if(Date.now()-n>=this.animationDuration)clearInterval(this.animationIntervalId);else{let r=Math.floor(Math.random()*this.remainingBalls().length);this.currentBall.set(this.remainingBalls()[r])}},this.intervalStep)}static \u0275fac=function(i){return new(i||t)};static \u0275prov=l({token:t,factory:t.\u0275fac,providedIn:"root"})};export{d as a};
